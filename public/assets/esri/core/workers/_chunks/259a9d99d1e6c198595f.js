self.webpackChunkRemoteClient([55],{141:function(e,t,r){"use strict";var s=r(24),a=(r(3),r(20),r(7),r(9),r(26)),n=r(25),i=r(4),o=(r(41),r(42),r(30));let u=class extends o.a{constructor(...e){super(...e),this.requestOptions=null,this.url=null}normalizeCtorArgs(e,t){return"string"!=typeof e?e:{url:e,...t}}get parsedUrl(){return this._parseUrl(this.url)}_parseUrl(e){return e?Object(i.H)(e):null}_encode(e,t,r){const s={};for(const a in e){if("declaredClass"===a)continue;const n=e[a];if(null!=n&&"function"!=typeof n)if(Array.isArray(n)){s[a]=[];for(let e=0;e<n.length;e++)s[a][e]=this._encode(n[e])}else if("object"==typeof n)if(n.toJSON){const e=n.toJSON(r&&r[a]);s[a]=t?e:JSON.stringify(e)}else s[a]=t?n:JSON.stringify(n);else s[a]=n}return s}};Object(s.a)([Object(a.b)({readOnly:!0,dependsOn:["url"]})],u.prototype,"parsedUrl",null),Object(s.a)([Object(a.b)()],u.prototype,"requestOptions",void 0),Object(s.a)([Object(a.b)({type:String})],u.prototype,"url",void 0),u=Object(s.a)([Object(n.a)("esri.tasks.Task")],u);var c=u;t.a=c},144:function(e,t,r){"use strict";function s(e){const t={};for(const r in e){if("declaredClass"===r)continue;const a=e[r];if(null!=a&&"function"!=typeof a)if(Array.isArray(a)){t[r]=[];for(let e=0;e<a.length;e++)t[r][e]=s(a[e])}else"object"==typeof a?a.toJSON&&(t[r]=JSON.stringify(a)):t[r]=a}return t}r.d(t,"a",(function(){return s}))},169:function(e,t,r){"use strict";var s=r(3),a=r(27);const n=Object(s.a)("esri-text-decoder")?new TextDecoder("utf-8"):null,i=Object(s.a)("safari")||Object(s.a)("ios")?6:Object(s.a)("ff")?12:32;class o{constructor(e,t,r=0,s=(e?e.byteLength:0)){this._tag=0,this._dataType=99,this.init(e,t,r,s)}init(e,t,r,s){this._data=e,this._dataView=t,this._pos=r,this._end=s}clone(){return new o(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(e){this._pos=e}nextTag(e){for(;;){if(this._pos===this._end)return!1;const t=this._decodeVarint();if(this._tag=t>>3,this._dataType=7&t,!e||e===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const e=this._decodeVarint();return this._tag=e>>3,this._dataType=7&e,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let e=4294967295;return e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?e:(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?e:void 0))))}getUInt64(){return this._decodeVarint()}getSInt32(){const e=this.getUInt32();return e>>>1^-(1&e)|0}getSInt64(){return this._decodeSVarint()}getBool(){const e=0!==this._data[this._pos];return this._skip(1),e}getEnum(){return this._decodeVarint()}getFixed64(){const e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+4294967296*e.getUint32(t+4,!0);return this._skip(8),r}getSFixed64(){const e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+4294967296*e.getInt32(t+4,!0);return this._skip(8),r}getDouble(){const e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e}getFixed32(){const e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e}getSFixed32(){const e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e}getFloat(){const e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e}getString(){const e=this._getLength(),t=this._pos,r=this._toString(this._data,t,t+e);return this._skip(e),r}getBytes(){const e=this._getLength(),t=this._pos,r=this._toBytes(this._data,t,t+e);return this._skip(e),r}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(e,t,r,s){const a=this.getMessage(),n=e(a,t,r,s);return a.release(),n}processMessage(e){const t=this.getMessage(),r=e(t);return t.release(),r}getMessage(){const e=this._getLength(),t=o.pool.acquire();return t.init(this._data,this._dataView,this._pos,this._pos+e),this._skip(e),t}release(){o.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case 0:this._decodeVarint();break;case 1:this._skip(8);break;case 2:this._skip(this._getLength());break;case 5:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(e){this._skip(e)}_skip(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e}_decodeVarint(){const e=this._data;let t,r=this._pos,s=0;if(this._end-r>=10)do{if(t=e[r++],s|=127&t,0==(128&t))break;if(t=e[r++],s|=(127&t)<<7,0==(128&t))break;if(t=e[r++],s|=(127&t)<<14,0==(128&t))break;if(t=e[r++],s|=(127&t)<<21,0==(128&t))break;if(t=e[r++],s+=268435456*(127&t),0==(128&t))break;if(t=e[r++],s+=34359738368*(127&t),0==(128&t))break;if(t=e[r++],s+=4398046511104*(127&t),0==(128&t))break;if(t=e[r++],s+=562949953421312*(127&t),0==(128&t))break;if(t=e[r++],s+=72057594037927940*(127&t),0==(128&t))break;if(t=e[r++],s+=0x8000000000000000*(127&t),0==(128&t))break;throw new Error("Varint too long!")}while(0);else{let a=1;for(;r!==this._end&&(t=e[r],0!=(128&t));)++r,s+=(127&t)*a,a*=128;if(r===this._end)throw new Error("Varint overrun!");++r,s+=t*a}return this._pos=r,s}_decodeSVarint(){const e=this._decodeVarint();return e%2?-(e+1)/2:e/2}_getLength(){if(2!==this._dataType)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(e,t,r){if((r=Math.min(this._end,r))-t>i&&n){const s=e.subarray(t,r);return n.decode(s)}let s="",a="";for(let n=t;n<r;++n){const t=e[n];128&t?a+="%"+t.toString(16):(s+=decodeURIComponent(a)+String.fromCharCode(t),a="")}return a.length&&(s+=decodeURIComponent(a)),s}_toBytes(e,t,r){return r=Math.min(this._end,r),new Uint8Array(e.buffer,t,r-t)}}o.pool=new a.a(o,null,e=>{e._data=null,e._dataView=null}),t.a=o},181:function(e,t,r){"use strict";r.d(t,"a",(function(){return x})),r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return I}));var s=r(7),a=r(10),n=r(169);const i=s.a.getLogger("esri.tasks.operations.pbfFeatureServiceParser"),o=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],u=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],c=["upperLeft","lowerLeft"];function l(e){return e>=o.length?null:o[e]}function d(e){return e>=c.length?null:c[e]}function h(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function p(e,t,r){const s=t.createPointGeometry(r);for(;e.next();)switch(e.tag()){case 3:{const r=e.getUInt32(),a=e.pos()+r;let n=0;for(;e.pos()<a;)t.addCoordinatePoint(s,e.getSInt64(),n++);break}case 1:case 2:default:e.skip()}return s}function y(e,t,r){const s=t.createGeometry(r),a=2+(r.hasZ?1:0)+(r.hasM?1:0);for(;e.next();)switch(e.tag()){case 2:{const r=e.getUInt32(),a=e.pos()+r;let n=0;for(;e.pos()<a;)t.addLength(s,e.getUInt32(),n++);break}case 3:{const r=e.getUInt32(),n=e.pos()+r;let i=0;for(;e.pos()<n;)t.addCoordinate(s,e.getSInt64(),i),i++,i===a&&(i=0);break}case 1:default:e.skip()}return s}function f(e,t,r){var s;r.queryGeometry=t.createGeometry(r),r.queryGeometryType=h(t,0);let a=!1;for(;e.next();)switch(e.tag()){case 2:{const s=e.getUInt32(),a=e.pos()+s;let n=0;for(;e.pos()<a;)t.addLength(r.queryGeometry,e.getUInt32(),n++);break}case 3:{const s=e.getUInt32(),a=e.pos()+s;let n=0;for(;e.pos()<a;)t.addCoordinate(r.queryGeometry,e.getSInt64(),n),n++,2===n&&(n=0);break}case 1:r.queryGeometryType=h(t,e.getEnum()),a=!0;break;default:e.skip()}const n=null==(s=r.queryGeometry)?void 0:s.lengths;!a&&n&&n.length&&n[0]>1&&(r.queryGeometryType=h(t,3))}function g(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}function b(e){const t={type:l(0)};for(;e.next();)switch(e.tag()){case 1:t.name=e.getString();break;case 2:t.type=l(e.getEnum());break;case 3:t.alias=e.getString();break;case 4:t.sqlType=(r=e.getEnum())>=u.length?null:u[r];break;case 5:try{t.domain=JSON.parse(e.getString())}catch(e){i.error(new a.a("query:parsing-pbf","Failed to parse domain",{error:e})),t.domain=null}break;case 6:t.defaultValue=e.getString();break;default:e.skip()}var r;return t}function m(e){const t={};for(;e.next();)switch(e.tag()){case 1:t.name=e.getString();break;case 2:t.isSystemMaintained=e.getBool();break;default:e.skip()}return t}function O(e){const t={};for(;e.next();)switch(e.tag()){case 1:t.minServerGen=e.getUInt64();break;case 2:t.serverGen=e.getUInt64();break;default:e.skip()}return t}function j(e,t,r,s){const a=t.createFeature(r);let n=0;for(;e.next();)switch(e.tag()){case 1:{const t=s[n++].name;a.attributes[t]=e.processMessage(g);break}case 2:a.geometry=e.processMessageWithArgs(y,t,r);break;case 4:a.centroid=e.processMessageWithArgs(p,t,r);break;default:e.skip()}return a}function _(e){const t=[1,1,1,1];for(;e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function k(e){const t=[0,0,0,0];for(;e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function I(e){const t={originPosition:d(0)};for(;e.next();)switch(e.tag()){case 1:t.originPosition=d(e.getEnum());break;case 2:t.scale=e.processMessage(_);break;case 3:t.translate=e.processMessage(k);break;default:e.skip()}return t}function F(e){const t={};for(;e.next();)switch(e.tag()){case 1:t.shapeAreaFieldName=e.getString();break;case 2:t.shapeLengthFieldName=e.getString();break;case 3:t.units=e.getString();break;default:e.skip()}return t}function S(e,t){const r=t.createSpatialReference();for(;e.next();)switch(e.tag()){case 1:r.wkid=e.getUInt32();break;case 5:r.wkt=e.getString();break;case 2:r.latestWkid=e.getUInt32();break;case 3:r.vcsWkid=e.getUInt32();break;case 4:r.latestVcsWkid=e.getUInt32();break;default:e.skip()}return r}function R(e,t){const r=t.createFeatureResult();r.geometryType=h(t,0);let s=!1;for(;e.next();)switch(e.tag()){case 1:r.objectIdFieldName=e.getString();break;case 3:r.globalIdFieldName=e.getString();break;case 4:r.geohashFieldName=e.getString();break;case 5:r.geometryProperties=e.processMessage(F);break;case 7:r.geometryType=h(t,e.getEnum());break;case 8:r.spatialReference=e.processMessageWithArgs(S,t);break;case 10:r.hasZ=e.getBool();break;case 11:r.hasM=e.getBool();break;case 12:r.transform=e.processMessage(I);break;case 9:{const t=e.getBool();r.exceededTransferLimit=t;break}case 13:t.addField(r,e.processMessage(b));break;case 15:s||(t.prepareFeatures(r),s=!0),t.addFeature(r,e.processMessageWithArgs(j,t,r,r.fields));break;case 2:r.uniqueIdField=e.processMessage(m);break;case 6:r.serverGens=e.processMessage(O);break;default:e.skip()}return t.finishFeatureResult(r),r}function T(e,t){const r={};for(;e.next();)switch(e.tag()){case 4:e.processMessageWithArgs(f,t,r);break;case 1:r.featureResult=e.processMessageWithArgs(R,t);break;case 2:case 3:default:e.skip()}return r}function x(e,t){try{const r=2,s=new n.a(new Uint8Array(e),new DataView(e)),a={};for(;s.next();)switch(s.tag()){case r:a.queryResult=s.processMessageWithArgs(T,t);break;default:s.skip()}return a}catch(e){const r=new a.a("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e});return i.error(r),{queryResult:{featureResult:t.createFeatureResult()}}}}},183:function(e,t,r){"use strict";r.r(t),r.d(t,"executeQuery",(function(){return p})),r.d(t,"executeQueryForCount",(function(){return b})),r.d(t,"executeQueryForExtent",(function(){return m})),r.d(t,"executeQueryForIds",(function(){return g})),r.d(t,"executeQueryPBF",(function(){return y})),r.d(t,"executeQueryPBFBuffer",(function(){return f})),r.d(t,"queryToQueryStringParameters",(function(){return h})),r.d(t,"runQuery",(function(){return O}));r(20);var s=r(2),a=r(4),n=r(5),i=r(43),o=r(73),u=r(178),c=r(224),l=r(187),d=r(144);function h(e,t){const r=e.geometry,s=e.toJSON(),a=s;if(r&&(a.geometry=JSON.stringify(r),a.geometryType=Object(o.c)(r),a.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference)),s.groupByFieldsForStatistics&&(a.groupByFieldsForStatistics=s.groupByFieldsForStatistics.join(",")),s.objectIds&&(a.objectIds=s.objectIds.join(",")),s.orderByFields&&(a.orderByFields=s.orderByFields.join(",")),!s.outFields||!s.returnDistinctValues&&((null==t?void 0:t.returnCountOnly)||(null==t?void 0:t.returnExtentOnly)||(null==t?void 0:t.returnIdsOnly))?delete a.outFields:-1!==s.outFields.indexOf("*")?a.outFields="*":a.outFields=s.outFields.join(","),s.outSR?a.outSR=s.outSR.wkid||JSON.stringify(s.outSR):r&&(s.returnGeometry||s.returnCentroid)&&(a.outSR=a.inSR),s.returnGeometry&&delete s.returnGeometry,s.outStatistics&&(a.outStatistics=JSON.stringify(s.outStatistics)),s.pixelSize&&(a.pixelSize=JSON.stringify(s.pixelSize)),s.quantizationParameters&&(a.quantizationParameters=JSON.stringify(s.quantizationParameters)),s.parameterValues&&(a.parameterValues=JSON.stringify(s.parameterValues)),s.rangeValues&&(a.rangeValues=JSON.stringify(s.rangeValues)),s.dynamicDataSource&&(a.layer=JSON.stringify({source:s.dynamicDataSource}),delete s.dynamicDataSource),s.timeExtent){const e=s.timeExtent,{start:t,end:r}=e;null==t&&null==r||(a.time=t===r?t:`${null==t?"null":t},${null==r?"null":r}`),delete s.timeExtent}return a}async function p(e,t,r,s){var a;const n=(null==(a=t.timeExtent)?void 0:a.isEmpty)?{data:{features:[]}}:await O(e,t,"json",s);return Object(c.a)(t,r,n.data),n}async function y(e,t,r,s){var a;if(null==(a=t.timeExtent)?void 0:a.isEmpty)return Object(n.r)({data:r.createFeatureResult()});const i=await f(e,t,s),o=i;return o.data=Object(l.a)(i.data,r),o}function f(e,t,r){return O(e,t,"pbf",r)}function g(e,t,r){var s;return(null==(s=t.timeExtent)?void 0:s.isEmpty)?Object(n.r)({data:{objectIds:[]}}):O(e,t,"json",r,{returnIdsOnly:!0})}function b(e,t,r){var s;return(null==(s=t.timeExtent)?void 0:s.isEmpty)?Object(n.r)({data:{count:0}}):O(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})}function m(e,t,r){var s;return(null==(s=t.timeExtent)?void 0:s.isEmpty)?Object(n.r)({data:{count:0,extent:null}}):O(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then(e=>{const t=e.data;if(t.hasOwnProperty("extent"))return e;if(t.features)throw new Error("Layer does not support extent calculation.");if(t.hasOwnProperty("count"))throw new Error("Layer does not support extent calculation.");return e})}function O(e,t,r,n={},o){const c="string"==typeof e?Object(a.H)(e):e,l=t.geometry?[t.geometry]:[];return n.responseType="pbf"===r?"array-buffer":"json",Object(u.a)(l,null,n).then(e=>{const u=e&&e[0];Object(s.h)(u)&&((t=t.clone()).geometry=u);const l=Object(d.a)({...c.query,f:r,...o,...h(t,o)});return Object(i.default)(Object(a.w)(c.path,"query"),{...n,query:{...n.query,...l}})})}},187:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var s=r(181);function a(e,t){const r=Object(s.a)(e,t),a=r.queryResult.featureResult,n=r.queryResult.queryGeometry,i=r.queryResult.queryGeometryType;if(a&&a.features&&a.features.length&&a.objectIdFieldName){const e=a.objectIdFieldName;for(const t of a.features)t.attributes&&(t.objectId=t.attributes[e])}return a&&(a.queryGeometry=n,a.queryGeometryType=i),a}},240:function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return l}));var s=r(4),a=r(43),n=r(144),i=r(12);function o(e){const t=i.a&&i.a.findCredential(e);return t&&t.token?Object(s.d)(e,"token",t.token):e}var u=r(241);function c(e){const t=e.toJSON();return t.attachmentTypes&&(t.attachmentTypes=t.attachmentTypes.join(",")),t.keywords&&(t.keywords=t.keywords.join(",")),t.globalIds&&(t.globalIds=t.globalIds.join(",")),t.objectIds&&(t.objectIds=t.objectIds.join(",")),t.size&&(t.size=t.size.join(",")),t}function l(e,t){const r={};for(const a of e){const{parentObjectId:e,parentGlobalId:n,attachmentInfos:i}=a;for(const a of i){const{id:i}=a,c=Object(s.b)(o(`${t}/${e}/attachments/${i}`)),l=u.a.fromJSON(a);l.set({url:c,parentObjectId:e,parentGlobalId:n}),r[e]?r[e].push(l):r[e]=[l]}}return r}function d(e,t,r){let s={query:Object(n.a)({...e.query,f:"json",...c(t)})};return r&&(s={...r,...s}),Object(a.default)(e.path+"/queryAttachments",s)}},241:function(e,t,r){"use strict";var s,a=r(24),n=(r(3),r(20),r(7),r(9)),i=r(26),o=r(25),u=(r(4),r(41),r(42),r(65)),c=r(14);r(45);const l={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let d=s=class extends u.a{constructor(e){super(e),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:e}=this,t=function(e){const{exifInfo:t,exifName:r,tagName:s}=e;if(!t||!r||!s)return null;const a=Object(c.d)(t,e=>e.name===r);return a?function(e){const{tagName:t,tags:r}=e;if(!r||!t)return null;const s=Object(c.d)(r,e=>e.name===t);return s&&s.value||null}({tagName:s,tags:a.tags}):null}({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:e});return l[t]||null}clone(){return new s({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};Object(a.a)([Object(i.b)({type:String})],d.prototype,"contentType",void 0),Object(a.a)([Object(i.b)()],d.prototype,"exifInfo",void 0),Object(a.a)([Object(i.b)({readOnly:!0,dependsOn:["exifInfo"]})],d.prototype,"orientationInfo",null),Object(a.a)([Object(i.b)({type:n.a})],d.prototype,"id",void 0),Object(a.a)([Object(i.b)({type:String})],d.prototype,"globalId",void 0),Object(a.a)([Object(i.b)({type:String})],d.prototype,"keywords",void 0),Object(a.a)([Object(i.b)({type:String})],d.prototype,"name",void 0),Object(a.a)([Object(i.b)({json:{read:!1}})],d.prototype,"parentGlobalId",void 0),Object(a.a)([Object(i.b)({json:{read:!1}})],d.prototype,"parentObjectId",void 0),Object(a.a)([Object(i.b)({type:n.a})],d.prototype,"size",void 0),Object(a.a)([Object(i.b)({json:{read:!1}})],d.prototype,"url",void 0),d=s=Object(a.a)([Object(o.a)("esri.layers.support.AttachmentInfo")],d);var h=d;t.a=h},257:function(e,t,r){"use strict";var s=r(24),a=(r(3),r(20),r(7),r(9),r(26)),n=r(25),i=(r(4),r(41),r(42),r(70)),o=(r(72),r(140)),u=r(103),c=r(249),l=r(108),d=r(234),h=r(141),p=r(37),y=r(174);function f(e,t){return t}function g(e,t,r,s){switch(r){case 0:return j(e,t+s,0);case 1:return"lowerLeft"===e.originPosition?j(e,t+s,1):function({translate:e,scale:t},r,s){return e[s]-r*t[s]}(e,t+s,1)}}function b(e,t,r,s){switch(r){case 2:return j(e,t,2);default:return g(e,t,r,s)}}function m(e,t,r,s){switch(r){case 2:return j(e,t,3);default:return g(e,t,r,s)}}function O(e,t,r,s){switch(r){case 3:return j(e,t,3);default:return b(e,t,r,s)}}function j({translate:e,scale:t},r,s){return e[s]+r*t[s]}class _{constructor(e){this.options=e,this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],this.previousCoordinate=[0,0],this.transform=null,this.applyTransform=f,this.lengths=[],this.currentLengthIndex=0,this.toAddInCurrentPath=0,this.vertexDimension=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,this.AttributesConstructor=function(){}}createFeatureResult(){return{fields:[],features:[]}}finishFeatureResult(e){if(this.options.applyTransform&&(e.transform=null),this.AttributesConstructor=function(){},this.coordinateBuffer=null,this.lengths.length=0,!e.hasZ)return;const t=Object(y.a)(e.geometryType,this.options.sourceSpatialReference,e.spatialReference);if(t)for(const r of e.features)t(r.geometry)}createSpatialReference(){return{}}addField(e,t){e.fields.push(t);const r=e.fields.map(e=>e.name);this.AttributesConstructor=function(){for(const e of r)this[e]=null}}addFeature(e,t){e.features.push(t)}prepareFeatures(e){switch(this.options.applyTransform&&e.transform&&(this.transform=e.transform,this.applyTransform=this.deriveApplyTransform(e)),this.vertexDimension=2,e.hasZ&&this.vertexDimension++,e.hasM&&this.vertexDimension++,e.geometryType){case"esriGeometryPoint":this.addCoordinate=(e,t,r)=>this.addCoordinatePoint(e,t,r),this.createGeometry=e=>this.createPointGeometry(e);break;case"esriGeometryPolygon":this.addCoordinate=(e,t,r)=>this.addCoordinatePolygon(e,t,r),this.createGeometry=e=>this.createPolygonGeometry(e);break;case"esriGeometryPolyline":this.addCoordinate=(e,t,r)=>this.addCoordinatePolyline(e,t,r),this.createGeometry=e=>this.createPolylineGeometry(e);break;case"esriGeometryMultipoint":this.addCoordinate=(e,t,r)=>this.addCoordinateMultipoint(e,t,r),this.createGeometry=e=>this.createMultipointGeometry(e);break;default:Object(p.a)(e.geometryType)}}createFeature(){return this.lengths.length=0,this.currentLengthIndex=0,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,{attributes:new this.AttributesConstructor}}addLength(e,t,r){0===this.lengths.length&&(this.toAddInCurrentPath=t),this.lengths.push(t)}createPointGeometry(e){const t={x:0,y:0,spatialReference:e.spatialReference};return e.hasZ&&(t.z=0),e.hasM&&(t.m=0),t}addCoordinatePoint(e,t,r){switch(t=this.applyTransform(this.transform,t,r,0),r){case 0:e.x=t;break;case 1:e.y=t;break;case 2:"z"in e?e.z=t:e.m=t;break;case 3:e.m=t}}transformPathLikeValue(e,t){let r=0;return t<=1&&(r=this.previousCoordinate[t],this.previousCoordinate[t]+=e),this.applyTransform(this.transform,e,t,r)}addCoordinatePolyline(e,t,r){this.dehydratedAddPointsCoordinate(e.paths,t,r)}addCoordinatePolygon(e,t,r){this.dehydratedAddPointsCoordinate(e.rings,t,r)}addCoordinateMultipoint(e,t,r){0===r&&e.points.push([]);const s=this.transformPathLikeValue(t,r);e.points[e.points.length-1].push(s)}createPolygonGeometry(e){return{rings:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}createPolylineGeometry(e){return{paths:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}createMultipointGeometry(e){return{points:[],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}dehydratedAddPointsCoordinate(e,t,r){if(null===this.coordinateBuffer){const e=this.lengths.reduce((e,t)=>e+t,0);this.coordinateBuffer=new Float64Array(e*this.vertexDimension)}0===r&&0==this.toAddInCurrentPath--&&(e.push([]),this.toAddInCurrentPath=this.lengths[++this.currentLengthIndex]-1,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0);const s=this.transformPathLikeValue(t,r),a=e[e.length-1];0===r&&a.push(new Float64Array(this.coordinateBuffer.buffer,this.coordinateBufferPtr*Float64Array.BYTES_PER_ELEMENT,this.vertexDimension)),this.coordinateBuffer[this.coordinateBufferPtr++]=s}deriveApplyTransform(e){const{hasZ:t,hasM:r}=e;return t&&r?O:t?b:r?m:g}}var k=r(183),I=r(240),F=r(43),S=r(144);function R(e,t){const r=e.toJSON();return r.objectIds&&(r.objectIds=r.objectIds.join(",")),r.orderByFields&&(r.orderByFields=r.orderByFields.join(",")),r.outFields&&!(null==t?void 0:t.returnCountOnly)?-1!==r.outFields.indexOf("*")?r.outFields="*":r.outFields=r.outFields.join(","):delete r.outFields,r.outSpatialReference&&(r.outSR=r.outSR.wkid||JSON.stringify(r.outSR.toJSON()),delete r.outSpatialReference),r.dynamicDataSource&&(r.layer=JSON.stringify({source:r.dynamicDataSource}),delete r.dynamicDataSource),r}async function T(e,t,r={},s){const a=Object(S.a)({...e.query,f:"json",...s,...R(t,s)});return Object(F.default)(e.path+"/queryRelatedRecords",{...r,query:{...r.query,...a}})}let x=class extends h.a{constructor(e){super(e),this.dynamicDataSource=null,this.format="json",this.gdbVersion=null,this.sourceSpatialReference=null}execute(e,t){return this.executeJSON(e,t).then(e=>o.default.fromJSON(e))}async executeJSON(e,t){const r={...this.requestOptions,...t},s=this._normalizeQuery(e);if("pbf"===this.format){const e=!s.quantizationParameters,{data:t}=await Object(k.executeQueryPBF)(this.parsedUrl,s,new _({sourceSpatialReference:this.sourceSpatialReference,applyTransform:e}),r);return t}const{data:a}=await Object(k.executeQuery)(this.parsedUrl,s,this.sourceSpatialReference,r);return a}executeForCount(e,t){return Object(k.executeQueryForCount)(this.parsedUrl,this._normalizeQuery(e),{...this.requestOptions,...t}).then(e=>e.data.count)}executeForExtent(e,t){return Object(k.executeQueryForExtent)(this.parsedUrl,this._normalizeQuery(e),{...this.requestOptions,...t}).then(e=>({count:e.data.count,extent:i.a.fromJSON(e.data.extent)}))}executeForIds(e,t){return Object(k.executeQueryForIds)(this.parsedUrl,this._normalizeQuery(e),{...this.requestOptions,...t}).then(e=>e.data.objectIds)}executeRelationshipQuery(e,t){return e=d.a.from(e),(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),async function(e,t,r){const s=await T(e,t,r),a=s.data,n=a.geometryType,i=a.spatialReference,o={};for(const e of a.relatedRecordGroups){const t={fields:void 0,objectIdFieldName:void 0,geometryType:n,spatialReference:i,hasZ:!!a.hasZ,hasM:!!a.hasM,features:e.relatedRecords};if(null!=e.objectId)o[e.objectId]=t;else for(const r in e)e.hasOwnProperty(r)&&"relatedRecords"!==r&&(o[e[r]]=t)}return{...s,data:o}}(this.parsedUrl,e,{...this.requestOptions,...t}).then(e=>{const t=e.data,r={};return Object.keys(t).forEach(e=>r[e]=o.default.fromJSON(t[e])),r})}executeRelationshipQueryForCount(e,t){return e=d.a.from(e),(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),async function(e,t,r){const s=await T(e,t,r,{returnCountOnly:!0}),a=s.data,n={};for(const e of a.relatedRecordGroups)null!=e.objectId&&(n[e.objectId]=e.count);return{...s,data:n}}(this.parsedUrl,e,{...this.requestOptions,...t}).then(e=>e.data)}executeAttachmentQuery(e,t){return Object(I.a)(this.parsedUrl,c.a.from(e),{...this.requestOptions,...t}).then(e=>Object(I.b)(e.data.attachmentGroups,this.parsedUrl.path))}_normalizeQuery(e){const t=l.a.from(e);if(!this.gdbVersion&&!this.dynamicDataSource)return t;const r=t===e?t.clone():t;return r.gdbVersion=e.gdbVersion||this.gdbVersion,r.dynamicDataSource=e.dynamicDataSource?u.a.from(e.dynamicDataSource):this.dynamicDataSource,r}};Object(s.a)([Object(a.b)({type:u.a})],x.prototype,"dynamicDataSource",void 0),Object(s.a)([Object(a.b)()],x.prototype,"format",void 0),Object(s.a)([Object(a.b)()],x.prototype,"gdbVersion",void 0),Object(s.a)([Object(a.b)()],x.prototype,"sourceSpatialReference",void 0),x=Object(s.a)([Object(n.a)("esri.tasks.QueryTask")],x);var q=x;t.a=q},557:function(e,t,r){"use strict";r.r(t);var s=r(24),a=r(3),n=(r(20),r(8)),i=r(2),o=(r(7),r(9),r(26)),u=r(25),c=r(10),l=r(4),d=(r(41),r(5)),h=r(43),p=(r(42),r(96)),y=r(98),f=r(174),g=r(240),b=r(257);const m=Object(p.a)(["Feature Layer","Table"]);let O=class extends y.a{constructor(){super(...arguments),this.type="feature-layer"}load(e){const t=Object(i.h)(e)?e.signal:null;return this.addResolvingPromise(this._fetchService(t)),Object(d.r)(this)}get queryTask(){const{capabilities:{query:{supportsFormatPBF:e}},parsedUrl:t,dynamicDataSource:r,gdbVersion:s,spatialReference:n}=this.layer,i=Object(a.a)("featurelayer-pbf")&&e?"pbf":"json";return new b.a({url:t.path,format:i,dynamicDataSource:r,gdbVersion:s,sourceSpatialReference:n})}addAttachment(e,t){return this.load().then(()=>{const r=e.attributes[this.layer.objectIdField],s=this.layer.parsedUrl.path+"/"+r+"/addAttachment",a=this._getLayerRequestOptions(),n=this._getFormDataForAttachment(t,a);return Object(h.default)(s,{body:n}).then(e=>this._createFeatureEditResult(e.data.addAttachmentResult)).catch(e=>{throw this._createAttachmentErrorResult(r,e)})})}updateAttachment(e,t,r){return this.load().then(()=>{const s=e.attributes[this.layer.objectIdField],a=this.layer.parsedUrl.path+"/"+s+"/updateAttachment",n=this._getLayerRequestOptions({query:{attachmentId:t}}),i=this._getFormDataForAttachment(r,n);return Object(h.default)(a,{body:i}).then(e=>this._createFeatureEditResult(e.data.updateAttachmentResult)).catch(e=>{throw this._createAttachmentErrorResult(s,e)})})}async applyEdits(e,t){await this.load();const r=e.addFeatures.map(this._serializeFeature,this),s=e.updateFeatures.map(this._serializeFeature,this),a=this._getFeatureIds(e.deleteFeatures);Object(f.b)(r,s,this.layer.spatialReference);const n=[],i=[],o=[...e.deleteAttachments];for(const t of e.addAttachments)n.push(await this._serializeAttachment(t));for(const t of e.updateAttachments)i.push(await this._serializeAttachment(t));const u=n.length||i.length||o.length?{adds:n,updates:i,deletes:o}:null,c=this._getLayerRequestOptions({method:"post",query:{adds:r.length?JSON.stringify(r):null,updates:s.length?JSON.stringify(s):null,deletes:a.length?a.join(","):null,gdbVersion:null==t?void 0:t.gdbVersion,rollbackOnFailure:null==t?void 0:t.rollbackOnFailureEnabled,useGlobalIds:null==t?void 0:t.globalIdUsed,attachments:u&&JSON.stringify(u)}}),l=await Object(h.default)(this.layer.parsedUrl.path+"/applyEdits",c);return this._createEditsResult(l)}deleteAttachments(e,t){return this.load().then(()=>{const r=e.attributes[this.layer.objectIdField],s=this.layer.parsedUrl.path+"/"+r+"/deleteAttachments";return Object(h.default)(s,this._getLayerRequestOptions({query:{attachmentIds:t.join(",")},method:"post"})).then(e=>e.data.deleteAttachmentResults.map(this._createFeatureEditResult)).catch(e=>{throw this._createAttachmentErrorResult(r,e)})})}queryAttachments(e,t={}){const{parsedUrl:r}=this.layer,s=r.path;return this.load().then(()=>{const r=this._getLayerRequestOptions(t);if(!this.layer.get("capabilities.operations.supportsQueryAttachments")){const{objectIds:t}=e,a=[];for(const e of t){const t=s+"/"+e+"/attachments";a.push(Object(h.default)(t,r))}return Object(d.a)(a).then(e=>t.map((t,r)=>({parentObjectId:t,attachmentInfos:e[r].data.attachmentInfos}))).then(e=>Object(g.b)(e,s))}return this.queryTask.executeAttachmentQuery(e,r)})}queryFeatures(e,t){return this.load().then(()=>this.queryTask.execute(e,t))}queryFeaturesJSON(e,t){return this.load().then(()=>this.queryTask.executeJSON(e,t))}queryObjectIds(e,t){return this.load().then(()=>this.queryTask.executeForIds(e,t))}queryFeatureCount(e,t){return this.load().then(()=>this.queryTask.executeForCount(e,t))}queryExtent(e,t){return this.load().then(()=>this.queryTask.executeForExtent(e,t))}queryRelatedFeatures(e,t){return this.load().then(()=>this.queryTask.executeRelationshipQuery(e,t))}queryRelatedFeaturesCount(e,t){return this.load().then(()=>this.queryTask.executeRelationshipQueryForCount(e,t))}async _fetchService(e){const t=this.layer.sourceJSON;if(t)this.sourceJSON=t;else{const{data:t}=await Object(h.default)(this.layer.parsedUrl.path,this._getLayerRequestOptions({query:Object(a.a)("featurelayer-advanced-symbols")?{returnAdvancedSymbols:!0}:{},signal:e}));this.sourceJSON=t}const r=this.sourceJSON.type;if(!m.has(r))throw new c.a("feature-layer-source:unsupported-type",`Source type "${r}" is not supported`)}_serializeFeature(e){const{geometry:t,attributes:r}=e;return Object(i.g)(t)?{attributes:r}:"mesh"===t.type||"extent"===t.type?null:{geometry:t.toJSON(),attributes:r}}async _serializeAttachment(e){const{feature:t,attachment:r}=e,{globalId:s,name:a,contentType:n,data:i,uploadId:o}=r,u={globalId:s,parentGlobalId:null,contentType:null,name:null,uploadId:null,data:null};if(t&&(u.parentGlobalId="attributes"in t?t.attributes&&t.attributes[this.layer.globalIdField]:t.globalId),o)u.uploadId=o;else if(i){const e=await async function(e){return"string"==typeof e?Object(l.i)(e)||{data:e}:Object(d.f)((t,r)=>{const s=new FileReader;s.readAsDataURL(e),s.onload=()=>t(Object(l.i)(s.result)),s.onerror=e=>r(e)})}(i);u.contentType=e.mediaType,u.data=e.data,i instanceof File&&(u.name=i.name)}return a&&(u.name=a),n&&(u.contentType=n),u}_getFeatureIds(e){const t=e[0];return t?"objectId"in t?this._getIdsFromFeatureIdentifier(e):this._getIdsFromFeatures(e):[]}_getIdsFromFeatures(e){const t=this.layer.objectIdField;return e.map(e=>e.attributes&&e.attributes[t])}_getIdsFromFeatureIdentifier(e){return e.map(e=>e.objectId)}_createEditsResult(e){const t=e.data,r=e.data&&e.data.attachments;return{addFeatureResults:t.addResults?t.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:t.updateResults?t.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:t.deleteResults?t.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:r&&r.addResults?r.addResults.map(this._createFeatureEditResult,this):[],updateAttachmentResults:r&&r.updateResults?r.updateResults.map(this._createFeatureEditResult,this):[],deleteAttachmentResults:r&&r.deleteResults?r.deleteResults.map(this._createFeatureEditResult,this):[]}}_createFeatureEditResult(e){const t=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new c.a("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}_createAttachmentErrorResult(e,t){const r=t.details.messages&&t.details.messages[0]||t.message,s=t.details.httpStatus||t.details.messageCode;return{objectId:e,globalId:null,error:new c.a("feature-layer-source:attachment-failure",r,{code:s})}}_getFormDataForAttachment(e,t){const r=e instanceof FormData?e:e&&e.elements?new FormData(e):null;if(r)for(const e in t){const s=t[e];null!=s&&(r.set?r.set(e,s):r.append(e,s))}return r}_getLayerRequestOptions(e={}){const{parsedUrl:t,gdbVersion:r,dynamicDataSource:s}=this.layer;return{...e,query:Object(n.c)({gdbVersion:r,layer:s?JSON.stringify({source:s}):void 0,...t.query,f:"json",...null==e?void 0:e.query}),responseType:"json"}}};Object(s.a)([Object(o.b)()],O.prototype,"type",void 0),Object(s.a)([Object(o.b)({constructOnly:!0})],O.prototype,"layer",void 0),Object(s.a)([Object(o.b)({readOnly:!0,dependsOn:["layer.parsedUrl","layer.gdbVersion","layer.dynamicDataSource"]})],O.prototype,"queryTask",null),O=Object(s.a)([Object(u.a)("esri.layers.graphics.sources.FeatureLayerSource")],O);var j=O;t.default=j}});