self.webpackChunkRemoteClient([15,59],{113:function(e,t,i){"use strict";i.d(t,"a",(function(){return f})),i.d(t,"b",(function(){return v})),i.d(t,"c",(function(){return g})),i.d(t,"d",(function(){return y})),i.d(t,"e",(function(){return j})),i.d(t,"f",(function(){return m}));var r,n,a=i(3),s=i(7),o=i(14),l=(i(45),i(51)),c=i(519),d=function(e){r||function(e){if("WebkitTransition"in e.style)r="webkitTransitionEnd",n="webkitAnimationEnd";else{if(!("transition"in e.style))throw new Error("Your browser is not supported!");r="transitionend",n="animationend"}}(e)},u=function(e,t){return void 0===t&&(t=e+"-active"),function(i){d(i);var a=!1,s=function(o){a||(a=!0,i.removeEventListener(r,s),i.removeEventListener(n,s),i.classList.remove(e),i.classList.remove(t))};i.classList.add(e),i.addEventListener(r,s),i.addEventListener(n,s),requestAnimationFrame((function(){i.classList.add(t)}))}},h=function(e,t){return void 0===t&&(t=e+"-active"),function(i,a){d(i);var s=!1,o=function(e){s||(s=!0,i.removeEventListener(r,o),i.removeEventListener(n,o),a())};i.classList.add(e),i.addEventListener(r,o),i.addEventListener(n,o),requestAnimationFrame((function(){i.classList.add(t)}))}};const p=Object(a.a)("esri-debug-messages"),b=s.a.getLogger("esri.widgets.support.widgetUtils");function f(e){const t=l.a.acquire();for(let e=0;e<arguments.length;e++){const i=arguments[e],r=typeof i;if("string"===r)t.push(i);else if(Array.isArray(i))t.push.apply(t,i);else if("object"===r)for(const e in i)i[e]&&t.push(e)}const i=t.join(" ");return l.a.release(t),i}function y(){return"rtl"===document.dir}function g(e){const t=e.getAttribute("data-node-ref");if(p){if(!t)return void b.error("[Widget] node ref not found, did you forget the 'data-node-ref' attribute?");if(!(t in this))return void b.error(`[Widget] cannot discard ${t} if not defined on instance.`)}this[t]=null}function m(e){const t=e.getAttribute("data-node-ref");if(p){if(!t)return void b.error("[Widget] node ref not found, did you forget the 'data-node-ref' attribute?");if(!(t in this))return void b.error(`[Widget] cannot store ${t} if not defined on instance.`)}this[t]=e}function v(e,t){return("enter"===e?u:h)(t)}const O=["h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"].reduce((e,t)=>(e[t]=[],e),{}),_=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],j=new c.a({whiteList:O,onTagAttr:(e,t,i)=>{const r=`${t}="${i}"`;if(Object(o.e)(_,t))return r},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0)},144:function(e,t,i){"use strict";function r(e){const t={};for(const i in e){if("declaredClass"===i)continue;const n=e[i];if(null!=n&&"function"!=typeof n)if(Array.isArray(n)){t[i]=[];for(let e=0;e<n.length;e++)t[i][e]=r(n[e])}else"object"==typeof n?n.toJSON&&(t[i]=JSON.stringify(n)):t[i]=n}return t}i.d(t,"a",(function(){return r}))},169:function(e,t,i){"use strict";var r=i(3),n=i(27);const a=Object(r.a)("esri-text-decoder")?new TextDecoder("utf-8"):null,s=Object(r.a)("safari")||Object(r.a)("ios")?6:Object(r.a)("ff")?12:32;class o{constructor(e,t,i=0,r=(e?e.byteLength:0)){this._tag=0,this._dataType=99,this.init(e,t,i,r)}init(e,t,i,r){this._data=e,this._dataView=t,this._pos=i,this._end=r}clone(){return new o(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(e){this._pos=e}nextTag(e){for(;;){if(this._pos===this._end)return!1;const t=this._decodeVarint();if(this._tag=t>>3,this._dataType=7&t,!e||e===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const e=this._decodeVarint();return this._tag=e>>3,this._dataType=7&e,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let e=4294967295;return e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?e:(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?e:void 0))))}getUInt64(){return this._decodeVarint()}getSInt32(){const e=this.getUInt32();return e>>>1^-(1&e)|0}getSInt64(){return this._decodeSVarint()}getBool(){const e=0!==this._data[this._pos];return this._skip(1),e}getEnum(){return this._decodeVarint()}getFixed64(){const e=this._dataView,t=this._pos,i=e.getUint32(t,!0)+4294967296*e.getUint32(t+4,!0);return this._skip(8),i}getSFixed64(){const e=this._dataView,t=this._pos,i=e.getUint32(t,!0)+4294967296*e.getInt32(t+4,!0);return this._skip(8),i}getDouble(){const e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e}getFixed32(){const e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e}getSFixed32(){const e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e}getFloat(){const e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e}getString(){const e=this._getLength(),t=this._pos,i=this._toString(this._data,t,t+e);return this._skip(e),i}getBytes(){const e=this._getLength(),t=this._pos,i=this._toBytes(this._data,t,t+e);return this._skip(e),i}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(e,t,i,r){const n=this.getMessage(),a=e(n,t,i,r);return n.release(),a}processMessage(e){const t=this.getMessage(),i=e(t);return t.release(),i}getMessage(){const e=this._getLength(),t=o.pool.acquire();return t.init(this._data,this._dataView,this._pos,this._pos+e),this._skip(e),t}release(){o.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case 0:this._decodeVarint();break;case 1:this._skip(8);break;case 2:this._skip(this._getLength());break;case 5:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(e){this._skip(e)}_skip(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e}_decodeVarint(){const e=this._data;let t,i=this._pos,r=0;if(this._end-i>=10)do{if(t=e[i++],r|=127&t,0==(128&t))break;if(t=e[i++],r|=(127&t)<<7,0==(128&t))break;if(t=e[i++],r|=(127&t)<<14,0==(128&t))break;if(t=e[i++],r|=(127&t)<<21,0==(128&t))break;if(t=e[i++],r+=268435456*(127&t),0==(128&t))break;if(t=e[i++],r+=34359738368*(127&t),0==(128&t))break;if(t=e[i++],r+=4398046511104*(127&t),0==(128&t))break;if(t=e[i++],r+=562949953421312*(127&t),0==(128&t))break;if(t=e[i++],r+=72057594037927940*(127&t),0==(128&t))break;if(t=e[i++],r+=0x8000000000000000*(127&t),0==(128&t))break;throw new Error("Varint too long!")}while(0);else{let n=1;for(;i!==this._end&&(t=e[i],0!=(128&t));)++i,r+=(127&t)*n,n*=128;if(i===this._end)throw new Error("Varint overrun!");++i,r+=t*n}return this._pos=i,r}_decodeSVarint(){const e=this._decodeVarint();return e%2?-(e+1)/2:e/2}_getLength(){if(2!==this._dataType)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(e,t,i){if((i=Math.min(this._end,i))-t>s&&a){const r=e.subarray(t,i);return a.decode(r)}let r="",n="";for(let a=t;a<i;++a){const t=e[a];128&t?n+="%"+t.toString(16):(r+=decodeURIComponent(n)+String.fromCharCode(t),n="")}return n.length&&(r+=decodeURIComponent(n)),r}_toBytes(e,t,i){return i=Math.min(this._end,i),new Uint8Array(e.buffer,t,i-t)}}o.pool=new n.a(o,null,e=>{e._data=null,e._dataView=null}),t.a=o},174:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return o}));var r=i(89),n=i(110);function a(e,t,i){if(!t||!i||i.vcsWkid||Object(r.c)(t,i))return null;const a=Object(n.c)(t)/Object(n.c)(i);if(1===a)return null;switch(e){case"point":case"esriGeometryPoint":return e=>{return i=a,void((t=e)&&null!=t.z&&(t.z*=i));var t,i};case"polyline":case"esriGeometryPolyline":return e=>function(e,t){if(e)for(const i of e.paths)for(const e of i)e.length>2&&(e[2]*=t)}(e,a);case"polygon":case"esriGeometryPolygon":return e=>function(e,t){if(e)for(const i of e.rings)for(const e of i)e.length>2&&(e[2]*=t)}(e,a);case"multipoint":case"esriGeometryMultipoint":return e=>function(e,t){if(e)for(const i of e.points)i.length>2&&(i[2]*=t)}(e,a);default:return null}}function s(e,t,i){if(null==e.hasM||e.hasZ)for(const e of t)for(const t of e)t.length>2&&(t[2]*=i)}function o(e,t,i){if(!e&&!t||!i)return;const r=Object(n.c)(i);l(e,i,r),l(t,i,r)}function l(e,t,i){if(e)for(const r of e)c(r.geometry,t,i)}function c(e,t,i){if(!e||!e.spatialReference||Object(r.c)(e.spatialReference,t))return;const a=Object(n.c)(e.spatialReference)/i;if(1!==a)if("x"in e)null!=e.z&&(e.z*=a);else if("rings"in e)s(e,e.rings,a);else if("paths"in e)s(e,e.paths,a);else if("points"in e&&(null==e.hasM||e.hasZ))for(const t of e.points)t.length>2&&(t[2]*=a)}},181:function(e,t,i){"use strict";i.d(t,"a",(function(){return k})),i.d(t,"b",(function(){return d})),i.d(t,"c",(function(){return w}));var r=i(7),n=i(10),a=i(169);const s=r.a.getLogger("esri.tasks.operations.pbfFeatureServiceParser"),o=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],l=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],c=["upperLeft","lowerLeft"];function d(e){return e>=o.length?null:o[e]}function u(e){return e>=c.length?null:c[e]}function h(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function p(e,t,i){const r=t.createPointGeometry(i);for(;e.next();)switch(e.tag()){case 3:{const i=e.getUInt32(),n=e.pos()+i;let a=0;for(;e.pos()<n;)t.addCoordinatePoint(r,e.getSInt64(),a++);break}case 1:case 2:default:e.skip()}return r}function b(e,t,i){const r=t.createGeometry(i),n=2+(i.hasZ?1:0)+(i.hasM?1:0);for(;e.next();)switch(e.tag()){case 2:{const i=e.getUInt32(),n=e.pos()+i;let a=0;for(;e.pos()<n;)t.addLength(r,e.getUInt32(),a++);break}case 3:{const i=e.getUInt32(),a=e.pos()+i;let s=0;for(;e.pos()<a;)t.addCoordinate(r,e.getSInt64(),s),s++,s===n&&(s=0);break}case 1:default:e.skip()}return r}function f(e,t,i){var r;i.queryGeometry=t.createGeometry(i),i.queryGeometryType=h(t,0);let n=!1;for(;e.next();)switch(e.tag()){case 2:{const r=e.getUInt32(),n=e.pos()+r;let a=0;for(;e.pos()<n;)t.addLength(i.queryGeometry,e.getUInt32(),a++);break}case 3:{const r=e.getUInt32(),n=e.pos()+r;let a=0;for(;e.pos()<n;)t.addCoordinate(i.queryGeometry,e.getSInt64(),a),a++,2===a&&(a=0);break}case 1:i.queryGeometryType=h(t,e.getEnum()),n=!0;break;default:e.skip()}const a=null==(r=i.queryGeometry)?void 0:r.lengths;!n&&a&&a.length&&a[0]>1&&(i.queryGeometryType=h(t,3))}function y(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}function g(e){const t={type:d(0)};for(;e.next();)switch(e.tag()){case 1:t.name=e.getString();break;case 2:t.type=d(e.getEnum());break;case 3:t.alias=e.getString();break;case 4:t.sqlType=(i=e.getEnum())>=l.length?null:l[i];break;case 5:try{t.domain=JSON.parse(e.getString())}catch(e){s.error(new n.a("query:parsing-pbf","Failed to parse domain",{error:e})),t.domain=null}break;case 6:t.defaultValue=e.getString();break;default:e.skip()}var i;return t}function m(e){const t={};for(;e.next();)switch(e.tag()){case 1:t.name=e.getString();break;case 2:t.isSystemMaintained=e.getBool();break;default:e.skip()}return t}function v(e){const t={};for(;e.next();)switch(e.tag()){case 1:t.minServerGen=e.getUInt64();break;case 2:t.serverGen=e.getUInt64();break;default:e.skip()}return t}function O(e,t,i,r){const n=t.createFeature(i);let a=0;for(;e.next();)switch(e.tag()){case 1:{const t=r[a++].name;n.attributes[t]=e.processMessage(y);break}case 2:n.geometry=e.processMessageWithArgs(b,t,i);break;case 4:n.centroid=e.processMessageWithArgs(p,t,i);break;default:e.skip()}return n}function _(e){const t=[1,1,1,1];for(;e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function j(e){const t=[0,0,0,0];for(;e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function w(e){const t={originPosition:u(0)};for(;e.next();)switch(e.tag()){case 1:t.originPosition=u(e.getEnum());break;case 2:t.scale=e.processMessage(_);break;case 3:t.translate=e.processMessage(j);break;default:e.skip()}return t}function M(e){const t={};for(;e.next();)switch(e.tag()){case 1:t.shapeAreaFieldName=e.getString();break;case 2:t.shapeLengthFieldName=e.getString();break;case 3:t.units=e.getString();break;default:e.skip()}return t}function I(e,t){const i=t.createSpatialReference();for(;e.next();)switch(e.tag()){case 1:i.wkid=e.getUInt32();break;case 5:i.wkt=e.getString();break;case 2:i.latestWkid=e.getUInt32();break;case 3:i.vcsWkid=e.getUInt32();break;case 4:i.latestVcsWkid=e.getUInt32();break;default:e.skip()}return i}function T(e,t){const i=t.createFeatureResult();i.geometryType=h(t,0);let r=!1;for(;e.next();)switch(e.tag()){case 1:i.objectIdFieldName=e.getString();break;case 3:i.globalIdFieldName=e.getString();break;case 4:i.geohashFieldName=e.getString();break;case 5:i.geometryProperties=e.processMessage(M);break;case 7:i.geometryType=h(t,e.getEnum());break;case 8:i.spatialReference=e.processMessageWithArgs(I,t);break;case 10:i.hasZ=e.getBool();break;case 11:i.hasM=e.getBool();break;case 12:i.transform=e.processMessage(w);break;case 9:{const t=e.getBool();i.exceededTransferLimit=t;break}case 13:t.addField(i,e.processMessage(g));break;case 15:r||(t.prepareFeatures(i),r=!0),t.addFeature(i,e.processMessageWithArgs(O,t,i,i.fields));break;case 2:i.uniqueIdField=e.processMessage(m);break;case 6:i.serverGens=e.processMessage(v);break;default:e.skip()}return t.finishFeatureResult(i),i}function C(e,t){const i={};for(;e.next();)switch(e.tag()){case 4:e.processMessageWithArgs(f,t,i);break;case 1:i.featureResult=e.processMessageWithArgs(T,t);break;case 2:case 3:default:e.skip()}return i}function k(e,t){try{const i=2,r=new a.a(new Uint8Array(e),new DataView(e)),n={};for(;r.next();)switch(r.tag()){case i:n.queryResult=r.processMessageWithArgs(C,t);break;default:r.skip()}return n}catch(e){const i=new n.a("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e});return s.error(i),{queryResult:{featureResult:t.createFeatureResult()}}}}},183:function(e,t,i){"use strict";i.r(t),i.d(t,"executeQuery",(function(){return p})),i.d(t,"executeQueryForCount",(function(){return g})),i.d(t,"executeQueryForExtent",(function(){return m})),i.d(t,"executeQueryForIds",(function(){return y})),i.d(t,"executeQueryPBF",(function(){return b})),i.d(t,"executeQueryPBFBuffer",(function(){return f})),i.d(t,"queryToQueryStringParameters",(function(){return h})),i.d(t,"runQuery",(function(){return v}));i(20);var r=i(2),n=i(4),a=i(5),s=i(43),o=i(73),l=i(178),c=i(224),d=i(187),u=i(144);function h(e,t){const i=e.geometry,r=e.toJSON(),n=r;if(i&&(n.geometry=JSON.stringify(i),n.geometryType=Object(o.c)(i),n.inSR=i.spatialReference.wkid||JSON.stringify(i.spatialReference)),r.groupByFieldsForStatistics&&(n.groupByFieldsForStatistics=r.groupByFieldsForStatistics.join(",")),r.objectIds&&(n.objectIds=r.objectIds.join(",")),r.orderByFields&&(n.orderByFields=r.orderByFields.join(",")),!r.outFields||!r.returnDistinctValues&&((null==t?void 0:t.returnCountOnly)||(null==t?void 0:t.returnExtentOnly)||(null==t?void 0:t.returnIdsOnly))?delete n.outFields:-1!==r.outFields.indexOf("*")?n.outFields="*":n.outFields=r.outFields.join(","),r.outSR?n.outSR=r.outSR.wkid||JSON.stringify(r.outSR):i&&(r.returnGeometry||r.returnCentroid)&&(n.outSR=n.inSR),r.returnGeometry&&delete r.returnGeometry,r.outStatistics&&(n.outStatistics=JSON.stringify(r.outStatistics)),r.pixelSize&&(n.pixelSize=JSON.stringify(r.pixelSize)),r.quantizationParameters&&(n.quantizationParameters=JSON.stringify(r.quantizationParameters)),r.parameterValues&&(n.parameterValues=JSON.stringify(r.parameterValues)),r.rangeValues&&(n.rangeValues=JSON.stringify(r.rangeValues)),r.dynamicDataSource&&(n.layer=JSON.stringify({source:r.dynamicDataSource}),delete r.dynamicDataSource),r.timeExtent){const e=r.timeExtent,{start:t,end:i}=e;null==t&&null==i||(n.time=t===i?t:`${null==t?"null":t},${null==i?"null":i}`),delete r.timeExtent}return n}async function p(e,t,i,r){var n;const a=(null==(n=t.timeExtent)?void 0:n.isEmpty)?{data:{features:[]}}:await v(e,t,"json",r);return Object(c.a)(t,i,a.data),a}async function b(e,t,i,r){var n;if(null==(n=t.timeExtent)?void 0:n.isEmpty)return Object(a.r)({data:i.createFeatureResult()});const s=await f(e,t,r),o=s;return o.data=Object(d.a)(s.data,i),o}function f(e,t,i){return v(e,t,"pbf",i)}function y(e,t,i){var r;return(null==(r=t.timeExtent)?void 0:r.isEmpty)?Object(a.r)({data:{objectIds:[]}}):v(e,t,"json",i,{returnIdsOnly:!0})}function g(e,t,i){var r;return(null==(r=t.timeExtent)?void 0:r.isEmpty)?Object(a.r)({data:{count:0}}):v(e,t,"json",i,{returnIdsOnly:!0,returnCountOnly:!0})}function m(e,t,i){var r;return(null==(r=t.timeExtent)?void 0:r.isEmpty)?Object(a.r)({data:{count:0,extent:null}}):v(e,t,"json",i,{returnExtentOnly:!0,returnCountOnly:!0}).then(e=>{const t=e.data;if(t.hasOwnProperty("extent"))return e;if(t.features)throw new Error("Layer does not support extent calculation.");if(t.hasOwnProperty("count"))throw new Error("Layer does not support extent calculation.");return e})}function v(e,t,i,a={},o){const c="string"==typeof e?Object(n.H)(e):e,d=t.geometry?[t.geometry]:[];return a.responseType="pbf"===i?"array-buffer":"json",Object(l.a)(d,null,a).then(e=>{const l=e&&e[0];Object(r.h)(l)&&((t=t.clone()).geometry=l);const d=Object(u.a)({...c.query,f:i,...o,...h(t,o)});return Object(s.default)(Object(n.w)(c.path,"query"),{...a,query:{...a.query,...d}})})}},187:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(181);function n(e,t){const i=Object(r.a)(e,t),n=i.queryResult.featureResult,a=i.queryResult.queryGeometry,s=i.queryResult.queryGeometryType;if(n&&n.features&&n.features.length&&n.objectIdFieldName){const e=n.objectIdFieldName;for(const t of n.features)t.attributes&&(t.objectId=t.attributes[e])}return n&&(n.queryGeometry=a,n.queryGeometryType=s),n}},189:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=function(e,t){for(var i=0,n=e.length;i<n;i++){var a=e[i];Array.isArray(a)?r(a,t):null!=a&&!1!==a&&(a.hasOwnProperty("vnodeSelector")||(a={vnodeSelector:"",properties:void 0,children:void 0,text:a.toString(),domNode:null}),t.push(a))}},n=function(e,t){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];if(1===i.length&&"string"==typeof i[0])return{vnodeSelector:e,properties:t||void 0,children:void 0,text:i[0],domNode:null};var a=[];return r(i,a),{vnodeSelector:e,properties:t||void 0,children:a,text:void 0,domNode:null}}},200:function(e,t,i){"use strict";var r,n=i(24),a=(i(3),i(20),i(7),i(9),i(26)),s=i(25),o=(i(4),i(41),i(42),i(65)),l=i(84);let c=r=class extends o.a{constructor(e){super(e),this.value=0,this.unit="milliseconds"}toMilliseconds(){return this.value*l.a[this.unit]}clone(){return new r({value:this.value,unit:this.unit})}};Object(n.a)([Object(a.b)({type:Number,json:{write:!0},nonNullable:!0})],c.prototype,"value",void 0),Object(n.a)([Object(a.b)({type:l.c.apiValues,json:{type:l.c.jsonValues,read:l.c.read,write:l.c.write},nonNullable:!0})],c.prototype,"unit",void 0),c=r=Object(n.a)([Object(s.a)("esri.TimeInterval")],c);var d=c;t.a=d},201:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(360);function n(e){const t="string"==typeof e?Object(r.b)(e):e;return function(e,i){e.hasOwnProperty("_renderableProps")||(e._renderableProps=e._renderableProps?e._renderableProps.slice():[]);const n=e._renderableProps;t?n.push.apply(n,Object(r.a)(t,i)):n.push(i)}}},215:function(e,t,i){"use strict";function r(e){return function(t,i){t.hasOwnProperty("_messageBundleProps")||(t._messageBundleProps=t._messageBundleProps?t._messageBundleProps.slice():[]),t._messageBundleProps.push({bundlePath:e,propertyName:i})}}i.d(t,"a",(function(){return r}))},216:function(e,t,i){"use strict";class r{constructor(e){this._node=e}add(e){const{_node:t}=this;t.className.baseVal=`${t.className.baseVal} ${e}`.trim()}contains(e){return this._node.className.baseVal.split(" ").indexOf(e)>-1}remove(e){const{_node:t}=this;let i="";for(const r of t.className.baseVal.split(" "))r!==e&&(i+=r+" ");t.className.baseVal=i.trim()}toggle(e,t){const i=this.contains(e);let r;return r=i?!0!==t&&"remove":!1!==t&&"add",r&&this[r](e),void 0!==t?t:!i}}"classList"in SVGElement.prototype||Object.defineProperty(SVGElement.prototype,"classList",{get(){return new r(this)}})},224:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(174);function n(e,t,i){if(!i||!i.features||!i.hasZ)return;const n=Object(r.a)(i.geometryType,t,e.outSpatialReference);if(n)for(const e of i.features)n(e.geometry)}},225:function(e,t,i){"use strict";var r,n=i(24),a=(i(3),i(20),i(7),i(9),i(26)),s=i(67),o=i(68),l=i(47),c=i(25),d=i(66),u=(i(4),i(41),i(42),i(21)),h=i(65),p=i(110);const b=Object(s.b)()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),f=b.jsonValues.slice();Object(u.h)(f,"orthometric");const y=Object(s.b)()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let g=r=class extends h.a{constructor(e){super(e),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(e,t,i){return b.write(e,t,i)}readHeightModel(e,t,i){return b.read(e)||(i&&i.messages&&i.messages.push(function(e,t){return new l.a("height-model:unsupported",`Height model of value '${e}' is not supported`,t)}(e,{context:i})),null)}readHeightUnit(e,t,i){return y.read(e)||(i&&i.messages&&i.messages.push(m(e,{context:i})),null)}readHeightUnitService(e,t,i){return Object(p.n)(e)||y.read(e)||(i&&i.messages&&i.messages.push(m(e,{context:i})),null)}readVertCRS(e,t){return t.vertCRS||t.ellipsoid||t.geoid}clone(){return new r({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(e){return!!e&&(this===e||this.heightModel===e.heightModel&&this.heightUnit===e.heightUnit&&this.vertCRS===e.vertCRS)}static deriveUnitFromSR(e,t){const i=Object(p.e)(t);return new r({heightModel:e.heightModel,heightUnit:i,vertCRS:e.vertCRS})}write(e,t){return t={origin:"web-scene",...t},super.write(e,t)}static fromJSON(e){if(!e)return null;const t=new r;return t.read(e,{origin:"web-scene"}),t}};function m(e,t){return new l.a("height-unit:unsupported",`Height unit of value '${e}' is not supported`,t)}Object(n.a)([Object(a.b)({type:b.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:f,default:"ellipsoidal"}}}})],g.prototype,"heightModel",void 0),Object(n.a)([Object(d.a)("web-scene","heightModel")],g.prototype,"writeHeightModel",null),Object(n.a)([Object(o.a)(["web-scene","service"],"heightModel")],g.prototype,"readHeightModel",null),Object(n.a)([Object(a.b)({type:y.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:y.jsonValues,write:y.write}}}})],g.prototype,"heightUnit",void 0),Object(n.a)([Object(o.a)("web-scene","heightUnit")],g.prototype,"readHeightUnit",null),Object(n.a)([Object(o.a)("service","heightUnit")],g.prototype,"readHeightUnitService",null),Object(n.a)([Object(a.b)({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],g.prototype,"vertCRS",void 0),Object(n.a)([Object(o.a)("service","vertCRS",["vertCRS","ellipsoid","geoid"])],g.prototype,"readVertCRS",null),g=r=Object(n.a)([Object(c.a)("esri.geometry.HeightModelInfo")],g);var v=g;t.a=v},234:function(e,t,i){"use strict";var r,n=i(24),a=(i(3),i(20),i(8)),s=(i(7),i(9)),o=i(26),l=i(25),c=i(66),d=(i(4),i(41),i(42),i(65)),u=i(71),h=(i(72),i(103));let p=r=class extends d.a{constructor(e){super(e),this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,t.where="1=1"}clone(){return new r(Object(a.a)({dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};Object(n.a)([Object(o.b)({type:h.a,json:{write:!0}})],p.prototype,"dynamicDataSource",void 0),Object(n.a)([Object(o.b)({type:String,json:{write:!0}})],p.prototype,"gdbVersion",void 0),Object(n.a)([Object(o.b)({type:Number,json:{write:!0}})],p.prototype,"geometryPrecision",void 0),Object(n.a)([Object(o.b)({type:Date})],p.prototype,"historicMoment",void 0),Object(n.a)([Object(c.a)("historicMoment")],p.prototype,"_writeHistoricMoment",null),Object(n.a)([Object(o.b)({type:Number,json:{write:!0}})],p.prototype,"maxAllowableOffset",void 0),Object(n.a)([Object(o.b)({type:[Number],json:{write:!0}})],p.prototype,"objectIds",void 0),Object(n.a)([Object(o.b)({type:[String],json:{write:!0}})],p.prototype,"orderByFields",void 0),Object(n.a)([Object(o.b)({type:[String],json:{write:!0}})],p.prototype,"outFields",void 0),Object(n.a)([Object(o.b)({type:u.a,json:{read:{source:"outSR"},write:{target:"outSR"}}})],p.prototype,"outSpatialReference",void 0),Object(n.a)([Object(o.b)({json:{write:!0}})],p.prototype,"relationshipId",void 0),Object(n.a)([Object(o.b)({type:Number,json:{read:{source:"resultOffset"}}})],p.prototype,"start",void 0),Object(n.a)([Object(c.a)("start"),Object(c.a)("num")],p.prototype,"writeStart",null),Object(n.a)([Object(o.b)({type:Number,json:{read:{source:"resultRecordCount"}}})],p.prototype,"num",void 0),Object(n.a)([Object(o.b)({json:{write:!0}})],p.prototype,"returnGeometry",void 0),Object(n.a)([Object(o.b)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],p.prototype,"returnM",void 0),Object(n.a)([Object(o.b)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],p.prototype,"returnZ",void 0),Object(n.a)([Object(o.b)({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],p.prototype,"where",void 0),p=r=Object(n.a)([Object(l.a)("esri.tasks.support.RelationshipQuery")],p),p.from=Object(s.m)(p);var b=p;t.a=b},235:function(e,t,i){"use strict";var r=i(24),n=(i(3),i(20),i(7)),a=i(26),s=i(75),o=i(25),l=(i(4),i(41),i(5)),c=(i(42),i(112)),d=i(74),u=i(102),h=(i(122),i(125),i(160),i(154)),p=i(223),b=i(97),f=i(46),y=i(414),g=i(113),m=(i(308),i(452));i(216);const v=n.a.getLogger("esri.widgets.Widget");let O=0;const _=Object(m.a)();let j=class extends(Object(p.b)(c.a.EventedAccessor)){constructor(e,t){super(e,t),this._attached=!1,this._internalHandles=new b.a,this._projector=_,this.domNode=null,this.iconClass="esri-icon-checkbox-unchecked",this.label=this.declaredClass.split(".").pop(),this.visible=!0,this._loadLocale=Object(l.n)(async()=>{this._messageBundleProps&&this._messageBundleProps.length&&await Object(l.m)(this._messageBundleProps.map(async({bundlePath:e,propertyName:t})=>{this[t]=await Object(h.a)(e)})).then(e=>{for(const t of e)t.error&&v.error("widget-intl:locale-error",this.declaredClass,t.error)}),await this.loadLocale()});const i="esri-widget-uid-"+Date.now().toString(16),r=this.render.bind(this);let n=!1;this.render=()=>{if(!n||this.destroyed)return null;const e=r();return e.properties?e.properties.key||(e.properties.key=i):e.properties={key:i},e},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then(()=>{n=!0,this._postInitialize()}))}normalizeCtorArgs(e,t){const i={...e};return t&&(i.container=t),i}postInitialize(){}beforeFirstRender(){return this._loadLocale()}async loadLocale(){}destroy(){this.destroyed||(this.viewModel&&(this.viewModel.destroy(),this.viewModel=null),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null)}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return Object(y.a)(e)}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+O++}set id(e){e&&this._set("id",e)}get renderable(){return this._resourcesFetch}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||this._projector.scheduleRender()}classes(...e){return g.a.apply(this,e)}own(e){arguments.length>1&&(e=Array.prototype.slice.call(arguments)),this._internalHandles.add(e)}renderNow(){this._projector.renderNow()}_postInitialize(){var e,t;this.destroyed||((null==(e=this._renderableProps)?void 0:e.length)&&this._internalHandles.add(this._renderableProps.map(e=>Object(f.a)(this,e,(function(t,i){if(d.a.isCollection(i)&&this._internalHandles.remove(`${this.declaredClass}:${e}-collection-change-event-listener`),d.a.isCollection(t)){const i=t.on("change",()=>this.scheduleRender());this._internalHandles.add(i,`${this.declaredClass}:${e}-collection-change-event-listener`)}this.scheduleRender()})))),(null==(t=this._delegatedEventNames)?void 0:t.length)&&this._internalHandles.add(Object(f.a)(this,"viewModel",(e,t)=>{t&&this._internalHandles.remove("delegated-events"),e&&this._internalHandles.add(this._delegatedEventNames.map(t=>e.on(t,e=>{this.emit(t,e)})),"delegated-events")})),this.postInitialize(),this._internalHandles.add(Object(u.c)(async()=>{await this._loadLocale(),this.scheduleRender()})),this._internalHandles.add(Object(f.h)(this,"container",async e=>{this.destroyed||this._attach(e)})))}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){e&&this._attached&&(this._projector.detach(this.render),e.parentNode&&e.parentNode.removeChild(e),this._attached=!1)}};Object(r.a)([Object(a.b)({value:null})],j.prototype,"container",null),Object(r.a)([Object(s.a)("container")],j.prototype,"castContainer",null),Object(r.a)([Object(a.b)({aliasOf:"container"})],j.prototype,"domNode",void 0),Object(r.a)([Object(a.b)()],j.prototype,"iconClass",void 0),Object(r.a)([Object(a.b)({dependsOn:["container"]})],j.prototype,"id",null),Object(r.a)([Object(a.b)()],j.prototype,"label",void 0),Object(r.a)([Object(a.b)()],j.prototype,"renderable",null),Object(r.a)([Object(a.b)()],j.prototype,"viewModel",void 0),Object(r.a)([Object(a.b)()],j.prototype,"visible",void 0),j=Object(r.a)([Object(o.a)("esri.widgets.Widget")],j);var w=j;t.a=w},237:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return l}));var r=i(2),n=i(74),a=i(98),s=i(177);async function o(e,t){return await e.load(),l(e,t)}async function l(e,t){const i=[],o=(...e)=>{for(const t of e)Object(r.g)(t)||(Array.isArray(t)?o(...t):n.a.isCollection(t)?t.forEach(e=>o(e)):a.a.isLoadable(t)&&i.push(t))};t(o);let l=null;if(await Object(s.b)(i,async e=>{var t;!1!==(await Object(s.c)((t=e,"loadAll"in t&&"function"==typeof t.loadAll?e.loadAll():e.load()))).ok||l||(l=e)}),l)throw l.loadError;return e}},239:function(e,t,i){"use strict";var r,n=i(24),a=(i(3),i(20),i(8)),s=(i(7),i(9),i(26)),o=i(68),l=i(25),c=i(66),d=(i(4),i(41),i(42),i(65)),u=i(84),h=i(81),p=i(200);let b=r=class extends d.a{constructor(e){super(e),this.respectsDaylightSaving=!1,this.timezone=null}readRespectsDaylightSaving(e,t){return void 0!==t.respectsDaylightSaving?t.respectsDaylightSaving:void 0!==t.respectDaylightSaving&&t.respectDaylightSaving}clone(){const{respectsDaylightSaving:e,timezone:t}=this;return new r({respectsDaylightSaving:e,timezone:t})}};Object(n.a)([Object(s.b)({type:Boolean,json:{write:!0}})],b.prototype,"respectsDaylightSaving",void 0),Object(n.a)([Object(o.a)("respectsDaylightSaving",["respectsDaylightSaving","respectDaylightSaving"])],b.prototype,"readRespectsDaylightSaving",null),Object(n.a)([Object(s.b)({type:String,json:{read:{source:"timeZone"},write:{target:"timeZone"}}})],b.prototype,"timezone",void 0),b=r=Object(n.a)([Object(l.a)("esri.layers.support.TimeReference")],b);var f,y=b;let g=f=class extends d.a{constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeReference=null,this.trackIdField=null,this.useTime=!0}readFullTimeExtent(e,t){if(!t.timeExtent||!Array.isArray(t.timeExtent)||2!==t.timeExtent.length)return null;const i=new Date(t.timeExtent[0]),r=new Date(t.timeExtent[1]);return new h.a({start:i,end:r})}writeFullTimeExtent(e,t){e&&e.start&&e.end?t.timeExtent=[e.start.getTime(),e.end.getTime()]:t.timeExtent=null}readInterval(e,t){return t.timeInterval&&t.timeIntervalUnits?new p.a({value:t.timeInterval,unit:u.c.fromJSON(t.timeIntervalUnits)}):t.defaultTimeInterval&&t.defaultTimeIntervalUnits?new p.a({value:t.defaultTimeInterval,unit:u.c.fromJSON(t.defaultTimeIntervalUnits)}):null}writeInterval(e,t){if(e){const i=e.toJSON();t.timeInterval=i.value,t.timeIntervalUnits=i.unit}else t.timeInterval=null,t.timeIntervalUnits=null}clone(){const{cumulative:e,endField:t,hasLiveData:i,interval:r,startField:n,timeReference:s,fullTimeExtent:o,trackIdField:l,useTime:c}=this;return new f({cumulative:e,endField:t,hasLiveData:i,interval:r,startField:n,timeReference:Object(a.a)(s),fullTimeExtent:Object(a.a)(o),trackIdField:l,useTime:c})}};Object(n.a)([Object(s.b)({type:Boolean,json:{read:{source:"exportOptions.timeDataCumulative"},write:{target:"exportOptions.timeDataCumulative"}}})],g.prototype,"cumulative",void 0),Object(n.a)([Object(s.b)({type:String,json:{read:{source:"endTimeField"},write:{target:"endTimeField",allowNull:!0}}})],g.prototype,"endField",void 0),Object(n.a)([Object(s.b)({type:h.a,json:{write:{enabled:!0,allowNull:!0}}})],g.prototype,"fullTimeExtent",void 0),Object(n.a)([Object(o.a)("fullTimeExtent",["timeExtent"])],g.prototype,"readFullTimeExtent",null),Object(n.a)([Object(c.a)("fullTimeExtent")],g.prototype,"writeFullTimeExtent",null),Object(n.a)([Object(s.b)({type:Boolean,json:{write:!0}})],g.prototype,"hasLiveData",void 0),Object(n.a)([Object(s.b)({type:p.a,json:{write:{enabled:!0,allowNull:!0}}})],g.prototype,"interval",void 0),Object(n.a)([Object(o.a)("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],g.prototype,"readInterval",null),Object(n.a)([Object(c.a)("interval")],g.prototype,"writeInterval",null),Object(n.a)([Object(s.b)({type:String,json:{read:{source:"startTimeField"},write:{target:"startTimeField",allowNull:!0}}})],g.prototype,"startField",void 0),Object(n.a)([Object(s.b)({type:y,json:{write:{enabled:!0,allowNull:!0}}})],g.prototype,"timeReference",void 0),Object(n.a)([Object(s.b)({type:String,json:{write:{enabled:!0,allowNull:!0}}})],g.prototype,"trackIdField",void 0),Object(n.a)([Object(s.b)({type:Boolean,json:{read:{source:"exportOptions.useTime"},write:{target:"exportOptions.useTime"}}})],g.prototype,"useTime",void 0),g=f=Object(n.a)([Object(l.a)("esri.layers.support.TimeInfo")],g);var m=g;t.a=m},240:function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return d}));var r=i(4),n=i(43),a=i(144),s=i(12);function o(e){const t=s.a&&s.a.findCredential(e);return t&&t.token?Object(r.d)(e,"token",t.token):e}var l=i(241);function c(e){const t=e.toJSON();return t.attachmentTypes&&(t.attachmentTypes=t.attachmentTypes.join(",")),t.keywords&&(t.keywords=t.keywords.join(",")),t.globalIds&&(t.globalIds=t.globalIds.join(",")),t.objectIds&&(t.objectIds=t.objectIds.join(",")),t.size&&(t.size=t.size.join(",")),t}function d(e,t){const i={};for(const n of e){const{parentObjectId:e,parentGlobalId:a,attachmentInfos:s}=n;for(const n of s){const{id:s}=n,c=Object(r.b)(o(`${t}/${e}/attachments/${s}`)),d=l.a.fromJSON(n);d.set({url:c,parentObjectId:e,parentGlobalId:a}),i[e]?i[e].push(d):i[e]=[d]}}return i}function u(e,t,i){let r={query:Object(a.a)({...e.query,f:"json",...c(t)})};return i&&(r={...i,...r}),Object(n.default)(e.path+"/queryAttachments",r)}},241:function(e,t,i){"use strict";var r,n=i(24),a=(i(3),i(20),i(7),i(9)),s=i(26),o=i(25),l=(i(4),i(41),i(42),i(65)),c=i(14);i(45);const d={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let u=r=class extends l.a{constructor(e){super(e),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:e}=this,t=function(e){const{exifInfo:t,exifName:i,tagName:r}=e;if(!t||!i||!r)return null;const n=Object(c.d)(t,e=>e.name===i);return n?function(e){const{tagName:t,tags:i}=e;if(!i||!t)return null;const r=Object(c.d)(i,e=>e.name===t);return r&&r.value||null}({tagName:r,tags:n.tags}):null}({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:e});return d[t]||null}clone(){return new r({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};Object(n.a)([Object(s.b)({type:String})],u.prototype,"contentType",void 0),Object(n.a)([Object(s.b)()],u.prototype,"exifInfo",void 0),Object(n.a)([Object(s.b)({readOnly:!0,dependsOn:["exifInfo"]})],u.prototype,"orientationInfo",null),Object(n.a)([Object(s.b)({type:a.a})],u.prototype,"id",void 0),Object(n.a)([Object(s.b)({type:String})],u.prototype,"globalId",void 0),Object(n.a)([Object(s.b)({type:String})],u.prototype,"keywords",void 0),Object(n.a)([Object(s.b)({type:String})],u.prototype,"name",void 0),Object(n.a)([Object(s.b)({json:{read:!1}})],u.prototype,"parentGlobalId",void 0),Object(n.a)([Object(s.b)({json:{read:!1}})],u.prototype,"parentObjectId",void 0),Object(n.a)([Object(s.b)({type:a.a})],u.prototype,"size",void 0),Object(n.a)([Object(s.b)({json:{read:!1}})],u.prototype,"url",void 0),u=r=Object(n.a)([Object(o.a)("esri.layers.support.AttachmentInfo")],u);var h=u;t.a=h},248:function(e,t,i){"use strict";i.d(t,"a",(function(){return h}));var r=i(24),n=(i(3),i(20),i(7),i(9),i(26)),a=i(68),s=i(25),o=(i(4),i(41),i(42),i(82)),l=i(84),c=i(81),d=i(200),u=i(239);const h=e=>{let t=class extends e{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(e,t){const i=t.timeInfo.exportOptions;if(!i)return null;const r=i.timeOffset,n=l.c.fromJSON(i.timeOffsetUnits);return r&&n?new d.a({value:r,unit:n}):null}set timeInfo(e){Object(o.g)(e,this.fields),this._set("timeInfo",e)}};return Object(r.a)([Object(n.b)({type:c.a,json:{write:!1}})],t.prototype,"timeExtent",void 0),Object(r.a)([Object(n.b)({type:d.a})],t.prototype,"timeOffset",void 0),Object(r.a)([Object(a.a)("service","timeOffset",["timeInfo.exportOptions"])],t.prototype,"readOffset",null),Object(r.a)([Object(n.b)({value:null,type:u.a,json:{write:!0,origins:{"web-document":{read:!1,write:!1}}}})],t.prototype,"timeInfo",null),Object(r.a)([Object(n.b)({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],t.prototype,"useViewTime",void 0),t=Object(r.a)([Object(s.a)("esri.layers.mixins.TemporalLayer")],t),t}},249:function(e,t,i){"use strict";var r,n=i(24),a=(i(3),i(20),i(8)),s=(i(7),i(9)),o=i(26),l=i(25),c=i(66),d=(i(4),i(41),i(42),i(65));let u=r=class extends d.a{constructor(e){super(e),this.attachmentTypes=null,this.attachmentsWhere=null,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new r(Object(a.a)({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};Object(n.a)([Object(o.b)({type:[String],json:{write:!0}})],u.prototype,"attachmentTypes",void 0),Object(n.a)([Object(o.b)({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],u.prototype,"attachmentsWhere",void 0),Object(n.a)([Object(o.b)({type:[String],json:{write:!0}})],u.prototype,"keywords",void 0),Object(n.a)([Object(o.b)({type:[Number],json:{write:!0}})],u.prototype,"globalIds",void 0),Object(n.a)([Object(o.b)({json:{write:!0}})],u.prototype,"name",void 0),Object(n.a)([Object(o.b)({type:Number,json:{read:{source:"resultRecordCount"}}})],u.prototype,"num",void 0),Object(n.a)([Object(o.b)({type:[Number],json:{write:!0}})],u.prototype,"objectIds",void 0),Object(n.a)([Object(o.b)({type:Boolean,json:{default:!1,write:!0}})],u.prototype,"returnMetadata",void 0),Object(n.a)([Object(o.b)({type:[Number],json:{write:!0}})],u.prototype,"size",void 0),Object(n.a)([Object(o.b)({type:Number,json:{read:{source:"resultOffset"}}})],u.prototype,"start",void 0),Object(n.a)([Object(c.a)("start"),Object(c.a)("num")],u.prototype,"writeStart",null),Object(n.a)([Object(o.b)({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],u.prototype,"where",void 0),u=r=Object(n.a)([Object(l.a)("esri.tasks.support.AttachmentQuery")],u),u.from=Object(s.m)(u);var h=u;t.a=h},257:function(e,t,i){"use strict";var r=i(24),n=(i(3),i(20),i(7),i(9),i(26)),a=i(25),s=(i(4),i(41),i(42),i(70)),o=(i(72),i(140)),l=i(103),c=i(249),d=i(108),u=i(234),h=i(141),p=i(37),b=i(174);function f(e,t){return t}function y(e,t,i,r){switch(i){case 0:return O(e,t+r,0);case 1:return"lowerLeft"===e.originPosition?O(e,t+r,1):function({translate:e,scale:t},i,r){return e[r]-i*t[r]}(e,t+r,1)}}function g(e,t,i,r){switch(i){case 2:return O(e,t,2);default:return y(e,t,i,r)}}function m(e,t,i,r){switch(i){case 2:return O(e,t,3);default:return y(e,t,i,r)}}function v(e,t,i,r){switch(i){case 3:return O(e,t,3);default:return g(e,t,i,r)}}function O({translate:e,scale:t},i,r){return e[r]+i*t[r]}class _{constructor(e){this.options=e,this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],this.previousCoordinate=[0,0],this.transform=null,this.applyTransform=f,this.lengths=[],this.currentLengthIndex=0,this.toAddInCurrentPath=0,this.vertexDimension=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,this.AttributesConstructor=function(){}}createFeatureResult(){return{fields:[],features:[]}}finishFeatureResult(e){if(this.options.applyTransform&&(e.transform=null),this.AttributesConstructor=function(){},this.coordinateBuffer=null,this.lengths.length=0,!e.hasZ)return;const t=Object(b.a)(e.geometryType,this.options.sourceSpatialReference,e.spatialReference);if(t)for(const i of e.features)t(i.geometry)}createSpatialReference(){return{}}addField(e,t){e.fields.push(t);const i=e.fields.map(e=>e.name);this.AttributesConstructor=function(){for(const e of i)this[e]=null}}addFeature(e,t){e.features.push(t)}prepareFeatures(e){switch(this.options.applyTransform&&e.transform&&(this.transform=e.transform,this.applyTransform=this.deriveApplyTransform(e)),this.vertexDimension=2,e.hasZ&&this.vertexDimension++,e.hasM&&this.vertexDimension++,e.geometryType){case"esriGeometryPoint":this.addCoordinate=(e,t,i)=>this.addCoordinatePoint(e,t,i),this.createGeometry=e=>this.createPointGeometry(e);break;case"esriGeometryPolygon":this.addCoordinate=(e,t,i)=>this.addCoordinatePolygon(e,t,i),this.createGeometry=e=>this.createPolygonGeometry(e);break;case"esriGeometryPolyline":this.addCoordinate=(e,t,i)=>this.addCoordinatePolyline(e,t,i),this.createGeometry=e=>this.createPolylineGeometry(e);break;case"esriGeometryMultipoint":this.addCoordinate=(e,t,i)=>this.addCoordinateMultipoint(e,t,i),this.createGeometry=e=>this.createMultipointGeometry(e);break;default:Object(p.a)(e.geometryType)}}createFeature(){return this.lengths.length=0,this.currentLengthIndex=0,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,{attributes:new this.AttributesConstructor}}addLength(e,t,i){0===this.lengths.length&&(this.toAddInCurrentPath=t),this.lengths.push(t)}createPointGeometry(e){const t={x:0,y:0,spatialReference:e.spatialReference};return e.hasZ&&(t.z=0),e.hasM&&(t.m=0),t}addCoordinatePoint(e,t,i){switch(t=this.applyTransform(this.transform,t,i,0),i){case 0:e.x=t;break;case 1:e.y=t;break;case 2:"z"in e?e.z=t:e.m=t;break;case 3:e.m=t}}transformPathLikeValue(e,t){let i=0;return t<=1&&(i=this.previousCoordinate[t],this.previousCoordinate[t]+=e),this.applyTransform(this.transform,e,t,i)}addCoordinatePolyline(e,t,i){this.dehydratedAddPointsCoordinate(e.paths,t,i)}addCoordinatePolygon(e,t,i){this.dehydratedAddPointsCoordinate(e.rings,t,i)}addCoordinateMultipoint(e,t,i){0===i&&e.points.push([]);const r=this.transformPathLikeValue(t,i);e.points[e.points.length-1].push(r)}createPolygonGeometry(e){return{rings:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}createPolylineGeometry(e){return{paths:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}createMultipointGeometry(e){return{points:[],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}dehydratedAddPointsCoordinate(e,t,i){if(null===this.coordinateBuffer){const e=this.lengths.reduce((e,t)=>e+t,0);this.coordinateBuffer=new Float64Array(e*this.vertexDimension)}0===i&&0==this.toAddInCurrentPath--&&(e.push([]),this.toAddInCurrentPath=this.lengths[++this.currentLengthIndex]-1,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0);const r=this.transformPathLikeValue(t,i),n=e[e.length-1];0===i&&n.push(new Float64Array(this.coordinateBuffer.buffer,this.coordinateBufferPtr*Float64Array.BYTES_PER_ELEMENT,this.vertexDimension)),this.coordinateBuffer[this.coordinateBufferPtr++]=r}deriveApplyTransform(e){const{hasZ:t,hasM:i}=e;return t&&i?v:t?g:i?m:y}}var j=i(183),w=i(240),M=i(43),I=i(144);function T(e,t){const i=e.toJSON();return i.objectIds&&(i.objectIds=i.objectIds.join(",")),i.orderByFields&&(i.orderByFields=i.orderByFields.join(",")),i.outFields&&!(null==t?void 0:t.returnCountOnly)?-1!==i.outFields.indexOf("*")?i.outFields="*":i.outFields=i.outFields.join(","):delete i.outFields,i.outSpatialReference&&(i.outSR=i.outSR.wkid||JSON.stringify(i.outSR.toJSON()),delete i.outSpatialReference),i.dynamicDataSource&&(i.layer=JSON.stringify({source:i.dynamicDataSource}),delete i.dynamicDataSource),i}async function C(e,t,i={},r){const n=Object(I.a)({...e.query,f:"json",...r,...T(t,r)});return Object(M.default)(e.path+"/queryRelatedRecords",{...i,query:{...i.query,...n}})}let k=class extends h.a{constructor(e){super(e),this.dynamicDataSource=null,this.format="json",this.gdbVersion=null,this.sourceSpatialReference=null}execute(e,t){return this.executeJSON(e,t).then(e=>o.default.fromJSON(e))}async executeJSON(e,t){const i={...this.requestOptions,...t},r=this._normalizeQuery(e);if("pbf"===this.format){const e=!r.quantizationParameters,{data:t}=await Object(j.executeQueryPBF)(this.parsedUrl,r,new _({sourceSpatialReference:this.sourceSpatialReference,applyTransform:e}),i);return t}const{data:n}=await Object(j.executeQuery)(this.parsedUrl,r,this.sourceSpatialReference,i);return n}executeForCount(e,t){return Object(j.executeQueryForCount)(this.parsedUrl,this._normalizeQuery(e),{...this.requestOptions,...t}).then(e=>e.data.count)}executeForExtent(e,t){return Object(j.executeQueryForExtent)(this.parsedUrl,this._normalizeQuery(e),{...this.requestOptions,...t}).then(e=>({count:e.data.count,extent:s.a.fromJSON(e.data.extent)}))}executeForIds(e,t){return Object(j.executeQueryForIds)(this.parsedUrl,this._normalizeQuery(e),{...this.requestOptions,...t}).then(e=>e.data.objectIds)}executeRelationshipQuery(e,t){return e=u.a.from(e),(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),async function(e,t,i){const r=await C(e,t,i),n=r.data,a=n.geometryType,s=n.spatialReference,o={};for(const e of n.relatedRecordGroups){const t={fields:void 0,objectIdFieldName:void 0,geometryType:a,spatialReference:s,hasZ:!!n.hasZ,hasM:!!n.hasM,features:e.relatedRecords};if(null!=e.objectId)o[e.objectId]=t;else for(const i in e)e.hasOwnProperty(i)&&"relatedRecords"!==i&&(o[e[i]]=t)}return{...r,data:o}}(this.parsedUrl,e,{...this.requestOptions,...t}).then(e=>{const t=e.data,i={};return Object.keys(t).forEach(e=>i[e]=o.default.fromJSON(t[e])),i})}executeRelationshipQueryForCount(e,t){return e=u.a.from(e),(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),async function(e,t,i){const r=await C(e,t,i,{returnCountOnly:!0}),n=r.data,a={};for(const e of n.relatedRecordGroups)null!=e.objectId&&(a[e.objectId]=e.count);return{...r,data:a}}(this.parsedUrl,e,{...this.requestOptions,...t}).then(e=>e.data)}executeAttachmentQuery(e,t){return Object(w.a)(this.parsedUrl,c.a.from(e),{...this.requestOptions,...t}).then(e=>Object(w.b)(e.data.attachmentGroups,this.parsedUrl.path))}_normalizeQuery(e){const t=d.a.from(e);if(!this.gdbVersion&&!this.dynamicDataSource)return t;const i=t===e?t.clone():t;return i.gdbVersion=e.gdbVersion||this.gdbVersion,i.dynamicDataSource=e.dynamicDataSource?l.a.from(e.dynamicDataSource):this.dynamicDataSource,i}};Object(r.a)([Object(n.b)({type:l.a})],k.prototype,"dynamicDataSource",void 0),Object(r.a)([Object(n.b)()],k.prototype,"format",void 0),Object(r.a)([Object(n.b)()],k.prototype,"gdbVersion",void 0),Object(r.a)([Object(n.b)()],k.prototype,"sourceSpatialReference",void 0),k=Object(r.a)([Object(a.a)("esri.tasks.QueryTask")],k);var x=k;t.a=x},308:function(e,t,i){"use strict";i.d(t,"a",(function(){return _})),i.d(t,"b",(function(){return w})),i.d(t,"c",(function(){return s})),i.d(t,"d",(function(){return O}));var r=i(113);const n="http://www.w3.org/2000/svg",a=[];let s=(e,t)=>{const i={};return Object.keys(e).forEach(t=>{i[t]=e[t]}),t&&Object.keys(t).forEach(e=>{i[e]=t[e]}),i};const o=(e,t)=>e.vnodeSelector===t.vnodeSelector&&(e.properties&&t.properties?e.properties.key===t.properties.key&&e.properties.bind===t.properties.bind:!e.properties&&!t.properties),l=e=>{if("string"!=typeof e)throw new Error("Style values must be strings")},c=(e,t,i)=>{if(""!==t.vnodeSelector)for(let r=i;r<e.length;r++)if(o(e[r],t))return r;return-1},d=(e,t,i,r)=>{const n=e[t];if(""===n.vnodeSelector)return;const a=n.properties;if(!(a?void 0===a.key?a.bind:a.key:void 0))for(let a=0;a<e.length;a++)if(a!==t){const t=e[a];if(o(t,n))throw new Error(`${i.vnodeSelector} had a ${n.vnodeSelector} child ${"added"===r?r:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}},u=e=>{if(e.properties){const t=e.properties.enterAnimation;t&&t(e.domNode,e.properties)}},h=[];let p=!1;const b=e=>{(e.children||[]).forEach(b),e.properties&&e.properties.afterRemoved&&e.properties.afterRemoved.apply(e.properties.bind||e.properties,[e.domNode])},f=()=>{p=!1,h.forEach(b),h.length=0},y=e=>{h.push(e),p||(p=!0,"undefined"!=typeof window&&"requestIdleCallback"in window?window.requestIdleCallback(f,{timeout:16}):setTimeout(f,16))},g=e=>{const t=e.domNode;if(e.properties){const i=e.properties.exitAnimation;if(i){t.style.pointerEvents="none";const r=()=>{t.parentNode&&(t.parentNode.removeChild(t),y(e))};return void i(t,r,e.properties)}}t.parentNode&&(t.parentNode.removeChild(t),y(e))},m=(e,t,i)=>{if(!t)return;const a=i.eventHandlerInterceptor,s=Object.keys(t),o=s.length;for(let c=0;c<o;c++){const o=s[c];let d=t[o];if("className"===o)throw new Error('Property "className" is not supported, use "class".');if("class"===o)j(e,d,!0);else if("classes"===o){const t=Object.keys(d),i=t.length;for(let r=0;r<i;r++){const i=t[r];d[i]&&e.classList.add(i)}}else if("styles"===o){const t=Object.keys(d),r=t.length;for(let n=0;n<r;n++){const r=t[n],a=d[r];a&&(l(a),i.styleApplyer(e,r,a))}}else if("key"!==o&&null!=d){const s=typeof d;"function"===s?0===o.lastIndexOf("on",0)&&(a&&(d=a(o,d,e,t)),"oninput"===o&&function(){const e=d;d=function(t){e.apply(this,[t]),t.target["oninput-value"]=t.target.value}}(),e[o]=d):i.namespace===n?"href"===o?e.setAttributeNS("http://www.w3.org/1999/xlink",o,d):e.setAttribute(o,d):"string"===s&&"value"!==o?"innerHTML"===o?e[o]=r.e.sanitize(d):e.setAttribute(o,d):e[o]=d}}};let v,O=(e,t,i)=>{((e,t,i)=>{if(t)for(const r of t)_(r,e,void 0,i)})(e,t.children,i),t.text&&(e.textContent=t.text),m(e,t.properties,i),t.properties&&t.properties.afterCreate&&t.properties.afterCreate.apply(t.properties.bind||t.properties,[e,i,t.vnodeSelector,t.properties,t.children])},_=(e,t,i,r)=>{let a,o=0;const l=e.vnodeSelector,c=t.ownerDocument;if(""===l)a=e.domNode=c.createTextNode(e.text),void 0!==i?t.insertBefore(a,i):t.appendChild(a);else{for(let d=0;d<=l.length;++d){const u=l.charAt(d);if(d===l.length||"."===u||"#"===u){const u=l.charAt(o-1),h=l.slice(o,d);"."===u?a.classList.add(h):"#"===u?a.id=h:("svg"===h&&(r=s(r,{namespace:n})),void 0!==r.namespace?a=e.domNode=c.createElementNS(r.namespace,h):(a=e.domNode=e.domNode||c.createElement(h),"input"===h&&e.properties&&void 0!==e.properties.type&&a.setAttribute("type",e.properties.type)),void 0!==i?t.insertBefore(a,i):a.parentNode!==t&&t.appendChild(a)),o=d+1}}O(a,e,r)}};const j=(e,t,i)=>{t&&t.split(" ").forEach(t=>{t&&e.classList.toggle(t,i)})};v=(e,t,i)=>{const h=e.domNode;let p=!1;if(e===t)return!1;let b=!1;if(""===t.vnodeSelector){if(t.text!==e.text){const e=h.ownerDocument.createTextNode(t.text);return h.parentNode.replaceChild(e,h),t.domNode=e,p=!0,p}t.domNode=h}else 0===t.vnodeSelector.lastIndexOf("svg",0)&&(i=s(i,{namespace:n})),e.text!==t.text&&(b=!0,void 0===t.text?h.removeChild(h.firstChild):h.textContent=t.text),t.domNode=h,b=((e,t,i,r,n)=>{if(i===r)return!1;r=r||a;const s=(i=i||a).length,l=r.length;let h,p=0,b=0,f=!1;for(;b<l;){const a=p<s?i[p]:void 0,l=r[b];if(void 0!==a&&o(a,l))f=v(a,l,n)||f,p++;else{const a=c(i,l,p+1);if(a>=0){for(h=p;h<a;h++)g(i[h]),d(i,h,e,"removed");f=v(i[a],l,n)||f,p=a+1}else _(l,t,p<s?i[p].domNode:void 0,n),u(l),d(r,b,e,"added")}b++}if(s>p)for(h=p;h<s;h++)g(i[h]),d(i,h,e,"removed");return f})(t,h,e.children,t.children,i)||b,b=((e,t,i,a)=>{if(!i)return;let s=!1;const o=Object.keys(i),c=o.length;for(let d=0;d<c;d++){const c=o[d];let u=i[c];const h=t[c];if("class"===c)h!==u&&(j(e,h,!1),j(e,u,!0));else if("classes"===c){const t=e.classList,i=Object.keys(u),r=i.length;for(let e=0;e<r;e++){const r=i[e],n=!!u[r];n!==!!h[r]&&(s=!0,n?t.add(r):t.remove(r))}}else if("styles"===c){const t=Object.keys(u),i=t.length;for(let r=0;r<i;r++){const i=t[r],n=u[i];n!==h[i]&&(s=!0,n?(l(n),a.styleApplyer(e,i,n)):a.styleApplyer(e,i,""))}}else if(u||"string"!=typeof h||(u=""),"value"===c){const t=e[c];t!==u&&(e["oninput-value"]?t===e["oninput-value"]:u!==h)&&(e[c]=u,e["oninput-value"]=void 0),u!==h&&(s=!0)}else if(u!==h){const t=typeof u;"function"===t&&a.eventHandlerInterceptor||(a.namespace===n?"href"===c?e.setAttributeNS("http://www.w3.org/1999/xlink",c,u):e.setAttribute(c,u):"string"===t?"innerHTML"===c?e[c]=r.e.sanitize(u):"role"===c&&""===u?e.removeAttribute(c):e.setAttribute(c,u):e[c]!==u&&(e[c]=u),s=!0)}}return s})(h,e.properties,t.properties,i)||b,t.properties&&t.properties.afterUpdate&&t.properties.afterUpdate.apply(t.properties.bind||t.properties,[h,i,t.vnodeSelector,t.properties,t.children]);return b&&t.properties&&t.properties.updateAnimation&&t.properties.updateAnimation(h,t.properties,e.properties),p};let w=(e,t)=>({getLastRender:()=>e,update:i=>{if(e.vnodeSelector!==i.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");const r=e;e=i,v(r,i,t)},domNode:e.domNode})},309:function(e,t,i){"use strict";function r(){return function(e,t){if(!e[t])throw new TypeError(`Cannot auto bind undefined function '${t}'`);return{value:(i=e[t],function(e,...t){!function(e){const{type:t}=e;return e instanceof KeyboardEvent||"keyup"===t||"keydown"===t||"keypress"===t}(e)?i.call(this,e,...t):"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),e.stopPropagation(),e.target.click())})};var i}}i.d(t,"a",(function(){return r}))},310:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(360);function n(e){return t=>{t.hasOwnProperty("_delegatedEventNames")||(t._delegatedEventNames=t._delegatedEventNames?t._delegatedEventNames.slice():[]);const i=t._delegatedEventNames,n=Array.isArray(e)?e:Object(r.b)(e);i.push(...n)}}},360:function(e,t,i){"use strict";function r(e){return e.split(",").map(e=>e.trim())}function n(e,t){return e.map(e=>function(e,t){return 0===e.indexOf(t)?e:`${t}.${e}`}(e,t))}i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return r}))},366:function(e,t,i){"use strict";i.d(t,"a",(function(){return h}));var r=i(8),n=i(15),a=i(2),s=i(39),o=i(10),l=i(96);const c=Object(l.a)(["bing-maps","open-street-map","tile","unknown","unsupported","vector-tile","web-tile"]),d=Object(l.a)(["feature","group","tile","unknown","unsupported","vector-tile","web-tile"]);function u(e){return!("feature"!==e.type||e.url||!e.source||"memory"!==e.source.type)}function h(e,t,i){if(!("write"in e)||!e.write)return i&&i.messages&&i.messages.push(new o.a("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted`,{layer:e})),null;if(function(e,t){if(t.restrictedWebMapWriting){const i=function(e){return"basemap"===e.layerContainerType?c:"operational-layers"===e.layerContainerType?d:null}(t);return!Object(a.h)(i)||i.has(e.type)&&!u(e)}return!0}(e,i)){const t={};return e.write(t,i)?t:null}return Object(a.h)(t)&&function(e,t){if(function(e,t){if(u(e)){const i=Object(n.b)("featureCollection.layers",t),r=i&&i[0]&&i[0].layerDefinition;r&&("maxScale"in e&&(r.maxScale=Object(s.b)(e.maxScale)),"minScale"in e&&(r.minScale=Object(s.b)(e.minScale)))}else"group"!==e.type&&("maxScale"in e&&(t.maxScale=Object(s.b)(e.maxScale)),"minScale"in e&&(t.minScale=Object(s.b)(e.minScale)))}(e,t),"blendMode"in e&&(t.blendMode=e.blendMode,"normal"===t.blendMode&&delete t.blendMode),t.opacity=Object(s.b)(e.opacity),t.title=e.title||"Layer",t.visibility=e.visible,"legendEnabled"in e&&"wmts"!==e.type)if(u(e)){const i=t.featureCollection;i&&(i.showLegend=e.legendEnabled)}else t.showLegend=e.legendEnabled}(e,t=Object(r.a)(t)),t}},414:function(e,t,i){"use strict";function r(e){return"string"==typeof e?document.getElementById(e):e}function n(e){for(;e.hasChildNodes();)e.removeChild(e.firstChild)}function a(e,t){for(;;){const i=e.firstChild;if(!i)break;t.appendChild(i)}}i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return a}));(()=>{if("function"==typeof Element.prototype.closest)return(e,t)=>e.closest(t);const e=Element.prototype.matches||Element.prototype.msMatchesSelector})()},415:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return r}));i(113),i(309),i(215),i(201),i(310),i(189),i(216);function r(e){return e&&"function"==typeof e.render}function n(e){return e&&"function"==typeof e.postMixInProperties&&"function"==typeof e.buildRendering&&"function"==typeof e.postCreate&&"function"==typeof e.startup}},417:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return a}));var r=i(143),n=i(154);async function a(e){if(!e)return;const t=e.indexOf("-vector")>-1?e.slice(0,e.indexOf("-vector")):e,i=await Object(n.a)("esri/t9n/basemaps");return i[e]||i[t]}const s={streets:{id:"streets",thumbnailUrl:Object(r.b)("esri/images/basemap/streets.jpg"),baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",thumbnailUrl:Object(r.b)("esri/images/basemap/satellite.jpg"),baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",thumbnailUrl:Object(r.b)("esri/images/basemap/hybrid.jpg"),baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Boundaries and Places",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",thumbnailUrl:Object(r.b)("esri/images/basemap/terrain.jpg"),baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",thumbnailUrl:Object(r.b)("esri/images/basemap/topo.jpg"),baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",thumbnailUrl:Object(r.b)("esri/images/basemap/gray.jpg"),baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",thumbnailUrl:Object(r.b)("esri/images/basemap/dark-gray.jpg"),baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",thumbnailUrl:Object(r.b)("esri/images/basemap/oceans.jpg"),baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",thumbnailUrl:Object(r.b)("esri/images/basemap/national-geographic.jpg"),baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",thumbnailUrl:Object(r.b)("esri/images/basemap/osm.jpg"),baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",thumbnailUrl:Object(r.b)("esri/images/basemap/dark-gray-vector.jpg"),baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",thumbnailUrl:Object(r.b)("esri/images/basemap/gray-vector.jpg"),baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",thumbnailUrl:Object(r.b)("esri/images/basemap/streets-vector.jpg"),baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",thumbnailUrl:Object(r.b)("esri/images/basemap/topo-vector.jpg"),baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",thumbnailUrl:Object(r.b)("esri/images/basemap/streets-night.jpg"),baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",thumbnailUrl:Object(r.b)("esri/images/basemap/streets-relief.jpg"),baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",showLegend:!1,visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",thumbnailUrl:Object(r.b)("esri/images/basemap/streets-navigation.jpg"),baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]}}},436:function(e,t,i){"use strict";i.r(t);var r,n=i(24),a=i(3),s=(i(20),i(2)),o=i(7),l=i(9),c=i(26),d=i(68),u=i(25),h=i(66),p=i(10),b=(i(4),i(41),i(31)),f=i(5),y=i(43),g=(i(42),i(237)),m=i(99),v=i(101),O=i(135),_=i(145),j=i(85),w=i(118),M=i(111),I=i(176),T=i(136),C=i(248),k=i(204),x=i(486),S=i(524),F=i(525),E=i(487),L=i(488),A=i(526),P=i(30),R=i(184),V=i(48),N=i(89),D=i(71),U=i(70),B=i(112),z=i(74),G=i(223),W=i(98),H=i(251),q=i(75),$=i(482),K=i(37),J=i(8),Q=i(65),Z=i(78),Y=i(175),X=i(222),ee=i(69);let te=r=class extends Q.a{constructor(e){super(e),this.type="none"}clone(){return new r({type:this.type})}};var ie;Object(n.a)([Object(ee.a)({none:"none",stayAbove:"stay-above"})],te.prototype,"type",void 0),te=r=Object(n.a)([Object(u.a)("esri.ground.NavigationConstraint")],te);const re=o.a.getLogger("esri.Ground");let ne=ie=class extends(Object(Q.b)(W.a)){constructor(e){super(e),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new z.a;const t=e=>{e.parent&&e.parent!==this&&"remove"in e.parent&&e.parent.remove(e),e.parent=this,"elevation"!==e.type&&"base-elevation"!==e.type&&re.error(`Layer '${e.title}, id:${e.id}' of type '${e.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)};this.layers.on("after-add",e=>t(e.item)),this.layers.on("after-remove",e=>{e.item.parent=null})}initialize(){this.when().catch(e=>{re.error("#load()","Failed to load ground",e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.layers.removeAll();for(const t of e)t.destroy();this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set layers(e){this._set("layers",Object(X.b)(e,this._get("layers")))}writeLayers(e,t,i,r){const n=[];e?(r={...r,layerContainerType:"ground"},e.forEach(e=>{if("write"in e){const t={};Object(K.b)(e)().write(t,r)&&n.push(t)}else r&&r.messages&&r.messages.push(new p.a("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted in the ground`,{layer:e}))}),t.layers=n):t.layers=n}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Object(f.r)(this)}loadAll(){return Object(g.a)(this,e=>{e(this.layers)})}queryElevation(e,t){return this.load().then(()=>this._importElevationQuery()).then(i=>{const r=new i.ElevationQuery,n=this.layers.filter(ae).toArray();return r.queryAll(n,e,t)})}createElevationSampler(e,t){const i=this.layers.filter(ae).toArray();return 1===i.length?i[0].createElevationSampler(e,t):this._importElevationQuery().then(r=>(new r.ElevationQuery).createSamplerAll(i,e,t))}clone(){const e={opacity:this.opacity,surfaceColor:Object(J.a)(this.surfaceColor),navigationConstraint:Object(J.a)(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new ie({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){const t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Object(f.r)(null)}_loadLayersFromJSON(e,t,r){const n=t&&t.origin||"web-scene",a=t&&t.portal||null,s=t&&t.url||null;return i.e(25).then(i.bind(null,543)).then(t=>{Object(f.t)(r);const i=[];if(e.layers&&Array.isArray(e.layers)){const r={context:{origin:n,url:s,portal:a,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};i.push(t.populateOperationalLayers(this.layers,e.layers,r))}return Object(f.m)(i)}).then(()=>{})}_importElevationQuery(){return i.e(145).then(i.bind(null,548))}};function ae(e){return"elevation"===e.type||function(e){return e&&"createElevationSampler"in e}(e)}Object(n.a)([Object(c.b)({json:{read:!1}})],ne.prototype,"layers",null),Object(n.a)([Object(h.a)("layers")],ne.prototype,"writeLayers",null),Object(n.a)([Object(c.b)({readOnly:!0})],ne.prototype,"resourceInfo",void 0),Object(n.a)([Object(c.b)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:l.a,read:{reader:Y.b,source:"transparency"},write:{writer:(e,t)=>{t.transparency=Object(Y.a)(e)},target:"transparency"}}})],ne.prototype,"opacity",void 0),Object(n.a)([Object(c.b)({type:Z.a,json:{type:[l.a],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],ne.prototype,"surfaceColor",void 0),Object(n.a)([Object(c.b)({type:te,json:{write:!0}})],ne.prototype,"navigationConstraint",void 0),ne=ie=Object(n.a)([Object(u.a)("esri.Ground")],ne);var se=ne,oe=i(417);const le=o.a.getLogger("esri.support.basemapUtils");function ce(e,t){var i;let r;if("string"==typeof e){if(!(e in oe.a)){const t=Object.keys(oe.a).map(e=>`"${e}"`).join(", ");return le.warn(`Unable to find basemap definition for: ${e}. Try one of these: ${t}`),null}t&&(r=t[e]),r||(r=$.default.fromId(e),t&&(t[e]=r))}else r=Object(l.m)($.default,e);return(null==(i=r)?void 0:i.destroyed)&&(le.warn("The provided basemap is already destroyed",{basemap:r}),r=null),r}const de=o.a.getLogger("esri.support.groundUtils"),ue={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};var he=i(489),pe=i(490);const be=o.a.getLogger("esri.Map");let fe=class extends(Object(pe.a)(Object(he.a)(B.a.EventedMixin(P.a)))){constructor(e){super(e),this.basemap=null,this.ground=new se,this._basemapCache={}}destroy(){var e,t;this.allLayers.destroy(),this.allTables.destroy(),null==(e=this.ground)||e.destroy(),null==(t=this.basemap)||t.destroy(),function(e){for(const t in e){const i=e[t];!1===(null==i?void 0:i.destroyed)&&i.destroy(),delete e[t]}}(this._basemapCache),this._basemapCache=null}get allLayers(){return new H.a({root:this,rootCollectionNames:["basemap.baseLayers","ground.layers","layers","basemap.referenceLayers"],getChildrenFunction:e=>e.layers})}get allTables(){return this._createTablesFlattener(this)}castBasemap(e){return ce(e,this._basemapCache)}castGround(e){return function(e){let t;return"string"==typeof e?e in ue?t=new se({resourceInfo:{data:{layers:[ue[e]]}}}):de.warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`):t=Object(l.m)(se,e),t}(e)||(be.error("Map.ground may not be set to null or undefined"),this._get("ground"))}findLayerById(e){return this.allLayers.find(t=>t.id===e)}_createTablesFlattener(e){return new H.a({root:e,rootCollectionNames:["tables","layers"],getChildrenFunction:e=>e&&"group"===e.type?this._createTablesFlattener(e):null,itemFilterFunction:e=>this._isMapOrGroupLayer(e.parent)&&e.parent.tables.includes(e)})}_isMapOrGroupLayer(e){return e&&(e===this||this._isGroupLayer(e))}_isGroupLayer(e){return e&&"group"===e.type}};Object(n.a)([Object(c.b)({readOnly:!0})],fe.prototype,"allLayers",null),Object(n.a)([Object(c.b)({readOnly:!0})],fe.prototype,"allTables",null),Object(n.a)([Object(c.b)({type:$.default})],fe.prototype,"basemap",void 0),Object(n.a)([Object(q.a)("basemap")],fe.prototype,"castBasemap",null),Object(n.a)([Object(c.b)({type:se,nonNullable:!0})],fe.prototype,"ground",void 0),Object(n.a)([Object(q.a)("ground")],fe.prototype,"castGround",null),fe=Object(n.a)([Object(u.a)("esri.Map")],fe);var ye=fe,ge=i(81),me=i(46),ve=i(225),Oe=i(119);const _e=z.a.ofType(Oe.a);let je=class extends _e{constructor(e){super(e),this.on("before-add",e=>{e.item||e.preventDefault()}),this.on("after-add",e=>this._own(e.item)),this.on("after-remove",({item:e})=>{e.layer=null})}destroy(){this._unownAll()}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._unownAll(),this._set("owner",e),this._ownAll())}_createNewInstance(e){return new _e(e)}_ownAll(){this.items.forEach(e=>this._own(e))}_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_unownAll(){this.items.forEach(e=>this._unown(e))}_unown(e){e.layer===this.owner&&(e.layer=null)}};Object(n.a)([Object(c.b)()],je.prototype,"owner",null),je=Object(n.a)([Object(u.a)("esri.support.GraphicsCollection")],je);const we={type:je,cast:X.a,set(e){const t=Object(X.b)(e,this._get("graphics"),je);t.owner=this,this._set("graphics",t)}};var Me=je;let Ie=class extends P.a{constructor(e){super(e),this.view=null,this.baseLayerViews=new z.a,this.referenceLayerViews=new z.a,this._loadingHandle=Object(me.a)(this,"view.map.basemap",e=>{e&&e.load().catch(()=>{})})}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null)}get suspended(){return!this.view||this.view.suspended}get updating(){return!(this.view&&this.view.suspended||!(this.view&&this.view.map&&this.view.map.basemap)||this.view.map.basemap.loaded)}};Object(n.a)([Object(c.b)({constructOnly:!0})],Ie.prototype,"view",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],Ie.prototype,"baseLayerViews",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],Ie.prototype,"referenceLayerViews",void 0),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["view.suspended"]})],Ie.prototype,"suspended",null),Object(n.a)([Object(c.b)({type:Boolean,readOnly:!0,dependsOn:["view.suspended","view.map.basemap.loaded"]})],Ie.prototype,"updating",null),Ie=Object(n.a)([Object(u.a)("esri.views.BasemapView")],Ie);var Te=i(334);const Ce=o.a.getLogger("esri.views.LayerViewManager"),ke=new Map;ke.set("view.map.basemap.baseLayers","view.basemapView.baseLayerViews"),ke.set("view.map.ground.layers","view.groundView.layerViews"),ke.set("view.map.layers","view.layerViews"),ke.set("view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews");class xe{constructor(e,t,i){this.layer=e,this.view=t,this.layerViewImporter=i,this._controller=Object(f.c)(),this._deferred=Object(f.l)(),this._started=!1,this.done=!1,Object(f.o)(this._controller.signal,()=>{const t=new p.a("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(t)})}get promise(){return this._deferred.promise}destroy(){this._controller.abort();const{layerView:e}=this;if(!e)return;const{layer:t,view:i}=this;t.emit("layerview-destroy",{view:i,layerView:e}),i.emit("layerview-destroy",{layer:t,layerView:e}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}async start(){if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:t,view:i}=this;this._map=i.map;try{var r,n;let a,o;if(await t.load({signal:e}),"prefetchResources"in t&&await t.prefetchResources({signal:e}),t.createLayerView)a=await t.createLayerView(i,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(t))throw new p.a("layer:view-not-supported","No layerview implementation was found");const r=await this.layerViewImporter.importLayerView(t);Object(f.t)(e),a="default"in r?new r.default({layer:t,view:i}):new r({layer:t,view:i})}const l=()=>{Object(s.h)(o)&&(o.remove(),o=null),a.destroy(),a.layer=null,a.parent=null,a.view=null,this.done=!0};o=Object(f.o)(e,l),Object(f.t)(e);try{await a.when()}catch(e){throw l(),e}if(!(null==(r=this._map)||null==(n=r.allLayers)?void 0:n.includes(t)))return this._deferred.reject(new p.a("view:no-layerview-for-layer","The layer has been removed from the map",{layer:t})),void l();this.layerView=a,t.emit("layerview-create",{view:i,layerView:a}),i.emit("layerview-create",{layer:t,layerView:a}),this.done=!0,this._deferred.resolve(a)}catch(e){t.emit("layerview-create-error",{view:i,error:e}),i.emit("layerview-create-error",{layer:t,error:e}),this.done=!0,this._deferred.reject(new p.a("layerview:create-error","layerview creation failed",{layer:t,error:e}))}}}let Se=class extends k.a{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._watchUpdatingTracking=new Te.a,this.view=null,this._preloadLayerViewModules=()=>{const e=this.view,t=this.get("view.map.allLayers");e&&t&&t.forEach(e=>{this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e)})},this._reschedule=()=>{this.handles.remove("reschedule"),this.handles.add(Object(V.b)(this._doWork),"reschedule"),this.notifyChange("updating")},this._doWork=()=>{var e,t,i;const r=this.get("view.map");if(this._map!==r&&(this.clear(),this._map=r),!this.handles.has("reschedule"))return;this.handles.remove("reschedule"),this.handles.remove("collection-change");const n=r&&r.allLayers;if(!n)return;n.forEach(this._createLayerView,this),this._refreshCollections();const a=[];this._layerLayerViewInfoMap.forEach((e,t)=>{n.includes(t)||a.push(e)});for(const e of a)this._layerLayerViewInfoMap.delete(e.layer),e.destroy();const s=[null==(e=r.ground)?void 0:e.layers,null==(t=r.basemap)?void 0:t.baseLayers,null==(i=r.basemap)?void 0:i.referenceLayers,r.layers].filter(e=>!!e);this.handles.add(s.map(e=>this._watchUpdatingTracking.addOnCollectionChange(e,this._reschedule)),"collection-change"),this.notifyChange("updating")},this.handles.add([Object(me.b)(this,"view.map.allLayers","change",this._preloadLayerViewModules,this._preloadLayerViewModules),this.watch(["view.map.basemap","view.map.ground","view.map.layers","view.ready"],this._reschedule,!0)])}initialize(){this._preloadLayerViewModules()}destroy(){this.clear(),this._watchUpdatingTracking.destroy(),this.view=null,this._map=null}get updating(){if(this.handles.has("reschedule")||this._watchUpdatingTracking.updating)return!0;let e=!0;return this._layerLayerViewInfoMap.forEach(t=>e=e&&t.done),!e}clear(){this.destroyed||(this._layerLayerViewInfoMap.forEach(e=>e.destroy()),this._layerLayerViewInfoMap.clear(),this._refreshCollections())}whenLayerView(e){return this._reschedule(),this._doWork(),this._layerLayerViewInfoMap.has(e)?this._layerLayerViewInfoMap.get(e).promise:Object(f.h)(new p.a("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e}))}_refreshCollections(){ke.forEach((e,t)=>{this._populateLayerViewsOwners(this.get(t),this.get(e),this.view)})}_populateLayerViewsOwners(e,t,i){if(!e||!t)return void(t&&t.removeAll());let r=0;e.forEach(e=>{const n=this._layerLayerViewInfoMap.get(e);if(!n||!n.layerView)return;const a=n.layerView;a.layer=e,a.parent=i,t.getItemAt(r)!==a&&t.splice(r,0,a),e.layers&&this._populateLayerViewsOwners(e.layers,a.layerViews,a),r+=1}),r<t.length&&t.splice(r,t.length)}_createLayerView(e){if(this._layerLayerViewInfoMap.has(e))return this.view.ready&&this._layerLayerViewInfoMap.get(e).start(),void this.notifyChange("updating");e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const t=new xe(e,this.view,this.layerViewImporter);t.promise.then(()=>{this._refreshCollections(),this.notifyChange("updating")},t=>{var i,r;t&&(Object(f.b)(t)||"cancelled:layerview-create"===t.name)||Ce.error(`Failed to create layerview for layer title:'${null!=(i=e.title)?i:"no title"}', id:'${null!=(r=e.id)?r:"no id"}' of type '${e.type}'.`,{layer:e,error:t}),this._refreshCollections(),this.notifyChange("updating")}),this._layerLayerViewInfoMap.set(e,t),this.view.ready&&t.start(),this.notifyChange("updating")}};Object(n.a)([Object(c.b)({readOnly:!0})],Se.prototype,"_watchUpdatingTracking",void 0),Object(n.a)([Object(c.b)()],Se.prototype,"layerViewImporter",void 0),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["_watchUpdatingTracking.updating"]})],Se.prototype,"updating",null),Object(n.a)([Object(c.b)()],Se.prototype,"view",void 0),Se=Object(n.a)([Object(u.a)("esri.views.LayerViewManager")],Se);var Fe=Se,Ee=i(97);function Le(e){return"refresh"in e}let Ae=class extends P.a{constructor(){super(...arguments),this._handles=new Ee.a,this._currentTick=0}initialize(){this._handles.add([this.view.allLayerViews.on("after-changes",()=>{this.notifyChange("tickInterval"),this._handles.remove("layerViewsUpdating"),this._handles.add(this._getLayerViewHandles(),"layerViewsUpdating")}),this.watch("tickInterval",()=>this._restartTicking()),this.watch("view.ready",()=>this._restartTicking())]),this._restartTicking()}destroy(){this._handles&&(this._handles.destroy(),this._handles=null,this._intervalID&&clearInterval(this._intervalID),this._currentTick=0)}get tickInterval(){const e=this.view.allLayerViews.filter(e=>Le(e));return this._getCommonInterval(e)}_restartTicking(){this._currentTick=0,this._intervalID&&clearInterval(this._intervalID),this.get("view.ready")&&this.tickInterval&&(this._intervalID=setInterval(()=>{const e=Date.now();this._currentTick+=this.tickInterval,this.view.allLayerViews.forEach(t=>{if(Le(t)){const i=Math.round(6e4*t.refreshInterval),r=this._currentTick%i==0,n=e-t.refreshTimestamp<6e3;i&&r&&!n&&t.refresh(e)}})},this.tickInterval))}_getLayerViewHandles(){const e=[],t=()=>this.notifyChange("tickInterval");return this.view.allLayerViews.forEach(i=>{Le(i)&&i.layer&&e.push(i.watch("refreshInterval",t),i.layer.on("refresh",()=>{i.refresh(Date.now())}))}),e}_getCommonInterval(e){const t=(e,i)=>isNaN(e)||isNaN(i)?0:i<=0?e:t(i,e%i);return e.toArray().reduce((e,i)=>t(Math.round(6e4*i.refreshInterval),e),0)}};Object(n.a)([Object(c.b)()],Ae.prototype,"view",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],Ae.prototype,"tickInterval",null),Ae=Object(n.a)([Object(u.a)("esri.views.RefreshManager")],Ae);var Pe=Ae,Re=i(93),Ve=i(83);class Ne{constructor(e,t=[]){this.eventType=e,this.keyModifiers=t}matches(e){if(e.type!==this.eventType)return!1;if(0===this.keyModifiers.length)return!0;const t=e.modifiers;for(const e of this.keyModifiers)if(!t.has(e))return!1;return!0}}const De=o.a.getLogger("esri.views.input.InputHandler");class Ue{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const t=this._incoming[e];for(const e of t)this._incomingEventMatches.push(e.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager?De.error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback(e=>this._handleEvent(e)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,t,i){let r;"function"==typeof t?(i=t,r=[]):r=t||[];const n="string"==typeof e?new Ne(e,r):e,a=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},s=e=>{const t=this._incoming[e.match.eventType];if(t){const i=t.indexOf(e);t.splice(i,1),a(),this._manager&&this._manager.updateDependencies()}},o=new Be(n,i,{onPause:s,onRemove:s,onResume:e=>{const t=this._incoming[e.match.eventType];t&&-1===t.indexOf(e)&&(t.push(e),a(),this._manager&&this._manager.updateDependencies())}});let l=this._incoming[n.eventType];return l||(l=[],this._incoming[n.eventType]=l),l.push(o),a(),this._manager&&this._manager.updateDependencies(),o}registerOutgoing(e){if(this._outgoing[e])throw Error("There is already a callback registered for this outgoing InputEvent: "+e);const t=new ze(e,{onEmit:(e,t,i,r)=>{this._manager.emit(e.eventType,t,i,r)},onRemove:e=>{delete this._outgoing[e.eventType],this._manager.updateDependencies()}});return this._outgoing[e]=t,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),t}startCapturingPointer(e){this._manager.setPointerCapture(e,!0)}stopCapturingPointer(e){this._manager.setPointerCapture(e,!1)}refreshHasPendingInputs(){this._manager.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):De.error("This InputHandler is not registered with an InputManager")}_handleEvent(e){const t=this._incoming[e.type];if(t)for(const i of t)if(i.match.matches(e)&&(i.callback(e),e.shouldStopPropagation()))break}}class Be{constructor(e,t,i){this.match=e,this._callback=t,this._handler=i}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}}class ze{constructor(e,t){this.eventType=e,this._removed=!1,this._handler=t}emit(e,t,i){this._removed||this._handler.onEmit(this,e,t,i)}remove(){this._removed=!0,this._handler.onRemove(this)}}var Ge=i(467),We=i(22);const He=Object(a.a)("mac")?"Meta":"Ctrl",qe={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let e=48;e<58;e++)qe[e]=String.fromCharCode(e);for(let e=1;e<25;e++)qe[111+e]="F"+e;for(let e=65;e<91;e++)qe[e]=[String.fromCharCode(e+32),String.fromCharCode(e)];function $e(e){switch(e){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}class Ke extends Ue{constructor(e){super(!0),this._onChange=e,this._value="mouse",this.registerIncoming("pointer-down",e=>{const t="touch"===e.data.native.pointerType;this._setValue(t?"touch":"mouse")}),this._moveHandler=this.registerIncoming("pointer-move",e=>{const t="touch"===e.data.native.pointerType;this._setValue(t?"touch":"mouse")}),this._moveHandler.pause()}_setValue(e){e!==this._value&&("touch"===e?this._moveHandler.resume():this._moveHandler.pause(),this._value=e,this._onChange(e))}}const Je=o.a.getLogger("esri.views.input.InputManager");let Qe=class extends P.a{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._currentPropagation=null,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=He,this.latestPointerType="mouse",this.test={timestamp:void 0}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const t of e)this.uninstallHandlers(t);this.eventSource=null}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}installHandlers(e,t,i=Ye.INTERNAL){if(this._nameToGroup[e])return void Je.error("There is already an InputHandler group registered under the name `"+e+"`");if(0===t.length)return void Je.error("Can't register a group of zero handlers");const r={name:e,handlers:t.map(e=>({handler:e,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=r;for(let e=r.handlers.length-1;e>=0;e--){const t=r.handlers[e];this._handlers.push(t),t.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(e,i,r,n,a)=>{this._emitInputEvent(t.priorityIndex+1,e,i,r,a,n)},setPointerCapture:(e,i)=>{this._setPointerCapture(r,t,e,i)},setEventCallback:e=>{t.eventCallback=e},setUninstallCallback:e=>{t.uninstallCallback=e},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const t=this._nameToGroup[e];t?(t.handlers.forEach(e=>{e.removed=!0,e.uninstallCallback()}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):Je.error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return void 0!==this._nameToGroup[e]}updateDependencies(){const e=new Set,t=new Set;this._handlersPriority=[];for(let e=this._handlers.length-1;e>=0;e--){const t=this._handlers[e];t.priorityIndex=e,this._handlersPriority.push(t)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const r=this._handlersPriority[i];r.priorityIndex=i;let n=r.handler.hasSideEffects;if(!n)for(const t of r.handler.outgoingEventTypes)if(e.has(t)){n=!0;break}if(n)for(const i of r.handler.incomingEventMatches){e.add(i.eventType);for(const e of i.keyModifiers)$e(e)||t.add(e)}r.active=n}this._sourceEvents=e,this._keyModifiers=t,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointerType(e){this._set("latestPointerType",e)}_onEventReceived(e,t){if("pointer-capture-lost"===e){const e=t;this._pointerCaptures.delete(e.native.pointerId)}this._updateKeyModifiers(e,t);const i=null!=this.test.timestamp?this.test.timestamp:t.native?t.native.timestamp:void 0,r=t.native?t.native.cancelable:void 0;this._emitInputEventFromSource(e,t,i,r)}_updateKeyModifiers(e,t){if(!t)return;let i=!1;const r=()=>{if(!i){const e=new Set;this._activeKeyModifiers.forEach(t=>{e.add(t)}),this._activeKeyModifiers=e,i=!0}},n=(e,t)=>{t&&!this._activeKeyModifiers.has(e)?(r(),this._activeKeyModifiers.add(e)):!t&&this._activeKeyModifiers.has(e)&&(r(),this._activeKeyModifiers.delete(e))};if("key-down"===e||"key-up"===e){const i=t.key;this._keyModifiers.has(i)&&n(i,"key-down"===e)}const a=t.native;n("Alt",!(!a||!a.altKey)),n("Ctrl",!(!a||!a.ctrlKey)),n("Shift",!(!a||!a.shiftKey)),n("Meta",!(!a||!a.metaKey)),n("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerTypeHandler=new Ke(e=>this._setLatestPointerType(e)),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,Ye.INTERNAL),this.installHandlers("input-manager-logic",[this._latestPointerTypeHandler],Ye.INTERNAL)}_setPointerCapture(e,t,i,r){const n=e.name+"-"+t.priorityIndex,a=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,a),r?(a.add(n),1===a.size&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):a.has(n)&&(a.delete(n),0===a.size&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,t,i,r){this._emitInputEvent(0,e,t,i,r)}_emitInputEvent(e,t,i,r,n,a){const s=void 0!==r?r:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),o=void 0!==n&&n,l={event:new Ze(t,i,s,a||this._activeKeyModifiers,o),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(l):this._doNewPropagation(l)}_doNewPropagation(e){this._currentPropagation={events:new Ge.a,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e);const t=this._currentPropagation;for(;this._currentPropagation.events.length>0;){const{event:e,priorityIndex:i}=this._currentPropagation.events.pop(),r=e.data&&e.data.eventId;if(null==r||!this._stoppedPropagationEventIds.has(r))for(t.currentHandler=this._handlersPriority[i];t.currentHandler;){if(t.currentHandler.removed)t.needsHandlerGarbageCollect=!0;else if(t.currentHandler.active&&t.currentHandler.eventCallback(e),e.shouldStopPropagation()){null!=r&&this._stoppedPropagationEventIds.add(r);break}t.currentHandler=this._handlersPriority[t.currentHandler.priorityIndex+1]}}t.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null}_compareHandlerPriority(e,t){if(e.handler.hasSideEffects!==t.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==t.groupPriority)return e.groupPriority>t.groupPriority?-1:1;for(const i of e.handler.incomingEventMatches)for(const e of t.handler.incomingEventMatches){if(i.eventType!==e.eventType)continue;const t=i.keyModifiers.filter(t=>-1!==e.keyModifiers.indexOf(t));if(t.length===i.keyModifiers.length!=(t.length===e.keyModifiers.length))return i.keyModifiers.length>e.keyModifiers.length?-1:1}return e.priorityIndex>t.priorityIndex?-1:1}_sortHandlersPriority(e){const t=[];for(const i of e){let e=0;for(;e<t.length&&this._compareHandlerPriority(i,t[e])>=0;)e++;t.splice(e,0,i)}return t}get debug(){const e=e=>{const t=this._setPointerCapture;this._setPointerCapture=()=>{},e(),this._setPointerCapture=t};return{injectEvent:(t,i)=>{e(()=>{this._onEventReceived(t,i)})},disablePointerCapture:e}}};Object(n.a)([Object(c.b)({readOnly:!0})],Qe.prototype,"hasPendingInputs",null),Object(n.a)([Object(c.b)()],Qe.prototype,"eventSource",void 0),Object(n.a)([Object(c.b)()],Qe.prototype,"recognizers",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],Qe.prototype,"latestPointerType",void 0),Qe=Object(n.a)([Object(u.a)("esri.views.input.InputManager")],Qe);class Ze{constructor(e,t,i,r,n){this.type=e,this.data=t,this.timestamp=i,this.modifiers=r,this.cancelable=n,this._stopPropagation=!1}stopPropagation(){this._stopPropagation=!0}shouldStopPropagation(){return this._stopPropagation}preventDefault(){this.data.native.preventDefault()}}const Ye={DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3},Xe=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],et={};function tt(e){return!!et[e]}Xe.forEach(e=>{et[e]=!0});class it{constructor(e){this.handlers=new Map,this.counter=0,this.handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this.handlers.forEach(({handler:e,priority:t},i)=>this.inputManager.installHandlers(i,[e],t))}disconnect(){this.inputManager&&this.handlers.forEach((e,t)=>this.inputManager.uninstallHandlers(t)),this.inputManager=null}destroy(){this.disconnect(),this.handlers.clear(),this.view=null}on(e,t,i,r){const n=Array.isArray(e)?e:e.split(",");if(!function(e){for(const t of e)if(!tt(t))return!1;return!0}(n))return n.some(tt)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let a,s;Array.isArray(t)?s=t:(a=t,s=[]),"function"==typeof i?a=i:r=i,r=null!=r?r:Ye.DEFAULT;const o=this.createUniqueGroupName(),l=new rt(this.view,n,s,a);this.handlers.set(o,{handler:l,priority:r});for(const e of n){const t=this.handlerCounts.get(e)||0;this.handlerCounts.set(e,t+1)}return this.inputManager&&this.inputManager.installHandlers(o,[l],r),{remove:()=>this.removeHandler(o,n)}}hasHandler(e){return!!this.handlerCounts.get(e)}removeHandler(e,t){if(this.handlers.has(e)){this.handlers.delete(e);for(const e of t){const t=this.handlerCounts.get(e);void 0===t?console.error("Trying to remove handler for event that has no handlers registered: ",e):1===t?this.handlerCounts.delete(e):this.handlerCounts.set(e,t-1)}}this.inputManager&&this.inputManager.uninstallHandlers(e)}createUniqueGroupName(){return this.counter+=1,"viewEvents_"+this.counter}}class rt extends Ue{constructor(e,t,i,r){super(!0),this.view=e;for(const e of t)switch(e){case"click":this.registerIncoming("click",i,e=>r(this.wrapClick(e)));break;case"double-click":this.registerIncoming("double-click",i,e=>r(this.wrapDoubleClick(e)));break;case"immediate-click":this.registerIncoming("immediate-click",i,e=>r(this.wrapImmediateClick(e)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",i,e=>r(this.wrapImmediateDoubleClick(e)));break;case"hold":this.registerIncoming("hold",i,e=>r(this.wrapHold(e)));break;case"drag":this.registerIncoming("drag",i,e=>{const t=this.wrapDrag(e);t&&r(t)});break;case"key-down":this.registerIncoming("key-down",i,e=>r(this.wrapKeyDown(e)));break;case"key-up":this.registerIncoming("key-up",i,e=>r(this.wrapKeyUp(e)));break;case"pointer-down":this.registerIncoming("pointer-down",i,e=>r(this.wrapPointer(e,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",i,e=>r(this.wrapPointer(e,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",i,e=>r(this.wrapPointer(e,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",i,e=>r(this.wrapPointerDrag(e)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",i,e=>r(this.wrapMouseWheel(e)));break;case"pointer-enter":this.registerIncoming("pointer-enter",i,e=>r(this.wrapPointer(e,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",i,e=>r(this.wrapPointer(e,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",i,e=>{r(this.wrapGamepad(e))});break;case"focus":this.registerIncoming("focus",i,e=>{r(this.wrapFocus(e))});break;case"blur":this.registerIncoming("blur",i,e=>{r(this.wrapBlur(e))});break;default:Object(K.a)(e)}}wrapFocus(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),preventDefault:()=>e.preventDefault()}}wrapBlur(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),preventDefault:()=>e.preventDefault()}}wrapClick(e){const{pointerType:t,button:i,buttons:r,x:n,y:a,native:s,eventId:o}=e.data,{cancelable:l,timestamp:c}=e;return{type:"click",pointerType:t,button:i,buttons:r,x:n,y:a,native:s,timestamp:c,screenPoint:Object(Ve.b)(n,a),mapPoint:this.getMapPoint(n,a),eventId:o,cancelable:l,stopPropagation:()=>e.stopPropagation(),preventDefault:()=>e.preventDefault()}}wrapDoubleClick(e){const{pointerType:t,button:i,buttons:r,x:n,y:a,native:s,eventId:o}=e.data,{cancelable:l,timestamp:c}=e;return{type:"double-click",pointerType:t,button:i,buttons:r,x:n,y:a,native:s,timestamp:c,mapPoint:this.getMapPoint(n,a),eventId:o,cancelable:l,stopPropagation:()=>e.stopPropagation(),preventDefault:()=>e.preventDefault()}}wrapImmediateClick(e){const{pointerType:t,button:i,buttons:r,x:n,y:a,native:s,eventId:o}=e.data,l=s.pointerId,{cancelable:c,timestamp:d}=e;return{type:"immediate-click",pointerId:l,pointerType:t,button:i,buttons:r,x:n,y:a,native:s,timestamp:d,mapPoint:this.getMapPoint(n,a),eventId:o,cancelable:c,stopPropagation:()=>e.stopPropagation(),preventDefault:()=>e.preventDefault()}}wrapImmediateDoubleClick(e){const{pointerType:t,button:i,buttons:r,x:n,y:a,native:s,eventId:o}=e.data,l=s.pointerId,{cancelable:c,timestamp:d}=e;return{type:"immediate-double-click",pointerId:l,pointerType:t,button:i,buttons:r,x:n,y:a,native:s,timestamp:d,mapPoint:this.getMapPoint(n,a),eventId:o,cancelable:c,stopPropagation:()=>e.stopPropagation(),preventDefault:()=>e.preventDefault()}}wrapHold(e){const{pointerType:t,button:i,buttons:r,x:n,y:a,native:s}=e.data,{cancelable:o,timestamp:l}=e;return{type:"hold",pointerType:t,button:i,buttons:r,x:n,y:a,native:s,timestamp:l,mapPoint:this.getMapPoint(n,a),cancelable:o,stopPropagation:()=>e.stopPropagation(),preventDefault:()=>e.preventDefault()}}getMapPoint(e,t){return this.view.toMap(Object(Ve.b)(e,t),{exclude:[]})}wrapDrag(e){const t=e.data,{x:i,y:r}=t.center,{action:n,pointerType:a,button:s}=t;if("start"===n&&(this.latestDragStart=t),!this.latestDragStart)return;const o=t.pointer.native,l=t.buttons,{cancelable:c,timestamp:d}=e,u={x:this.latestDragStart.center.x,y:this.latestDragStart.center.y};return"end"===n&&(this.latestDragStart=void 0),{type:"drag",action:n,x:i,y:r,origin:u,pointerType:a,button:s,buttons:l,radius:t.radius,angle:Object(Re.k)(t.angle),native:o,timestamp:d,cancelable:c,stopPropagation:()=>e.stopPropagation(),preventDefault:()=>e.preventDefault()}}wrapKeyDown(e){const{key:t,repeat:i,native:r}=e.data,{cancelable:n,timestamp:a}=e;return{type:"key-down",key:t,repeat:i,native:r,timestamp:a,cancelable:n,stopPropagation:()=>e.stopPropagation(),preventDefault:()=>e.preventDefault()}}wrapKeyUp(e){const{key:t,native:i}=e.data,{cancelable:r,timestamp:n}=e;return{type:"key-up",key:t,native:i,timestamp:n,cancelable:r,stopPropagation:()=>e.stopPropagation(),preventDefault:()=>e.preventDefault()}}wrapPointer(e,t){const{x:i,y:r,button:n,buttons:a,native:s,eventId:o}=e.data,l=s.pointerId,c=s.pointerType,{cancelable:d,timestamp:u}=e;return{type:t,x:i,y:r,pointerId:l,pointerType:c,button:n,buttons:a,native:s,timestamp:u,eventId:o,cancelable:d,stopPropagation:()=>e.stopPropagation(),preventDefault:()=>e.preventDefault()}}wrapPointerDrag(e){const{x:t,y:i,buttons:r,native:n,eventId:a}=e.data.currentEvent,{button:s}=e.data.startEvent,o=e.data.startEvent.native.pointerId,l=e.data.startEvent.native.pointerType,c=e.data.action,d={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:u,timestamp:h}=e;return{type:"pointer-drag",x:t,y:i,pointerId:o,pointerType:l,button:s,buttons:r,action:c,origin:d,native:n,timestamp:h,eventId:a,cancelable:u,stopPropagation:()=>e.stopPropagation(),preventDefault:()=>e.preventDefault()}}wrapMouseWheel(e){const{cancelable:t,data:i,timestamp:r}=e,{x:n,y:a,deltaY:s,native:o}=i;return{type:"mouse-wheel",x:n,y:a,deltaY:s,native:o,timestamp:r,cancelable:t,stopPropagation:()=>e.stopPropagation(),preventDefault:()=>e.preventDefault()}}wrapGamepad(e){const{action:t,state:i,device:r}=e.data,{cancelable:n,timestamp:a}=e,{buttons:s,axes:o}=i;return{type:"gamepad",device:r,timestamp:a,action:t,buttons:s,axes:o,cancelable:n,stopPropagation:()=>e.stopPropagation(),preventDefault:()=>e.preventDefault()}}}i(414),i(308);var nt=i(452);let at=class extends P.a{constructor(){super(...arguments),this.items=new z.a,this._watchUpdatingTracking=new Te.a,this._callbacks=new Map,this._projector=Object(nt.a)(),this._hiddenProjector=Object(nt.a)()}get needsRender(){return this.items.length>0}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(this.items,e=>{e.added.map(e=>{const t=()=>e.render();this._callbacks.set(e,t),this._projector.append(this.surface,t)}),e.removed.map(e=>{const t=this._projector.detach(this._callbacks.get(e));this.surface.removeChild(t.domNode),this._callbacks.delete(e)})})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const t=this._hiddenSurface,i=this._hiddenProjector;let r=null;const n=()=>(r=e.render(),r);i.append(t,n),i.renderNow();const a={left:0,top:0,right:0,bottom:0};if(r&&r.domNode){const e=r.domNode.getBoundingClientRect();a.left=e.left,a.top=e.top,a.right=e.right,a.bottom=e.bottom}for(i.detach(n);t.firstChild;)t.removeChild(t.firstChild);return a}overlaps(e,t){const i=this.computeBoundingRect(e),r=this.computeBoundingRect(t);return Math.max(i.left,r.left)<=Math.min(i.right,r.right)&&Math.max(i.top,r.top)<=Math.min(i.bottom,r.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}renderCanvas(e){if(!this.items.some(e=>e.visible))return;const t=e.getContext("2d");t.save(),t.font="10px "+getComputedStyle(this.surface).fontFamily,this.items.forEach(e=>{t.save(),e.renderCanvas(t),t.restore()}),t.restore()}};Object(n.a)([Object(c.b)({readOnly:!0})],at.prototype,"surface",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],at.prototype,"items",void 0),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["items.length"]})],at.prototype,"needsRender",null),Object(n.a)([Object(c.b)({readOnly:!0})],at.prototype,"_watchUpdatingTracking",void 0),Object(n.a)([Object(c.b)({readOnly:!0,aliasOf:"_watchUpdatingTracking.updating"})],at.prototype,"updating",void 0),at=Object(n.a)([Object(u.a)("esri.views.overlay.ViewOverlay")],at);var st=i(54),ot=i(102),lt=i(122),ct=i(125),dt=i(160);i(154);function ut(e,t,i,r){let n=null,a=1e3;"number"==typeof t?(a=t,r=i):(n=null!=t?t:null,a=i);let s,o=0;const l=()=>{o=0,e.apply(r,s)},c=(...e)=>{n&&n.apply(r,e),s=e,a?o||(o=setTimeout(l,a)):l()};return c.remove=()=>{o&&(clearTimeout(o),o=0)},c.forceUpdate=()=>{o&&(clearTimeout(o),l())},c.hasPendingUpdates=()=>!!o,c}var ht=i(113),pt=i(309),bt=i(215),ft=i(201),yt=i(310),gt=i(189),mt=(i(216),i(235)),vt=i(415);const Ot=e=>{let t=class extends e{constructor(){super(...arguments),this.renderNodeContent=e=>Object(vt.b)(e)&&!e.destroyed?Object(gt.a)("div",{key:e},e.render()):e instanceof HTMLElement?Object(gt.a)("div",{key:e,bind:e,afterCreate:this._attachToNode}):Object(vt.a)(e)?Object(gt.a)("div",{key:e,bind:e.domNode,afterCreate:this._attachToNode}):null}_attachToNode(e){e.appendChild(this)}};return t=Object(n.a)([Object(u.a)("esri.widgets.Feature.ContentMixin")],t),t};var _t=i(44);i(110);const jt=["B","kB","MB","GB","TB"];var wt=i(249),Mt=i(241),It=i(82),Tt=i(185);const Ct=o.a.getLogger("esri.widgets.Feature.support.featureUtils"),kt=/href=(""|'')/gi,xt=/(\{([^\{\r\n]+)\})/g,St=/\'/g,Ft=/^\s*expression\//i,Et=/(\n)/gi,Lt=/[\u00A0-\u9999<>\&]/gim,At=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,Pt=/^(?:mailto:|tel:)/,Rt=Object(lt.a)("short-date-short-time");function Vt(e){if(e)return e.get("sourceLayer")||e.get("layer")}async function Nt(e,t){return"function"==typeof e?e.call(null,t):e}function Dt(e=""){if(e)return!Pt.test(e.trim().toLowerCase())}function Ut(e,t){const i=function(e,t){if(!function(e){return Ft.test(e)}(t)||!e)return null;const i=t.replace(Ft,"").toLowerCase();let r;return e.some(e=>e.name.toLowerCase()===i&&(r=e,!0)),r}(t,null==e?void 0:e.fieldName);return i?i.title||null:e?e.label||e.fieldName:null}function Bt(e,t){const i=zt(t,e);return i?i.name:e}function zt(e,t){return e&&"function"==typeof e.getField?e.getField(t):null}function Gt(e){return(""+e).trim()}function Wt({formattedAttributes:e,template:t,fieldInfoMap:i}){return Gt(Object(_t.c)(Object(_t.c)(t,e=>function(e,t){const i=t.get(e.toLowerCase());return`{${i&&i.fieldName||e}}`}(e,i)),e).replace(kt,""))}function Ht(e,t){return e.replace(xt,(e,i,r)=>{const n=zt(t,r);return n?`{${n.name}}`:i})}function qt(e,t,i){const r=Ht(e,i);return r?r.replace(At,(e,i,r)=>function(e,t,i){const r=(t=Gt(t))&&"{"!==t[0];return Object(_t.c)(e,function(e,t=!1){const i={...e};return Object.keys(i).forEach(e=>function(e,t,i=!1){const r=t[e];if("string"==typeof r){const n="%27",a=(i?encodeURIComponent(r):r).replace(St,n);t[e]=a}}(e,i,t)),i}(i,r))}(e,i||r,t)):r}function $t(e,t){const i=t.fieldInfos,r=t.fieldName,n=Kt(i,r),a=null==n?void 0:n.clone(),s=t.preventPlacesFormatting,o=zt(t.layer,r);if(o&&"date"===o.type){const e=a.format||new Tt.a;e.dateFormat=e.dateFormat||"short-date-short-time",a.format=e}const l=a&&a.format;return"string"==typeof(e=function(e,t){if("string"==typeof e&&t&&null==t.dateFormat&&(null!=t.places||null!=t.digitSeparator)){const t=Number(e);if(!isNaN(t))return t}return e}(e,l))||null==e||null==l?e:s?Object(ct.b)(e,{...Object(ct.a)(l),minimumFractionDigits:0,maximumFractionDigits:20}):l.format(e)}function Kt(e,t){if(!e||!e.length||!t)return;const i=t.toLowerCase();let r=void 0;return e.some(e=>!(!e.fieldName||e.fieldName.toLowerCase()!==i||(r=e,0))),r}function Jt(e){const t=[];if(!e)return t;const{fieldInfos:i,content:r}=e;return i&&t.push(...i),r&&Array.isArray(r)?(r.forEach(e=>{if("fields"===e.type){const i=e&&e.fieldInfos;t.push(...i)}}),t):t}function Qt(e){return e.replace(Lt,e=>`&#${e.charCodeAt(0)};`)}function Zt(e){return"string"==typeof e?e.replace(Et,'<br class="esri-text-new-line" />'):e}function Yt({fieldInfos:e,graphic:t,layer:i,fieldInfoMap:r,relatedInfos:n}){const a={...t.attributes};return n.forEach(e=>function(e,t){e&&t&&(t.relatedFeatures&&t.relatedFeatures&&t.relatedFeatures.forEach(i=>ti({attributes:e,graphic:i,relatedInfo:t})),t.relatedStatsFeatures&&t.relatedStatsFeatures&&t.relatedStatsFeatures.forEach(i=>ti({attributes:e,graphic:i,relatedInfo:t})))}(a,e)),Object.keys(a).forEach(n=>{const s=a[n];a[n]=function(e){const{value:t,fieldName:i,fieldInfos:r,fieldInfoMap:n,layer:a,graphic:s}=e;if(null==t)return"";const o=function({fieldName:e,value:t,graphic:i,layer:r}){if(ei(e))return null;if(!r||"function"!=typeof r.getFieldDomain)return null;const n=r.getFieldDomain(e,{feature:i});return n&&"coded-value"===n.type?n.getName(t):null}({fieldName:i,value:t,graphic:s,layer:a});if(o)return o;const l=function({fieldName:e,graphic:t,layer:i}){if(ei(e))return null;if(!i||"function"!=typeof i.getFeatureType)return null;const{typeIdField:r}=i;if(!r||e!==r)return null;const n=i.getFeatureType(t);return n?n.name:null}({fieldName:i,graphic:s,layer:a});if(l)return l;if(n.get(i.toLowerCase()))return $t(t,{fieldInfos:r,fieldName:i,layer:a});const c=a&&a.fieldsIndex;return c&&c.isDateField(i)?Object(lt.b)(t,Rt):Zt(t)}({fieldName:n,fieldInfos:e,fieldInfoMap:r,layer:i,value:s,graphic:t})}),a}async function Xt({graphic:e,popupTemplate:t},i){const r=e.sourceLayer;if(!r||!t)return null;"function"==typeof r.load&&await r.load(i);const n=[e.attributes[r.objectIdField]],a=await t.getRequiredFields(r.fields);if(Object(It.d)(a,e))return null;const s=await async function(e,t){const{layer:i,graphic:r,outFields:n,objectIds:a}=e,s=a[0];if("number"!=typeof s){const e="Could not query required fields for the specified feature. The feature's ID is invalid.",t={layer:i,graphic:r,objectId:s,requiredFields:n},a=new p.a("layer-query-features-invalid-objectid",e,t);throw Ct.warn(e,t),a}if("function"!=typeof i.queryFeatures){const e="The specified layer does not support the method 'queryFeatures'. The following fields will not be available.",t={layer:i,graphic:r,requiredFields:n},a=new p.a("layer-query-features-unsupported",e,t);throw Ct.warn(e,t),a}const o=i.createQuery();return o.objectIds=a,o.outFields=n,o.returnGeometry=!0,(await i.queryFeatures(o,t)).features[0]}({layer:r,graphic:e,outFields:a,objectIds:n},i);s&&(e.geometry=s.geometry,e.attributes={...e.attributes,...s.attributes})}function ei(e=""){return!!e&&-1!==e.indexOf("relationships/")}function ti({attributes:e,graphic:t,relatedInfo:i}){e&&t&&i&&Object.keys(t.attributes).forEach(r=>{const n=(a={layerId:i.relation.id.toString(),fieldName:r})?`relationships/${a.layerId}/${a.fieldName}`:"";var a;e[n]=t.attributes[r]})}const ii={editing:!1,operations:{add:!0,update:!0,delete:!0}},ri=z.a.ofType(Mt.a);let ni=class extends k.a{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.abilities={...ii},this.activeAttachmentInfo=null,this.attachmentInfos=new ri,this.graphic=null,this.mode="view",this.handles.add([Object(me.a)(this,"graphic",()=>this._graphicChanged())])}destroy(){this._attachmentLayer=null,this.graphic=null}castAbilities(e){return{...ii,...e}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){return this.get("graphic.layer.capabilities.operations.supportsResizeAttachments")||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:t}=this;if(!e||"function"!=typeof e.queryAttachments)throw new p.a("invalid-layer","getAttachments(): A valid layer is required.");const i=this._getFeatureId(),r=new wt.a({objectIds:[i],returnMetadata:!0}),n=[],a=e.queryAttachments(r).then(e=>e[i]||n).catch(()=>n);this._getAttachmentsPromise=a,this.notifyChange("state");const s=await a;return t.removeAll(),s.length&&t.addMany(s),this._getAttachmentsPromise=null,this.notifyChange("state"),s}async addAttachment(e){const{_attachmentLayer:t,attachmentInfos:i,graphic:r,abilities:n}=this;if(!e)throw new p.a("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!n.operations.add)throw new p.a("invalid-abilities","addAttachment(): add abilities are required.");if(!t||"function"!=typeof t.addAttachment)throw new p.a("invalid-layer","addAttachment(): A valid layer is required.");const a=t.addAttachment(r,e).then(e=>this._queryAttachment(e.objectId)),s=await a;return i.add(s),s}async deleteAttachment(e){const{_attachmentLayer:t,attachmentInfos:i,graphic:r,abilities:n}=this;if(!e)throw new p.a("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!n.operations.delete)throw new p.a("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!t||"function"!=typeof t.deleteAttachments)throw new p.a("invalid-layer","deleteAttachment(): A valid layer is required.");const a=t.deleteAttachments(r,[e.id]).then(()=>e),s=await a;return i.remove(s),s}async updateAttachment(e,t=this.activeAttachmentInfo){const{_attachmentLayer:i,attachmentInfos:r,graphic:n,abilities:a}=this;if(!e)throw new p.a("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!t)throw new p.a("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:t});if(!a.operations.update)throw new p.a("invalid-abilities","updateAttachment(): Update abilities are required.");const s=r.findIndex(e=>e===t);if(!i||"function"!=typeof i.updateAttachment)throw new p.a("invalid-layer","updateAttachment(): A valid layer is required.");const o=i.updateAttachment(n,t.id,e).then(e=>this._queryAttachment(e.objectId)),l=await o;return r.splice(s,1,l),l}async _queryAttachment(e){if(!e)throw new p.a("invalid-attachment-id","Could not query attachment.");const{_attachmentLayer:t}=this,i=this._getFeatureId(),r=new wt.a({objectIds:[i],attachmentsWhere:"AttachmentId="+e,returnMetadata:!0});return t.queryAttachments(r).then(e=>e[i][0])}_getFeatureId(){const{_attachmentLayer:e,graphic:t}=this;if(!e||!t)return null;const{objectIdField:i}=e,{attributes:r}=t;return r&&r[i]}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))}_setAttachmentLayer(){const{graphic:e}=this,t=Vt(e);this._attachmentLayer=t?"scene"===t.type&&Object(s.h)(t.associatedLayer)?t.associatedLayer:t:null}};Object(n.a)([Object(c.b)()],ni.prototype,"abilities",void 0),Object(n.a)([Object(q.a)("abilities")],ni.prototype,"castAbilities",null),Object(n.a)([Object(c.b)()],ni.prototype,"activeAttachmentInfo",void 0),Object(n.a)([Object(c.b)({readOnly:!0,type:ri})],ni.prototype,"attachmentInfos",void 0),Object(n.a)([Object(c.b)({type:Oe.a})],ni.prototype,"graphic",void 0),Object(n.a)([Object(c.b)()],ni.prototype,"mode",void 0),Object(n.a)([Object(c.b)({dependsOn:["graphic"],readOnly:!0})],ni.prototype,"state",null),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["graphic","graphic.layer","graphic.layer.loaded","graphic.layer.capabilities.operations.supportsResizeAttachments"]})],ni.prototype,"supportsResizeAttachments",null),ni=Object(n.a)([Object(u.a)("esri.widgets.Attachments.AttachmentsViewModel")],ni);var ai=ni,si=i(143);const oi=Object(si.b)("esri/themes/base/images/files/");const li={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},ci="esri-attachments__file-fieldset",di="esri-attachments__file-label",ui="esri-attachments__file-input",hi="esri-button",pi="esri-button--disabled",bi="esri-button--secondary",fi="esri-button--tertiary",yi="esri-button--third",gi="esri-button--small",mi="esri-button--half",vi=window.CSS;let Oi=class extends mt.a{constructor(e,t){super(e,t),this.abilities=null,this.displayType="list",this.graphic=null,this.label=void 0,this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=new ai,this.visibleElements={...li},this._supportsImageOrientation=vi&&vi.supports&&vi.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}initialize(){this.own(Object(me.b)(this,"viewModel.attachmentInfos","change",()=>this.scheduleRender()),Object(me.a)(this,"viewModel.mode",()=>this._modeChanged()))}castVisibleElements(e){return{...li,...e}}addAttachment(){const{_addAttachmentForm:e,viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.addAttachment(e).then(e=>(this._set("submitting",!1),this._set("error",null),t.mode="view",e)).catch(e=>{throw this._set("submitting",!1),this._set("error",new p.a("attachments:add-attachment",this.messages.addErrorMessage,e)),e})}deleteAttachment(e){const{viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.deleteAttachment(e).then(e=>(this._set("submitting",!1),this._set("error",null),t.mode="view",e)).catch(e=>{throw this._set("submitting",!1),this._set("error",new p.a("attachments:delete-attachment",this.messages.deleteErrorMessage,e)),e})}updateAttachment(){const{viewModel:e}=this,{_updateAttachmentForm:t}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(t).then(t=>(this._set("submitting",!1),this._set("error",null),e.mode="view",t)).catch(e=>{throw this._set("submitting",!1),this._set("error",new p.a("attachments:update-attachment",this.messages.updateErrorMessage,e)),e})}render(){const{submitting:e,viewModel:t}=this,{state:i}=t;return Object(gt.a)("div",{class:this.classes("esri-attachments","esri-widget")},e?this.renderProgressBar():null,"loading"===i?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())}renderErrorMessage(){const{error:e,visibleElements:t}=this;return e&&t.errorMessage?Object(gt.a)("div",{key:"error-message",class:"esri-attachments__error-message"},e.message):null}renderAttachments(){const{mode:e,activeAttachmentInfo:t}=this.viewModel;return"add"===e?this.renderAddForm():"edit"===e?this.renderDetailsForm(t):this.renderAttachmentContainer()}renderLoading(){return Object(gt.a)("div",{class:"esri-attachments__loader-container",key:"loader"},Object(gt.a)("div",{class:"esri-attachments__loader"}))}renderProgressBar(){return this.visibleElements.progressBar?Object(gt.a)("div",{class:"esri-attachments__progress-bar",key:"progress-bar"}):null}renderAddForm(){const{submitting:e,selectedFile:t}=this,i=e||!t,r=this.visibleElements.cancelAddButton?Object(gt.a)("button",{type:"button",bind:this,disabled:e,onclick:this._cancelForm,class:this.classes(hi,fi,gi,mi,e&&pi)},this.messages.cancel):null,n=this.visibleElements.addSubmitButton?Object(gt.a)("button",{type:"submit",disabled:i,class:this.classes(hi,bi,gi,mi,{[pi]:i})},this.messages.add):null,a=t?Object(gt.a)("span",{key:"file-name",class:"esri-attachments__file-name"},t.name):null,s=Object(gt.a)("form",{bind:this,afterCreate:ht.f,afterRemoved:ht.c,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},Object(gt.a)("fieldset",{class:ci},a,Object(gt.a)("label",{class:this.classes(di,hi,bi)},t?this.messages.changeFile:this.messages.selectFile,Object(gt.a)("input",{class:ui,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),n,r);return Object(gt.a)("div",{key:"add-form-container",class:"esri-attachments__form-node"},s)}renderDetailsForm(e){const{visibleElements:t,viewModel:i,selectedFile:r,submitting:n}=this,{contentType:a,size:s,url:o}=e,{abilities:l}=i,c=n||!r,d=l.editing&&l.operations.delete&&t.deleteButton?Object(gt.a)("button",{key:"delete-button",type:"button",disabled:n,bind:this,onclick:t=>this._submitDeleteAttachment(t,e),class:this.classes(hi,gi,fi,"esri-attachments__delete-button",{[pi]:n})},this.messages.delete):null,u=l.editing&&l.operations.update&&t.updateButton?Object(gt.a)("button",{disabled:c,key:"update-button",type:"submit",class:this.classes(hi,gi,yi,{[pi]:c})},this.messages.update):null,h=this.visibleElements.cancelUpdateButton?Object(gt.a)("button",{disabled:n,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes(hi,gi,fi,yi,{[pi]:n})},this.messages.cancel):null,p=r?Object(gt.a)("span",{key:"file-name",class:"esri-attachments__file-name"},r.name):null,b=l.editing&&l.operations.update?Object(gt.a)("fieldset",{key:"file",class:ci},p,Object(gt.a)("label",{class:this.classes(di,hi,bi)},this.messages.changeFile,Object(gt.a)("input",{class:ui,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):null,f=Object(gt.a)("fieldset",{key:"size",class:"esri-attachments__metadata-fieldset"},Object(gt.a)("label",null,function(e,t){let i=0===t?0:Math.floor(Math.log(t)/Math.log(1024));i=Object(Re.c)(i,0,jt.length-1);const r=Object(ct.b)(t/Math.pow(1024,i),{maximumFractionDigits:2});return Object(_t.c)(e.units.bytes[jt[i]],{fileSize:r})}(this.messagesUnits,s))),y=Object(gt.a)("fieldset",{key:"content-type",class:"esri-attachments__metadata-fieldset"},Object(gt.a)("label",null,a)),g=Object(gt.a)("form",{bind:this,afterCreate:ht.f,afterRemoved:ht.c,"data-node-ref":"_updateAttachmentForm",onsubmit:this._submitUpdateAttachment},Object(gt.a)("div",{class:"esri-attachments__metadata"},f,y),b,Object(gt.a)("div",{class:"esri-attachments__actions"},d,h,u));return Object(gt.a)("div",{key:"edit-form-container",class:"esri-attachments__form-node"},Object(gt.a)("a",{class:"esri-attachments__item-link",href:o,rel:"noreferrer",target:"_blank",alt:name},this.renderImageMask({attachmentInfo:e,size:400}),Object(gt.a)("div",{class:"esri-attachments__item-link-overlay"},Object(gt.a)("span",{class:"esri-attachments__item-link-overlay-icon"},Object(gt.a)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},Object(gt.a)("path",{d:"M28 13h1v16H3V3h16v1H4v24h24zm-5-9h4.293L15.646 15.638l.707.707L28 4.707V9h1V3h-6z"}),Object(gt.a)("path",{fill:"none",d:"M0 0h32v32H0z"}))))),g)}renderImageMask({attachmentInfo:e,size:t}){const{supportsResizeAttachments:i}=this.viewModel,{contentType:r,url:n}=e,a=i&&function(e){const t=e.toLowerCase();return"image/bmp"===t||"image/emf"===t||"image/exif"===t||"image/gif"===t||"image/x-icon"===t||"image/jpeg"===t||"image/png"===t||"image/tiff"===t||"image/x-wmf"===t}(r),s=this._getCSSTransform(e,a),o=s?{transform:s,"image-orientation":"none"}:{},l=-1===n.indexOf("?")?"?":"&",c=a?`${n}${l}w=${t}`:function(e){return e?"text/plain"===e?oi+"text-32.svg":"application/pdf"===e?oi+"pdf-32.svg":"text/csv"===e?oi+"csv-32.svg":"application/gpx+xml"===e?oi+"gpx-32.svg":"application/x-dwf"===e?oi+"cad-32.svg":"application/postscript"===e||"application/json"===e||"text/xml"===e||"model/vrml"===e?oi+"code-32.svg":"application/x-zip-compressed"===e||"application/x-7z-compressed"===e||"application/x-gzip"===e||"application/x-tar"===e||"application/x-gtar"===e||"application/x-bzip2"===e||"application/gzip"===e||"application/x-compress"===e||"application/x-apple-diskimage"===e||"application/x-rar-compressed"===e||"application/zip"===e?oi+"zip-32.svg":-1!==e.indexOf("image/")?oi+"image-32.svg":-1!==e.indexOf("audio/")?oi+"sound-32.svg":-1!==e.indexOf("video/")?oi+"video-32.svg":-1!==e.indexOf("msexcel")||-1!==e.indexOf("ms-excel")||-1!==e.indexOf("spreadsheetml")?oi+"excel-32.svg":-1!==e.indexOf("msword")||-1!==e.indexOf("ms-word")||-1!==e.indexOf("wordprocessingml")?oi+"word-32.svg":-1!==e.indexOf("powerpoint")||-1!==e.indexOf("presentationml")?oi+"report-32.svg":oi+"generic-32.svg":oi+"generic-32.svg"}(r),d={"esri-attachments__item-mask--icon":!a},u={"esri-attachments__image--resizable":i};return Object(gt.a)("div",{class:this.classes(d,"esri-attachments__item-mask")},Object(gt.a)("img",{styles:o,alt:"",src:c,class:this.classes(u,"esri-attachments__image")}))}renderAttachmentInfo({attachmentInfo:e,displayType:t}){const{viewModel:i}=this,{abilities:r}=i,{name:n,url:a}=e,s=this.renderImageMask({attachmentInfo:e,size:"list"===t?48:400}),o=r.editing?Object(gt.a)("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-chevron-icon",Object(ht.d)()?"esri-icon-left":"esri-icon-right")}):null,l=[s,Object(gt.a)("label",{class:"esri-attachments__label"},Object(gt.a)("span",{class:"esri-attachments__filename"},n||this.messages.noTitle),o)],c=r.editing?Object(gt.a)("button",{key:"details-button",bind:this,class:"esri-attachments__item-button",title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":e.id,onclick:()=>this._startEditAttachment(e),type:"button"},l):Object(gt.a)("a",{key:"details-link",class:"esri-attachments__item-button",href:a,target:"_blank"},l);return Object(gt.a)("li",{class:"esri-attachments__item",key:e},c)}renderAttachmentContainer(){const{displayType:e,viewModel:t,visibleElements:i}=this,{attachmentInfos:r,abilities:n}=t,a=r&&r.length,s={"esri-attachments__container--list":"preview"!==e,"esri-attachments__container--preview":"preview"===e},o=n.editing&&n.operations.add&&i.addButton?Object(gt.a)("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes(hi,fi,"esri-attachments__add-attachment-button"),type:"button"},Object(gt.a)("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-add-icon","esri-icon-plus")}),this.messages.add):null,l=a?Object(gt.a)("ul",{class:"esri-attachments__items"},r.toArray().map(t=>this.renderAttachmentInfo({attachmentInfo:t,displayType:e}))):Object(gt.a)("div",{class:"esri-widget__content--empty"},this.messages.noAttachments);return Object(gt.a)("div",{key:"attachments-container",class:this.classes("esri-attachments__container",s)},l,o)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){const t=e.target,i=t&&t.files&&t.files.item(0);this._set("selectedFile",i)}_submitDeleteAttachment(e,t){e.preventDefault(),this.deleteAttachment(t)}_submitAddAttachment(e){e.preventDefault(),this.addAttachment()}_submitUpdateAttachment(e){e.preventDefault(),this.updateAttachment()}_startEditAttachment(e){const{viewModel:t}=this;t.activeAttachmentInfo=e,t.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e,t){const{orientationInfo:i}=e;return!this._supportsImageOrientation&&t&&i?[i.rotation?`rotate(${i.rotation}deg)`:"",i.mirrored?"scaleX(-1)":""].join(" "):""}};Object(n.a)([Object(R.a)("viewModel.abilities")],Oi.prototype,"abilities",void 0),Object(n.a)([Object(c.b)(),Object(ft.a)()],Oi.prototype,"displayType",void 0),Object(n.a)([Object(R.a)("viewModel.graphic")],Oi.prototype,"graphic",void 0),Object(n.a)([Object(c.b)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Oi.prototype,"label",void 0),Object(n.a)([Object(c.b)(),Object(ft.a)(),Object(bt.a)("esri/widgets/Attachments/t9n/Attachments")],Oi.prototype,"messages",void 0),Object(n.a)([Object(c.b)(),Object(ft.a)(),Object(bt.a)("esri/core/t9n/Units")],Oi.prototype,"messagesUnits",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],Oi.prototype,"selectedFile",void 0),Object(n.a)([Object(ft.a)(),Object(c.b)({readOnly:!0})],Oi.prototype,"submitting",void 0),Object(n.a)([Object(ft.a)(),Object(c.b)({readOnly:!0})],Oi.prototype,"error",void 0),Object(n.a)([Object(c.b)({type:ai}),Object(ft.a)(["viewModel.activeAttachmentInfo","viewModel.mode","viewModel.state","viewModel.supportsResizeAttachments","viewModel.attachmentInfos","viewModel.graphic","viewModel.abilities","viewModel.abilities.editing","viewModel.abilities.operations"])],Oi.prototype,"viewModel",void 0),Object(n.a)([Object(c.b)(),Object(ft.a)()],Oi.prototype,"visibleElements",void 0),Object(n.a)([Object(q.a)("visibleElements")],Oi.prototype,"castVisibleElements",null),Oi=Object(n.a)([Object(u.a)("esri.widgets.Attachments")],Oi);var _i=Oi,ji=i(14);i(45);let wi=class extends(Object(k.b)(P.a)){constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.handles.add(Object(me.a)(this,"creator",e=>{this._destroyContent(),this._createContent(e)}))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:e,graphic:t,destroyer:i}=this;e&&(Nt(i,{graphic:t}).catch(()=>null),this._set("created",null))}async _createContent(e){const{graphic:t}=this,i=Nt(e,{graphic:t}).catch(()=>null);this._loadingPromise=i,this.notifyChange("state");const r=await i;i===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",r))}};Object(n.a)([Object(c.b)({readOnly:!0})],wi.prototype,"created",void 0),Object(n.a)([Object(c.b)()],wi.prototype,"creator",void 0),Object(n.a)([Object(c.b)()],wi.prototype,"destroyer",void 0),Object(n.a)([Object(c.b)({type:Oe.a})],wi.prototype,"graphic",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],wi.prototype,"state",null),wi=Object(n.a)([Object(u.a)("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],wi);var Mi=wi;let Ii=class extends mt.a{constructor(e,t){super(e,t),this.creator=null,this.graphic=null,this.viewModel=null,this._addTargetToAnchors=e=>{Object(ji.c)(e.querySelectorAll("a")).forEach(e=>{Dt(e.href)&&!e.hasAttribute("target")&&e.setAttribute("target","_blank")})}}renderLoading(){return Object(gt.a)("div",{class:"esri-feature-content__loader-container",key:"loader"},Object(gt.a)("div",{class:"esri-feature-content__loader"}))}renderCreated(){var e;const t=null==(e=this.viewModel)?void 0:e.created;return t?t instanceof HTMLElement?Object(gt.a)("div",{key:t,bind:t,afterCreate:this._attachToNode}):Object(vt.b)(t)?Object(gt.a)("div",{key:t},!t.destroyed&&t.render()):Object(gt.a)("div",{key:t,innerHTML:t,afterCreate:this._addTargetToAnchors}):null}render(){var e;const t=null==(e=this.viewModel)?void 0:e.state;return Object(gt.a)("div",{class:"esri-feature-content"},"loading"===t?this.renderLoading():this.renderCreated())}_attachToNode(e){e.appendChild(this)}};Object(n.a)([Object(R.a)("viewModel.creator")],Ii.prototype,"creator",void 0),Object(n.a)([Object(R.a)("viewModel.graphic")],Ii.prototype,"graphic",void 0),Object(n.a)([Object(ft.a)(["viewModel.created","viewModel.state"]),Object(c.b)({type:Mi})],Ii.prototype,"viewModel",void 0),Ii=Object(n.a)([Object(u.a)("esri.widgets.Feature.FeatureContent")],Ii);var Ti=Ii,Ci=i(167),ki=i(349);let xi=class extends P.a{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.fieldInfos=null}get formattedFieldInfos(){const{expressionInfos:e,fieldInfos:t}=this,i=[];return null==t||t.forEach(t=>{if(t.hasOwnProperty("visible")&&!t.visible)return;const r=t.clone();r.label=Ut(r,e),i.push(r)}),i}};Object(n.a)([Object(c.b)()],xi.prototype,"attributes",void 0),Object(n.a)([Object(c.b)({type:[ki.a]})],xi.prototype,"expressionInfos",void 0),Object(n.a)([Object(c.b)({type:[Ci.a]})],xi.prototype,"fieldInfos",void 0),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["expressionInfos","fieldInfos"]})],xi.prototype,"formattedFieldInfos",null),xi=Object(n.a)([Object(u.a)("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],xi);var Si=xi;const Fi=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];let Ei=class extends mt.a{constructor(e,t){super(e,t),this.attributes=null,this.expressionInfos=null,this.fieldInfos=null,this.viewModel=new Si,this.messages=null,this.messagesURIUtils=null}renderFieldInfo(e,t){const{attributes:i}=this.viewModel,r=e.fieldName,n=e.label||r,a=i?null==i[r]?"":i[r]:"",s=!(!e.format||!e.format.dateFormat),o="number"!=typeof a||s?function(e,t){if("string"!=typeof t||!t)return t;const i=function(e){let t=null;return Fi.some(i=>(i.pattern.test(e)&&(t=i),!!t)),t}(t);if(!i)return t;const r=t.match(i.pattern),n=r&&r[2],a=Object(_t.c)(Object(_t.c)(i.label,{messages:e,hierPart:n}),{appName:i.appName}),s=i.target?` target="${i.target}"`:"",o="_blank"===i.target?' rel="noreferrer"':"";return t.replace(i.pattern,`<a${s} href="$1"${o}>${a}</a>`)}(this.messagesURIUtils,a):this._forceLTR(a),l={"esri-feature-fields__field-data--date":s};return Object(gt.a)("tr",{key:`fields-element-info-row-${r}-${t}`},Object(gt.a)("th",{key:`fields-element-info-row-header-${r}-${t}`,class:"esri-feature-fields__field-header",innerHTML:n}),Object(gt.a)("td",{key:`fields-element-info-row-data-${r}-${t}`,class:this.classes("esri-feature-fields__field-data",l),innerHTML:o}))}renderFields(){const{formattedFieldInfos:e}=this.viewModel;return e.length?Object(gt.a)("table",{class:"esri-widget__table",summary:this.messages.fieldsSummary},Object(gt.a)("tbody",null,e.map((e,t)=>this.renderFieldInfo(e,t)))):null}render(){return Object(gt.a)("div",{class:"esri-feature-fields"},this.renderFields())}_forceLTR(e){return"&lrm;"+e}};Object(n.a)([Object(R.a)("viewModel.attributes")],Ei.prototype,"attributes",void 0),Object(n.a)([Object(R.a)("viewModel.expressionInfos")],Ei.prototype,"expressionInfos",void 0),Object(n.a)([Object(R.a)("viewModel.fieldInfos")],Ei.prototype,"fieldInfos",void 0),Object(n.a)([Object(c.b)({type:Si}),Object(ft.a)(["viewModel.attributes","viewModel.formattedFieldInfos"])],Ei.prototype,"viewModel",void 0),Object(n.a)([Object(c.b)(),Object(ft.a)(),Object(bt.a)("esri/widgets/Feature/t9n/Feature")],Ei.prototype,"messages",void 0),Object(n.a)([Object(c.b)(),Object(ft.a)(),Object(bt.a)("esri/widgets/support/t9n/uriUtils")],Ei.prototype,"messagesURIUtils",void 0),Ei=Object(n.a)([Object(u.a)("esri.widgets.Feature.FeatureFields")],Ei);var Li=Ei,Ai=i(397),Pi=i(126),Ri=i(108),Vi=i(257);const Ni=o.a.getLogger("esri.widgets.Feature.support.relatedFeatureUtils"),Di=new Map;function Ui(e){if(!ei(e))return null;const[t,i]=e.split("/").slice(1);return{layerId:t,fieldName:i}}let Bi=class extends P.a{constructor(e){super(e),this.activeMediaInfoIndex=0,this.attributes=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){const{formattedMediaInfoCount:t}=this,i=(e+t)%t;this.activeMediaInfoIndex=i}_pageContentElementMedia(e){const{activeMediaInfoIndex:t}=this,i=t+e;this._setContentElementMedia(i)}_formatMediaInfos(){const{attributes:e,mediaInfos:t,formattedAttributes:i,fieldInfoMap:r,layer:n}=this,a={...i,...e};return null==t?void 0:t.map(t=>{if(!t)return null;const s=t.title?qt(t.title,a,n):"";t.title=s?Wt({formattedAttributes:i,template:s,fieldInfoMap:r}):"";const o=t.caption?qt(t.caption,a,n):"";t.caption=o?Wt({formattedAttributes:i,template:o,fieldInfoMap:r}):"";const l=t.altText?qt(t.altText,a,n):"";if(t.altText=l?Wt({formattedAttributes:i,template:l,fieldInfoMap:r}):"","image"===t.type){const{value:e}=t;return this._setImageValue({value:e,formattedAttributes:i,layer:n}),t.value.sourceURL?t:void 0}if("pie-chart"===t.type||"line-chart"===t.type||"column-chart"===t.type||"bar-chart"===t.type){const{value:r}=t;return this._setChartValue({value:r,chartType:t.type,attributes:e,formattedAttributes:i,layer:n}),t}return null}).filter(Boolean)}_setImageValue(e){const{fieldInfoMap:t}=this,{value:i,formattedAttributes:r,layer:n}=e,{linkURL:a,sourceURL:s}=i;if(s){const e=Ht(s,n);i.sourceURL=Wt({formattedAttributes:r,template:e,fieldInfoMap:t})}if(a){const e=Ht(a,n);i.linkURL=Wt({formattedAttributes:r,template:e,fieldInfoMap:t})}}_setChartValue(e){const{value:t,attributes:i,formattedAttributes:r,chartType:n,layer:a}=e,{popupTemplate:s,relatedInfos:o}=this,{fields:l,normalizeField:c}=t;if(t.fields=function(e,t){return e&&e.map(e=>Bt(e,t))}(l,a),c&&(t.normalizeField=Bt(c,a)),!l.some(e=>!!(null!=r[e]||ei(e)&&o.size)))return;const d=null==s?void 0:s.fieldInfos;l.forEach(e=>{if(ei(e))return void(t.series=[...t.series,...this._getRelatedChartInfos({fieldInfos:d,fieldName:e,formattedAttributes:r,chartType:n,value:t})]);const a=this._getChartOption({value:t,attributes:i,chartType:n,formattedAttributes:r,fieldName:e,fieldInfos:d});t.series.push(a)})}_getRelatedChartInfos(e){var t;const{fieldInfos:i,fieldName:r,formattedAttributes:n,chartType:a,value:s}=e,o=[],l=Ui(r),{layerId:c,fieldName:d}=l,u=null==(t=this.relatedInfos)?void 0:t.get(c.toString());if(!u)return o;const{relatedFeatures:h,relation:p}=u;if(!p||!h)return o;const{cardinality:b}=p;return h.forEach(e=>{const{attributes:t}=e;t&&Object.keys(t).forEach(e=>{e===d&&o.push(this._getChartOption({value:s,attributes:t,formattedAttributes:n,fieldName:r,chartType:a,relatedFieldName:e,fieldInfos:i}))})}),"one-to-many"===b||"many-to-many"===b?o:[o[0]]}_getTooltip({label:e,value:t,chartType:i}){return"pie-chart"===i?e:`${e}: ${t}`}_getChartOption(e){var t;const{value:i,attributes:r,formattedAttributes:n,fieldName:a,relatedFieldName:s,fieldInfos:o,chartType:l}=e,{layer:c}=this,{normalizeField:d,tooltipField:u}=i,h=d?ei(d)?r[Ui(d).fieldName]:r[d]:null,p=s&&void 0!==r[s]?r[s]:void 0!==r[a]?r[a]:n[a],b=void 0===p?null:p&&h?p/h:p,f=new Ai.a({value:b});if(ei(a)){const e=Ui(a),t=Ui(u),i=t?t.fieldName:null,n=$t(b,{fieldInfos:o,fieldName:s,layer:c,preventPlacesFormatting:!!h}),d=e?e.label||e.fieldName:s,p=i&&void 0!==r[i]?r[i]:d;return f.tooltip=this._getTooltip({label:p,value:n,chartType:l}),f}const y=Kt(o,a),g=Bt(a,c),m=u&&void 0!==n[u]?n[u]:Ut(y||new Ci.a({fieldName:g}),null==(t=this.popupTemplate)?void 0:t.expressionInfos),v=n[g];return f.tooltip=this._getTooltip({label:m,value:v,chartType:l}),f}};Object(n.a)([Object(c.b)()],Bi.prototype,"activeMediaInfoIndex",void 0),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["formattedMediaInfos","activeMediaInfoIndex"]})],Bi.prototype,"activeMediaInfo",null),Object(n.a)([Object(c.b)()],Bi.prototype,"attributes",void 0),Object(n.a)([Object(c.b)()],Bi.prototype,"fieldInfoMap",void 0),Object(n.a)([Object(c.b)()],Bi.prototype,"formattedAttributes",void 0),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["attributes","fieldInfoMap","formattedAttributes","mediaInfos","popupTemplate","layer","relatedInfos"]})],Bi.prototype,"formattedMediaInfos",null),Object(n.a)([Object(c.b)()],Bi.prototype,"layer",void 0),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["formattedMediaInfos"]})],Bi.prototype,"formattedMediaInfoCount",null),Object(n.a)([Object(c.b)()],Bi.prototype,"mediaInfos",void 0),Object(n.a)([Object(c.b)()],Bi.prototype,"popupTemplate",void 0),Object(n.a)([Object(c.b)()],Bi.prototype,"relatedInfos",void 0),Bi=Object(n.a)([Object(u.a)("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],Bi);var zi=Bi,Gi=i(11),Wi=i(212);const Hi=["#ffffff","#858585","#ffbebe","#ffebbe","#ffebaf","#ffffbe","#e9ffbe","#d3ffbe","#beffe8","#bee8ff","#bed2ff","#e8beff","#ffbee8","#ebebeb","#707070","#ff7f7f","#ffa77f","#ffd37f","#ffff73","#d1ff73","#a3ff73","#73ffdf","#73dfff","#73b2ff","#df73ff","#ff73df","#d6d6d6","#5c5c5c","#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ffc5","#00c5ff","#0070ff","#c500ff","#ff00c5","#c2c2c2","#474747","#e60000","#e64c00","#e69800","#e6e600","#98e600","#4ce600","#00e6a9","#00a9e6","#005ce6","#a900e6","#e600a9","#adadad","#242424","#a80000","#a83800","#a87000","#a8a800","#70a800","#38a800","#00a884","#0084a8","#004da8","#8400a8","#a80084","#999999","#1a1a1a","#730000","#732600","#734c00","#737300","#4c7300","#267300","#00734c","#004c73","#002673","#4c0073","#73004c"],qi=[...Hi.slice(30,39),...Hi.slice(28,30).reverse()],$i=(Hi[26],[{name:"default",colors:qi},{name:"cat-dark",colors:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"]},{name:"tropical-bliss",colors:["#fce138","#ff9399","#fcd27e","#f1983c","#a553b7","#b1a9d0","#6ecffc","#4c81cd","#fc6f84","#fc3e5a","#6af689","#48885c"]},{name:"desert-blooms",colors:["#102432","#144d59","#ffc730","#ed9310","#a64f1b","#661510","#d9351a","#b31515","#4a0932","#8c213f","#18382e","#2c6954"]},{name:"under-the-sea",colors:["#bf9727","#607100","#00734c","#704489","#01acca","#024e76","#f09100","#ea311f","#c6004b","#7570b3","#666666","#333333"]},{name:"vibrant-rainbow",colors:["#fffb00","#f5cb11","#9fd40c","#46e39c","#32b8a6","#7ff2fa","#ad00f2","#c461eb","#eb7200","#e8a784","#bf2e2e","#6c7000"]},{name:"ocean-bay",colors:["#191921","#11495c","#78b1c2","#454f4b","#8f8f82","#9be0c0","#87b051","#f7ec88","#ebdcc1","#dbb658","#c43541","#75351e"]},{name:"prairie-summer",colors:["#332424","#751555","#d47013","#d68989","#211173","#82aad6","#7bfaeb","#6ec9a8","#6b6408","#eada40","#ccc54a","#1fc235"]},{name:"pastel-chalk",colors:["#fffd99","#f5e6a4","#c1d48c","#b8e3d0","#a0b8b5","#cbf7fa","#d791f2","#dfc1eb","#f2b983","#e8c4b2","#bf8e8e","#94995c"]},{name:"seq-yellow-orange-red-bright",colors:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74","#ffed85"]},{name:"seq-reds-bright",colors:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae","#fff0dc"]},{name:"seq-purples-bright",colors:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff","#e6e1ff"]},{name:"seq-blues-bright",colors:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9","#e6faff"]},{name:"seq-greens-bright",colors:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9","#f4ffea"]},{name:"seq-browns-bright",colors:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7","#fff8eb"]}]),Ki=Object(Wi.a)([["ar",()=>i.e(151).then(i.bind(null,625)).then((function(e){return e.a}))],["bs-ba",()=>i.e(152).then(i.bind(null,626)).then((function(e){return e.b}))],["ca-es",()=>i.e(153).then(i.bind(null,627)).then((function(e){return e.c}))],["cs-cz",()=>i.e(154).then(i.bind(null,628)).then((function(e){return e.c}))],["da-dk",()=>i.e(155).then(i.bind(null,629)).then((function(e){return e.d}))],["de-de",()=>i.e(157).then(i.bind(null,630)).then((function(e){return e.d}))],["de-ch",()=>i.e(156).then(i.bind(null,631)).then((function(e){return e.d}))],["el-gr",()=>i.e(158).then(i.bind(null,632)).then((function(e){return e.e}))],["en-us",()=>i.e(160).then(i.bind(null,633)).then((function(e){return e.e}))],["en-ca",()=>i.e(159).then(i.bind(null,634)).then((function(e){return e.e}))],["es-es",()=>i.e(161).then(i.bind(null,635)).then((function(e){return e.e}))],["et-ee",()=>i.e(162).then(i.bind(null,636)).then((function(e){return e.e}))],["fi-fi",()=>i.e(163).then(i.bind(null,637)).then((function(e){return e.f}))],["fr-fr",()=>i.e(164).then(i.bind(null,638)).then((function(e){return e.f}))],["he-il",()=>i.e(165).then(i.bind(null,639)).then((function(e){return e.h}))],["hr-hr",()=>i.e(166).then(i.bind(null,640)).then((function(e){return e.h}))],["hu-hu",()=>i.e(167).then(i.bind(null,641)).then((function(e){return e.h}))],["id-id",()=>i.e(168).then(i.bind(null,642)).then((function(e){return e.i}))],["it-it",()=>i.e(171).then(i.bind(null,643)).then((function(e){return e.i}))],["ja-jp",()=>i.e(172).then(i.bind(null,644)).then((function(e){return e.j}))],["ko-kr",()=>i.e(173).then(i.bind(null,645)).then((function(e){return e.k}))],["lt-lt",()=>i.e(174).then(i.bind(null,646)).then((function(e){return e.l}))],["lv-lv",()=>i.e(175).then(i.bind(null,647)).then((function(e){return e.l}))],["nb-no",()=>i.e(176).then(i.bind(null,648)).then((function(e){return e.n}))],["nl-nl",()=>i.e(177).then(i.bind(null,649)).then((function(e){return e.n}))],["pl-pl",()=>i.e(179).then(i.bind(null,650)).then((function(e){return e.p}))],["pt-br",()=>i.e(180).then(i.bind(null,651)).then((function(e){return e.p}))],["pt-pt",()=>i.e(181).then(i.bind(null,652)).then((function(e){return e.p}))],["ro-ro",()=>i.e(182).then(i.bind(null,653)).then((function(e){return e.r}))],["ru-ru",()=>i.e(183).then(i.bind(null,654)).then((function(e){return e.r}))],["sl-sl",()=>i.e(184).then(i.bind(null,655)).then((function(e){return e.s}))],["sr-rs",()=>i.e(185).then(i.bind(null,656)).then((function(e){return e.s}))],["sv-se",()=>i.e(186).then(i.bind(null,657)).then((function(e){return e.s}))],["th-th",()=>i.e(187).then(i.bind(null,658)).then((function(e){return e.t}))],["tr-tr",()=>i.e(188).then(i.bind(null,659)).then((function(e){return e.t}))],["uk-ua",()=>i.e(189).then(i.bind(null,660)).then((function(e){return e.u}))],["vi-vn",()=>i.e(190).then(i.bind(null,661)).then((function(e){return e.v}))],["zh-cn",()=>i.e(191).then(i.bind(null,662)).then((function(e){return e.z}))],["zh-hk",()=>i.e(28).then(i.bind(null,663)).then((function(e){return e.z}))],["zh-tw",()=>i.e(28).then(i.bind(null,663)).then((function(e){return e.z}))]]);let Ji,Qi;async function Zi(e=Object(ot.b)()){if(e=(t=e)?Ki.has(t.toLowerCase())?t.toLowerCase():function(e){const t=e.split("-")[0].toLowerCase(),i=Object(Wi.b)(Ki);let r=null;for(const e of i)if(Object(Gi.e)(e,t)){r=e;break}return r}(t)||"en-us":"en-us",Ji&&e===Qi)return Ji;var t;Ji=i.e(169).then(i.bind(null,664)).then((function(e){return e.i})),Qi=e;try{const[t,r]=await Object(f.a)([Ji,Ki.get(Qi)()]);if(Qi===e&&(t.am4core.options.defaultLocale=r.default),t.am4core.options.suppressWarnings=!Object(a.a)("esri-debug-messages"),t.am4core.options.autoDispose=!0,"function"!=typeof Object.assign){const e=await i.e(178).then(i.bind(null,665));Object.defineProperty(Object,"assign",{value:e.assign,writable:!0,configurable:!0})}}catch{return Ji=null,Qi=null,null}return Ji}const Yi="esri-feature-media__icon";let Xi=class extends mt.a{constructor(e,t){super(e,t),this._refreshTimer=null,this._refreshIntervalInfo=null,this.attributes=null,this.activeMediaInfoIndex=null,this.fieldInfoMap=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.viewModel=new zi,this.messages=null}initialize(){this.own(Object(me.a)(this,["viewModel.activeMediaInfo","viewModel.activeMediaInfoIndex"],()=>this._setupMediaRefreshTimer()))}destroy(){this._clearMediaRefreshTimer()}render(){return Object(gt.a)("div",{bind:this,class:"esri-feature-media",onkeyup:this._handleMediaKeyup},this.renderMedia())}renderMedia(){const{formattedMediaInfoCount:e}=this.viewModel;return e?Object(gt.a)("div",{key:"media-element-container",class:"esri-feature-media__container"},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null}renderImageMediaInfo(e){const{_refreshIntervalInfo:t}=this,{formattedMediaInfoCount:i}=this.viewModel,{value:r,refreshInterval:n,altText:a,title:s,type:o}=e,{sourceURL:l,linkURL:c}=r,d=Dt(c)?"_blank":"_self",u="_blank"===d?"noreferrer":"",h=n?t:null,p=h?h.timestamp:0,b=h?h.sourceURL:l,f=Object(gt.a)("img",{alt:a||s,key:`media-${o}-${i}-${p}`,src:b});return(c?Object(gt.a)("a",{title:s,href:c,rel:u,target:d},f):null)||f}renderChartMediaInfo(e){const{formattedMediaInfoCount:t}=this.viewModel;return Object(gt.a)("div",{key:`media-${e.type}-${t}`,bind:this,class:"esri-feature-media__chart",afterCreate:this._getChartDependencies})}renderMediaInfoType(){const{activeMediaInfo:e}=this.viewModel;return e?"image"===e.type?this.renderImageMediaInfo(e):-1!==e.type.indexOf("chart")?this.renderChartMediaInfo(e):null:null}renderMediaInfo(){const{activeMediaInfo:e}=this.viewModel,t=e.title?Object(gt.a)("div",{key:"media-title",class:"esri-feature-media__item-title",innerHTML:e.title}):null,i=e.caption?Object(gt.a)("div",{key:"media-caption",class:"esri-feature-media__item-caption",innerHTML:e.caption}):null;return Object(gt.a)("div",{key:"media-container",class:"esri-feature-media__item-container"},t,i,Object(gt.a)("div",{key:"media-item-container",class:"esri-feature-media__item"},this.renderMediaInfoType()))}renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;const t="previous"===e,i=t?this.messages.previous:this.messages.next,r=t?this.classes("esri-feature-media__button","esri-feature-media__previous"):this.classes("esri-feature-media__button","esri-feature-media__next"),n=t?this.classes(Yi,"esri-feature-media__previous-icon","esri-icon-left-triangle-arrow"):this.classes(Yi,"esri-feature-media__next-icon","esri-icon-right-triangle-arrow"),a=t?this.classes(Yi,"esri-feature-media__previous-icon--rtl","esri-icon-right-triangle-arrow"):this.classes(Yi,"esri-feature-media__next-icon--rtl","esri-icon-left-triangle-arrow"),s=t?"media-previous":"media-next",o=t?this._previous:this._next;return Object(gt.a)("button",{type:"button",key:s,title:i,"aria-label":i,tabIndex:0,class:r,bind:this,onkeydown:o,onclick:o},Object(gt.a)("span",{"aria-hidden":"true",class:n}),Object(gt.a)("span",{"aria-hidden":"true",class:a}))}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}async _getChartDependencies(e){const t=await Zi(),{activeMediaInfo:i}=this.viewModel;this._renderChart({chartDiv:e,mediaInfo:i,chartsModule:t})}_handleMediaKeyup(e){const t=Object(We.a)(e);"ArrowLeft"===t&&(e.stopPropagation(),this.viewModel.previous()),"ArrowRight"===t&&(e.stopPropagation(),this.viewModel.next())}_renderChart(e){const{chartsModule:t,chartDiv:i,mediaInfo:r}=e,{value:n,type:a}=r,{am4core:s}=t,o=function(e,t="default"){const i=Object(ji.d)($i,e=>e.name===t);return i?i.colors.map(t=>e.color(t)):null}(s);s.useTheme(t.am4themes_animated),s.useTheme((function(e){e instanceof s.ColorSet&&o&&(e.list=o)}));const l="pie-chart"===a?this._createPieChart(e):this._createXYChart(e);i.setAttribute("aria-label",r.altText||r.title),l.data=n.series.map(e=>({tooltip:e.tooltip,value:e.value})).filter(e=>"pie-chart"!==a||e.value>0)}_customizeChartTooltip(e,t){e.label.wrap=!0,e.label.maxWidth=200,e.autoTextColor=!1,e.getFillFromObject=!1,e.label.fill=t.color("#ffffff"),e.background.fill=t.color({r:0,g:0,b:0,a:.7})}_createPieChart(e){const{chartDiv:t,chartsModule:i}=e,{am4core:r,am4charts:n}=i,a=r.create(t,n.PieChart);a.rtl=Object(ht.d)();const s=a.series.push(new n.PieSeries);return s.labels.template.disabled=!0,s.ticks.template.disabled=!0,s.dataFields.value="value",s.dataFields.category="tooltip",this._customizeChartTooltip(s.tooltip,r),a}_getMinSeriesValue(e){let t=0;return e.forEach(e=>t=Math.min(e.value,t)),t}_createColumnChart(e,t){const{chartsModule:i,mediaInfo:r}=t,{value:n}=r,{am4core:a,am4charts:s}=i,o=e.xAxes.push(new s.CategoryAxis);o.dataFields.category="tooltip",o.renderer.labels.template.disabled=!0,this._customizeChartTooltip(o.tooltip,a),o.tooltip.events.on("sizechanged",()=>{o.tooltip.dy=-o.tooltip.contentHeight});const l=e.yAxes.push(new s.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=.05,l.renderer.maxLabelPosition=.95,l.min=this._getMinSeriesValue(n.series),this._customizeChartTooltip(l.tooltip,a),c.wrap=!0;const d=e.series.push(new s.ColumnSeries);d.dataFields.valueY="value",d.dataFields.categoryX="tooltip",e.cursor=new s.XYCursor,n.series.length>15&&(e.scrollbarX=new a.Scrollbar)}_createBarChart(e,t){const{chartsModule:i,mediaInfo:r}=t,{value:n}=r,{am4core:a,am4charts:s}=i,o=e.yAxes.push(new s.CategoryAxis);o.dataFields.category="tooltip",o.renderer.inversed=!0,o.renderer.labels.template.disabled=!0,this._customizeChartTooltip(o.tooltip,a),o.tooltip.events.on("sizechanged",()=>{o.tooltip.dx=o.tooltip.contentWidth});const l=e.xAxes.push(new s.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=.05,l.renderer.maxLabelPosition=.95,l.min=this._getMinSeriesValue(n.series),this._customizeChartTooltip(l.tooltip,a),c.wrap=!0;const d=e.series.push(new s.ColumnSeries);d.dataFields.valueX="value",d.dataFields.categoryY="tooltip",e.cursor=new s.XYCursor,n.series.length>15&&(e.scrollbarY=new a.Scrollbar)}_createLineChart(e,t){const{chartsModule:i,mediaInfo:r}=t,{value:n}=r,{am4core:a,am4charts:s}=i,o=e.xAxes.push(new s.CategoryAxis);o.dataFields.category="tooltip",o.renderer.labels.template.disabled=!0,this._customizeChartTooltip(o.tooltip,a),o.tooltip.events.on("sizechanged",()=>{o.tooltip.dy=-o.tooltip.contentHeight});const l=e.yAxes.push(new s.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=.05,l.renderer.maxLabelPosition=.95,l.min=this._getMinSeriesValue(n.series),this._customizeChartTooltip(l.tooltip,a),c.wrap=!0;const d=e.series.push(new s.LineSeries);d.dataFields.categoryX="tooltip",d.dataFields.valueY="value",e.cursor=new s.XYCursor,n.series.length>15&&(e.scrollbarX=new a.Scrollbar)}_createXYChart(e){const{chartDiv:t,chartsModule:i,mediaInfo:r}=e,{type:n}=r,{am4core:a,am4charts:s}=i,o=a.create(t,s.XYChart);return o.rtl=Object(ht.d)(),"column-chart"===n&&this._createColumnChart(o,e),"bar-chart"===n&&this._createBarChart(o,e),"line-chart"===n&&this._createLineChart(o,e),o}_clearMediaRefreshTimer(){const{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){const t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:this._getImageSource(e,t)},this.scheduleRender()}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:e}=this.viewModel;e&&"image"===e.type&&e.refreshInterval&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){const{refreshInterval:t,value:i}=e;if(!t)return;const r=6e4*t;this._updateMediaInfoTimestamp(i.sourceURL);const n=setInterval(()=>{this._updateMediaInfoTimestamp(i.sourceURL)},r);this._refreshTimer=n}_getImageSource(e,t){const i=-1!==e.indexOf("?")?"&":"?",[r,n=""]=e.split("#");return`${r}${i}timestamp=${t}${n?"#":""}${n}`}};Object(n.a)([Object(R.a)("viewModel.attributes")],Xi.prototype,"attributes",void 0),Object(n.a)([Object(R.a)("viewModel.activeMediaInfoIndex")],Xi.prototype,"activeMediaInfoIndex",void 0),Object(n.a)([Object(R.a)("viewModel.fieldInfoMap")],Xi.prototype,"fieldInfoMap",void 0),Object(n.a)([Object(R.a)("viewModel.layer")],Xi.prototype,"layer",void 0),Object(n.a)([Object(R.a)("viewModel.mediaInfos")],Xi.prototype,"mediaInfos",void 0),Object(n.a)([Object(R.a)("viewModel.popupTemplate")],Xi.prototype,"popupTemplate",void 0),Object(n.a)([Object(R.a)("viewModel.relatedInfos")],Xi.prototype,"relatedInfos",void 0),Object(n.a)([Object(c.b)({type:zi}),Object(ft.a)(["viewModel.formattedMediaInfos","viewModel.activeMediaInfoIndex","viewModel.activeMediaInfo"])],Xi.prototype,"viewModel",void 0),Object(n.a)([Object(c.b)(),Object(ft.a)(),Object(bt.a)("esri/widgets/Feature/t9n/Feature")],Xi.prototype,"messages",void 0),Xi=Object(n.a)([Object(u.a)("esri.widgets.Feature.FeatureMedia")],Xi);var er=Xi,tr=i(150);const ir=["$datastore","$map","$layer"],rr=o.a.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils");async function nr({expressionAttributes:e,info:t,arcadeUtils:i,spatialReference:r,map:n,graphic:a}){const s="expression/"+t.name,o=i.createSyntaxTree(t.expression),l=ir.filter(e=>i.hasVariable(o,e));await i.loadScriptDependencies(o,!0,l);const c=i.getViewInfo({spatialReference:r}),d=i.createExecContext(a,c);d.useAsync=!0,function({arcadeUtils:e,featureSetVars:t,context:i,viewInfo:r,map:n,graphic:a}){t.forEach(t=>{const s=t.toLowerCase(),o={map:n,spatialReference:r.sr};"$map"===s&&(i.vars[s]=e.convertMapToFeatureSetCollection(o)),"$layer"===s&&(i.vars[s]=e.convertFeatureLayerToFeatureSet(a.sourceLayer,r.sr)),"$datastore"===s&&(i.vars[s]=e.convertServiceUrlToWorkspace(a.sourceLayer.url,r.sr))})}({arcadeUtils:i,featureSetVars:l,context:d,viewInfo:c,map:n,graphic:a});const u=i.createFunction(o,d),h=await i.executeAsyncFunction(u,d).catch(e=>rr.error("arcade-execution-error",{error:e,graphic:a,expressionInfo:t}));var p;e[s]="string"==typeof h?Zt(Qt(h)):Array.isArray(h)?function(e){return`<ul class="esri-widget__list">${e.map(e=>`<li>${"string"==typeof e?Zt(Qt(e)):e}</li>`).join("")}</ul>`}(h):h&&"esri.arcade.Dictionary"===h.declaredClass?`<table class="esri-widget__table">${(p=h).keys().map(e=>{const t=p.field(e);return`<tr><th>${e}</th><td>${"string"==typeof t?Zt(Qt(t)):t}</td></tr>`}).join("")}</table>`:h}const ar=o.a.getLogger("esri.widgets.FeatureViewModel");let sr=class extends P.a{constructor(e){super(e),this._handles=new Ee.a,this._featureAbortController=null,this._graphicChangedThrottled=ut(this._graphicChanged,1,this),this.content=null,this.contentViewModels=[],this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.graphic=null,this.lastEditInfo=null,this.relatedInfos=new Map,this.title="",this.view=null,this._handles.add(Object(me.a)(this,["graphic","graphic.sourceLayer.popupTemplate.title","graphic.sourceLayer.popupTemplate.content","graphic.sourceLayer.popupTemplate.expressionInfos","graphic.sourceLayer.popupTemplate.fieldInfos","graphic.sourceLayer.popupTemplate.lastEditInfoEnabled","graphic.sourceLayer.popupTemplate.outFields","graphic.sourceLayer.popupTemplate.relatedRecordsInfo","graphic.popupTemplate.title","graphic.popupTemplate.content","graphic.popupTemplate.expressionInfos","graphic.popupTemplate.fieldInfos","graphic.popupTemplate.lastEditInfoEnabled","graphic.popupTemplate.outFields","graphic.popupTemplate.relatedRecordsInfo"],()=>this._graphicChangedThrottled()))}destroy(){this._clear(),this._cancelFeatureQuery(),this._handles.destroy(),this._handles=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){var e;return(null==(e=this.graphic)?void 0:e.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled))||null}get _graphic(){var e;return(null==(e=this.graphic)?void 0:e.clone())||null}get _fieldInfoMap(){return function(e,t){const i=new Map;return e&&e.forEach(e=>{const r=Bt(e.fieldName,t);e.fieldName=r,i.set(r.toLowerCase(),e)}),i}(Jt(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return Vt(this.graphic)}get spatialReference(){return this.get("view.spatialReference")||null}set spatialReference(e){void 0!==e?this._override("spatialReference",e):this._clearOverride("spatialReference")}get map(){return this.get("view.map")||null}set map(e){void 0!==e?this._override("map",e):this._clearOverride("map")}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(e,t){const i=this.contentViewModels[e];i instanceof zi&&i.setActiveMedia(t)}nextMedia(e){const t=this.contentViewModels[e];t instanceof zi&&t.next()}previousMedia(e){const t=this.contentViewModels[e];t instanceof zi&&t.previous()}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async _graphicChanged(){this._cancelFeatureQuery(),this._clear();const{_graphic:e}=this;if(!e)return;const t=Object(f.c)();this._featureAbortController=t;try{await this._queryFeature({signal:t.signal})}catch(t){ar.error("error","error loading popupTemplate for graphic",{error:t,graphic:e})}this._featureAbortController=null}_cancelFeatureQuery(){const{_featureAbortController:e}=this;e&&e.abort(),this._featureAbortController=null}_compileContent(e){if(this._destroyContentViewModels(),this._graphic)return Array.isArray(e)?e.map((e,t)=>"attachments"===e.type?this._compileAttachments(e,t):"custom"===e.type?this._compileCustom(e,t):"fields"===e.type?this._compileFields(e,t):"media"===e.type?this._compileMedia(e,t):"text"===e.type?this._compileText(e,t):void 0):"string"==typeof e?this._compileText(new tr.a({text:e}),0).text:e}_destroyContentViewModels(){this.contentViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("contentViewModels",[])}_compileAttachments(e,t){const{graphic:i}=this;return this.contentViewModels[t]=new ai({graphic:i}),e}_compileCustom(e,t){const{graphic:i}=this,{creator:r,destroyer:n}=e;return this.contentViewModels[t]=new Mi({graphic:i,creator:r,destroyer:n}),e}_compileFields(e,t){const{_effectivePopupTemplate:i,formattedAttributes:r}=this,n=e.clone(),a=(null==e?void 0:e.fieldInfos)||(null==i?void 0:i.fieldInfos),s=null==i?void 0:i.expressionInfos,o={...r.global,...r.content[t]},l=new Si({attributes:o,expressionInfos:s,fieldInfos:a});return this.contentViewModels[t]=l,n.fieldInfos=l.formattedFieldInfos.slice(0),n}_compileMedia(e,t){const{_graphic:i,_fieldInfoMap:r,_effectivePopupTemplate:n,relatedInfos:a,_sourceLayer:s}=this,o=this.formattedAttributes.global,l=e.clone(),{mediaInfos:c}=l,d=new zi({activeMediaInfoIndex:l.activeMediaInfoIndex||0,attributes:i.attributes,layer:s,fieldInfoMap:r,formattedAttributes:o,mediaInfos:c,popupTemplate:n,relatedInfos:a});return l.mediaInfos=d.formattedMediaInfos.slice(0),this.contentViewModels[t]=d,l}_compileText(e,t){const i=e.clone(),{_graphic:r,_fieldInfoMap:n,_sourceLayer:a}=this;if(i&&i.text){const{attributes:e}=r,t=this.formattedAttributes.global,s=qt(i.text,{...t,...e},a);i.text=Wt({formattedAttributes:t,template:s,fieldInfoMap:n})}return this.contentViewModels[t]=new Mi({graphic:r,creator:i.text}),i}_compileLastEditInfo(){const{_effectivePopupTemplate:e,_graphic:t}=this;if(!e)return;const{lastEditInfoEnabled:i}=e,r=t.get("sourceLayer.editFieldsInfo");return i&&r?function(e,t){const{creatorField:i,creationDateField:r,editorField:n,editDateField:a}=e;if(!t)return;const s=t[a];if("number"==typeof s){const e=t[n];return{type:"edit",date:Object(lt.b)(s,Rt),user:e}}const o=t[r];if("number"==typeof o){const e=t[i];return{type:"create",date:Object(lt.b)(o,Rt),user:e}}return null}(r,t.attributes):void 0}_compileTitle(e){const{_fieldInfoMap:t,_sourceLayer:i}=this,{attributes:r}=this._graphic,n=this.formattedAttributes.global;if(e){return Wt({formattedAttributes:n,template:qt(e,{...n,...r},i),fieldInfoMap:t})}return""}async _getTitle(){const{_effectivePopupTemplate:e,_graphic:t}=this;return Nt(null==e?void 0:e.title,{graphic:t})}async _getContent(){const{_effectivePopupTemplate:e,_graphic:t}=this;return Nt(null==e?void 0:e.content,{graphic:t})}async _createFormattedExpressions({spatialReference:e,graphic:t,map:r}){const n=await async function({popupTemplate:e,spatialReference:t,graphic:r,map:n}){const a=e.expressionInfos,s=[],o={};if(!a||!a.length)return o;const l=await i.e(16).then(i.bind(null,442));for(const e of a)s.push(nr({expressionAttributes:o,info:e,arcadeUtils:l,spatialReference:t,map:n,graphic:r}));return await Object(f.m)(s),o}({popupTemplate:this._effectivePopupTemplate,spatialReference:e,graphic:t,map:r});t.attributes={...t.attributes,...n}}async _queryFeature(e){const{_featureAbortController:t,_graphic:i,_effectivePopupTemplate:r,spatialReference:n,map:a}=this,{content:{value:s},title:{value:o}}=await Object(f.m)({content:this._getContent(),title:this._getTitle()});t===this._featureAbortController&&i&&(await Object(f.m)([this._checkForRelatedFeatures(e),this._createFormattedExpressions({spatialReference:n,graphic:i,map:a}),Xt({graphic:i,popupTemplate:r},e)]),t===this._featureAbortController&&i&&(this._set("formattedAttributes",this._createFormattedAttributes(s)),this._set("title",this._compileTitle(o)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(s)||null)))}_createFormattedAttributes(e){const{_effectivePopupTemplate:t,_graphic:i,relatedInfos:r,_sourceLayer:n,_fieldInfoMap:a}=this,s={global:Yt({fieldInfos:null==t?void 0:t.fieldInfos,graphic:i,layer:n,fieldInfoMap:a,relatedInfos:r}),content:[]};return Array.isArray(e)&&e.forEach((e,t)=>{"fields"===e.type&&e.fieldInfos&&(s.content[t]=Yt({fieldInfos:e.fieldInfos,graphic:i,layer:n,fieldInfoMap:a,relatedInfos:r}))}),s}_checkForRelatedFeatures(e){const{_graphic:t,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(t,Jt(i),e)}async _queryRelatedInfos(e,t,i){const{relatedInfos:r,_sourceLayer:n}=this;if(r.clear(),!n)return;const a=t.filter(e=>e&&ei(e.fieldName));if(!a||!a.length)return;t.forEach(e=>this._configureRelatedInfo(e,n));const s=await function({relatedInfos:e,layer:t},i){const r={};return e.forEach((e,n)=>{const{relation:a}=e;if(!a){const e=new p.a("relation-required","A relation is required on a layer to retrieve related records.");throw Ni.error(e),e}const{relatedTableId:s}=a;if("number"!=typeof s){const e=new p.a("A related table ID is required on a layer to retrieve related records.");throw Ni.error(e),e}const o=`${t.url}/${s}`,l=Di.get(o),c=l||function(e,t){return Object(y.default)(e,{query:{f:"json"},signal:t&&t.signal})}(o,i);l||Di.set(o,c),r[n]=c}),Object(f.m)(r)}({relatedInfos:r,layer:n},i);Object.keys(s).forEach(e=>{var t;const i=r.get(e.toString()),n=null==(t=s[e])?void 0:t.value;i&&n&&(i.layerInfo=n.data)});const o=await function({graphic:e,relatedInfos:t},i){const r={};return t.forEach((t,n)=>{t.layerInfo&&(r[n]=async function(e,t,i){const r=Vt(e).layerId.toString(),{layerInfo:n,queryTask:a,relation:s}=t,o=function(e,t){let i;return e&&e.relationships&&e.relationships.some(e=>""+e.relatedTableId===t&&(i=e,!0)),i}(n,r);if(o){const{keyField:r}=s,{keyField:l}=o,c="string"===function(e,t){let i=void 0;return e.fields.some(e=>e.name===t.keyField&&(i=-1!==["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(e.type)?"number":"string",!0)),i}(n,o)?`${l}='${e.attributes[r]}'`:`${l}=${e.attributes[r]}`,d=a.execute(new Ri.a({where:c,outFields:t.relatedFields}),i),u=t.outStatistics&&t.outStatistics.length>0&&n.supportsStatistics?a.execute(new Ri.a({where:c,outFields:t.relatedFields,outStatistics:t.outStatistics}),i):null,h={features:d};return u&&(h.statsFeatures=u),Object(f.m)(h)}return null}(e,t,i))}),Object(f.m)(r)}({graphic:e,relatedInfos:r},i);return Object.keys(o).forEach(e=>{var t;!function(e,t){if(!t)return;if(!e)return;const{features:i,statsFeatures:r}=e,n=i&&i.value;t.relatedFeatures=n?n.features:[];const a=r&&r.value;t.relatedStatsFeatures=a?a.features:[]}(null==(t=o[e])?void 0:t.value,r.get(e.toString()))}),o}_configureRelatedInfo(e,t){const{relatedInfos:i}=this,r=Ui(e.fieldName);if(!r)return;const{layerId:n,fieldName:a}=r;if(!n)return;const s=i.get(n.toString())||function(e,t){const i=function(e,t){if(!t.relationships)return null;let i=null;const{relationships:r}=t;return r.some(t=>t.id===parseInt(e,10)&&(i=t,!0)),i}(e,t);if(!i)return;const r=`${t.url}/${i.relatedTableId}`;return{url:r,queryTask:new Vi.a({url:r,sourceSpatialReference:t.spatialReference}),relation:i,relatedFields:[],outStatistics:[]}}(n,t);s&&(function({relatedInfo:e,fieldName:t,fieldInfo:i}){if(e.relatedFields.push(t),i.statisticType){const r=new Pi.a({statisticType:i.statisticType,onStatisticField:t,outStatisticFieldName:t});e.outStatistics.push(r)}}({relatedInfo:s,fieldName:a,fieldInfo:e}),this.relatedInfos.set(n,s))}};Object(n.a)([Object(c.b)()],sr.prototype,"_featureAbortController",void 0),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["graphic","graphic.popupTemplate","graphic.sourceLayer","defaultPopupTemplateEnabled"]})],sr.prototype,"_effectivePopupTemplate",null),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["graphic"]})],sr.prototype,"_graphic",null),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["_effectivePopupTemplate","_sourceLayer"]})],sr.prototype,"_fieldInfoMap",null),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["graphic.layer","graphic.sourceLayer"]})],sr.prototype,"_sourceLayer",null),Object(n.a)([Object(c.b)({readOnly:!0})],sr.prototype,"content",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],sr.prototype,"contentViewModels",void 0),Object(n.a)([Object(c.b)({type:Boolean})],sr.prototype,"defaultPopupTemplateEnabled",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],sr.prototype,"formattedAttributes",void 0),Object(n.a)([Object(c.b)({type:Oe.a})],sr.prototype,"graphic",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],sr.prototype,"lastEditInfo",void 0),Object(n.a)([Object(c.b)()],sr.prototype,"relatedInfos",void 0),Object(n.a)([Object(c.b)({dependsOn:["view"]})],sr.prototype,"spatialReference",null),Object(n.a)([Object(c.b)({readOnly:!0})],sr.prototype,"title",void 0),Object(n.a)([Object(c.b)({dependsOn:["view"]})],sr.prototype,"map",null),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["_featureAbortController"]})],sr.prototype,"waitingForContent",null),Object(n.a)([Object(c.b)()],sr.prototype,"view",void 0),sr=Object(n.a)([Object(u.a)("esri.widgets.FeatureViewModel")],sr);var or=sr;const lr="esri-feature__content-element",cr={title:!0,content:!0,lastEditedInfo:!0};let dr=class extends(Ot(mt.a)){constructor(e,t){super(e,t),this._contentWidgets=[],this.graphic=null,this.defaultPopupTemplateEnabled=!1,this.label=void 0,this.messages=null,this.messagesURIUtils=null,this.spatialReference=null,this.title=null,this.visibleElements={...cr},this.map=null,this.view=null,this.viewModel=new or}initialize(){this.own(Object(me.a)(this,"viewModel.contentViewModels",()=>this._setupContentWidgets()))}destroy(){this._destroyContentWidgets()}castVisibleElements(e){return{...cr,...e}}render(){const{waitingForContent:e}=this.viewModel;return Object(gt.a)("div",{class:this.classes("esri-feature","esri-widget")},Object(gt.a)("div",{class:"esri-feature__size-container"},this.renderTitle(),e?this.renderLoading():this.renderContentContainer()))}setActiveMedia(e,t){this.viewModel.setActiveMedia(e,t)}nextMedia(e){this.viewModel.nextMedia(e)}previousMedia(e){this.viewModel.previousMedia(e)}renderLoading(){return Object(gt.a)("div",{key:"loading-container",class:"esri-feature__loading-container"},Object(gt.a)("span",{class:this.classes("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")}))}renderContentContainer(){const{visibleElements:e}=this;return e.content?Object(gt.a)("div",{class:"esri-feature__main-container"},[this.renderContent(),this.renderLastEditInfo()]):null}renderTitle(){const{visibleElements:e,title:t}=this;return e.title?Object(gt.a)("h4",{class:"esri-feature__title",innerHTML:t}):null}renderContent(){const e=this.viewModel.content;if(!e)return null;if(Array.isArray(e))return e.length?Object(gt.a)("div",{key:"content-content-elements"},e.map(this.renderContentElement,this)):null;if("string"==typeof e){const e=this._contentWidgets[0];return!e||e.destroyed?null:Object(gt.a)("div",{key:"content-content"},e.render())}return this.renderNodeContent(e)}renderContentElement(e,t){const{visibleElements:i}=this;if("boolean"!=typeof i.content&&!i.content[e.type])return null;switch(e.type){case"attachments":return this.renderAttachments(t);case"custom":return this.renderCustom(e,t);case"fields":return this.renderFields(t);case"media":return this.renderMedia(t);case"text":return this.renderText(e,t);default:return null}}renderAttachments(e){const t=this._contentWidgets[e];if(!t||t.destroyed)return null;const{state:i,attachmentInfos:r}=t.viewModel;return"loading"===i||r.length>0?Object(gt.a)("div",{key:this._buildKey("attachments-element",e),class:this.classes("esri-feature__attachments",lr)},Object(gt.a)("h2",null,this.messages.attach),t.render()):null}renderCustom(e,t){const{creator:i}=e,r=this._contentWidgets[t];return!r||r.destroyed?null:i?Object(gt.a)("div",{key:this._buildKey("custom-element",t),class:lr},r.render()):null}renderFields(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:Object(gt.a)("div",{key:this._buildKey("fields-element",e),class:lr},t.render())}renderMedia(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:Object(gt.a)("div",{key:this._buildKey("media-element",e),class:lr},t.render())}renderLastEditInfo(){const{visibleElements:e,messages:t}=this,{lastEditInfo:i}=this.viewModel;if(!i||!e.lastEditedInfo)return null;const{date:r,user:n}=i,a="edit"===i.type?n?t.lastEditedByUser:t.lastEdited:n?t.lastCreatedByUser:t.lastCreated,s=Object(dt.a)(a,{date:r,user:n});return Object(gt.a)("div",{key:"edit-info-element",class:this.classes("esri-feature__last-edited-info",lr)},s)}renderText(e,t){const i=e.text,r=this._contentWidgets[t];return!r||r.destroyed?null:i?Object(gt.a)("div",{key:this._buildKey("text-element",t),class:this.classes(lr,"esri-feature__text")},r.render()):null}_buildKey(e,...t){return`${e}__${this.get("viewModel.graphic.uid")||"0"}-${t.join("-")}`}_destroyContentWidgets(){this._contentWidgets.forEach(e=>{e.viewModel=null,e&&!e.destroyed&&e.destroy()}),this._contentWidgets=[]}_setupContentWidgets(){this._destroyContentWidgets();const e=this.get("viewModel.content"),{contentViewModels:t}=this.viewModel;if(Array.isArray(e))e.forEach((e,i)=>{"attachments"===e.type&&(this._contentWidgets[i]=new _i({displayType:e.displayType,viewModel:t[i]})),"fields"===e.type&&(this._contentWidgets[i]=new Li({viewModel:t[i]})),"media"===e.type&&(this._contentWidgets[i]=new er({viewModel:t[i]})),"text"===e.type&&(this._contentWidgets[i]=new Ti({viewModel:t[i]})),"custom"===e.type&&(this._contentWidgets[i]=new Ti({viewModel:t[i]}))},this);else{const e=t[0];e&&!e.destroyed&&(this._contentWidgets[0]=new Ti({viewModel:e}))}this.scheduleRender()}};Object(n.a)([Object(R.a)("viewModel.graphic")],dr.prototype,"graphic",void 0),Object(n.a)([Object(R.a)("viewModel.defaultPopupTemplateEnabled")],dr.prototype,"defaultPopupTemplateEnabled",void 0),Object(n.a)([Object(c.b)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],dr.prototype,"label",void 0),Object(n.a)([Object(c.b)(),Object(ft.a)(),Object(bt.a)("esri/widgets/Feature/t9n/Feature")],dr.prototype,"messages",void 0),Object(n.a)([Object(c.b)(),Object(ft.a)(),Object(bt.a)("esri/widgets/support/t9n/uriUtils")],dr.prototype,"messagesURIUtils",void 0),Object(n.a)([Object(R.a)("viewModel.spatialReference")],dr.prototype,"spatialReference",void 0),Object(n.a)([Object(R.a)("viewModel.title")],dr.prototype,"title",void 0),Object(n.a)([Object(c.b)(),Object(ft.a)()],dr.prototype,"visibleElements",void 0),Object(n.a)([Object(q.a)("visibleElements")],dr.prototype,"castVisibleElements",null),Object(n.a)([Object(R.a)("viewModel.map")],dr.prototype,"map",void 0),Object(n.a)([Object(R.a)("viewModel.view")],dr.prototype,"view",void 0),Object(n.a)([Object(c.b)({type:or}),Object(ft.a)(["viewModel.waitingForContent","viewModel.content","viewModel.lastEditInfo","viewModel.contentViewModels"])],dr.prototype,"viewModel",void 0),dr=Object(n.a)([Object(u.a)("esri.widgets.Feature")],dr);var ur=dr;let hr=class extends B.a.EventedAccessor{constructor(...e){super(...e),this._anchorHandles=new Ee.a,this.location=null,this.screenLocation=null,this.screenLocationEnabled=!1,this.view=null,this._anchorHandles.add([Object(me.d)(this,["screenLocationEnabled","location","view.size","view.stationary"],()=>this._updateScreenPointAndHandle()),Object(me.d)(this,["view","view.ready"],()=>this._wireUpView())])}destroy(){this.view=null,this._anchorHandles&&this._anchorHandles.destroy(),this._anchorHandles=null,this._viewpointHandle=null}_wireUpView(){const e="view";if(this._anchorHandles.remove(e),this._viewpointHandle=null,!this.get("view.ready"))return;this._setScreenLocation();const{view:t}=this,i="3d"===t.type?"camera":"viewpoint",r=Object(me.c)(t,i,()=>this._viewpointChange());this._anchorHandles.add(r,e),this._viewpointHandle=r,this._toggleWatchingViewpoint()}_viewpointChange(){this._setScreenLocation(),this.emit("view-change")}_updateScreenPointAndHandle(){this._setScreenLocation(),this._toggleWatchingViewpoint()}_toggleWatchingViewpoint(){const{_viewpointHandle:e,location:t,screenLocationEnabled:i}=this;e&&(t&&i?e.resume():e.pause())}_setScreenLocation(){const{location:e,view:t,screenLocationEnabled:i}=this,r=this.get("view.ready"),n=i&&e&&r?t.toScreen(e):null;this._set("screenLocation",n)}};Object(n.a)([Object(c.b)()],hr.prototype,"location",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],hr.prototype,"screenLocation",void 0),Object(n.a)([Object(c.b)()],hr.prototype,"screenLocationEnabled",void 0),Object(n.a)([Object(c.b)()],hr.prototype,"view",void 0),hr=Object(n.a)([Object(u.a)("esri.widgets.support.AnchorElementViewModel")],hr);var pr=hr;let br=class extends pr{constructor(e){super(e),this.visible=!1}};Object(n.a)([Object(c.b)()],br.prototype,"visible",void 0),br=Object(n.a)([Object(u.a)("esri.widgets.CompassViewModel")],br);var fr=br;let yr=class extends mt.a{constructor(e,t){super(e,t),this._animationDelay=500,this._animationPromise=null,this.location=null,this.view=null,this.viewModel=new fr,this.visible=!1}initialize(){this.own([Object(me.d)(this,"visible",e=>this._visibleChange(e))])}destroy(){this._animationPromise=null}show(e){const{location:t,promise:i}=e;t&&(this.viewModel.location=t),this.visible=!0;i&&i.catch(()=>{}).then(()=>this.hide())}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:t}=this.viewModel,i=!!t,r={"esri-spinner--start":e&&i,"esri-spinner--finish":!e&&i},n=this._getPositionStyles();return Object(gt.a)("div",{class:this.classes("esri-spinner",r),styles:n})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const t=Object(f.s)(this._animationDelay);this._animationPromise=t,t.catch(()=>{}).then(()=>{this._animationPromise===t&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){const{screenLocation:e,view:t}=this.viewModel;if(!t||!e)return{};const{padding:i}=t;return{left:e.x-i.left+"px",top:e.y-i.top+"px"}}};Object(n.a)([Object(R.a)("viewModel.location")],yr.prototype,"location",void 0),Object(n.a)([Object(R.a)("viewModel.view")],yr.prototype,"view",void 0),Object(n.a)([Object(c.b)({type:fr}),Object(ft.a)(["viewModel.screenLocation","viewModel.screenLocationEnabled"])],yr.prototype,"viewModel",void 0),Object(n.a)([Object(R.a)("viewModel.visible")],yr.prototype,"visible",void 0),yr=Object(n.a)([Object(u.a)("esri.widgets.Spinner")],yr);var gr=yr,mr=i(138),vr=i(76),Or=(i(72),i(263)),_r=i(350),jr=i(399);const wr=new _r.a({id:"zoom-to-feature",title:"{messages.zoom}",className:"esri-icon-zoom-in-magnifying-glass"}),Mr=new _r.a({id:"remove-selected-feature",title:"{messages.remove}",className:"esri-icon-trash"}),Ir=e=>{let t=class extends e{constructor(...e){super(...e),this.goToOverride=null,this.view=null}callGoTo(e){const{view:t}=this;return this.goToOverride?this.goToOverride(t,e):t.goTo(e.target,e.options)}};return Object(n.a)([Object(c.b)()],t.prototype,"goToOverride",void 0),Object(n.a)([Object(c.b)()],t.prototype,"view",void 0),t=Object(n.a)([Object(u.a)("esri.widgets.support.GoTo")],t),t},Tr=z.a.ofType({key:"type",defaultKeyValue:"button",base:Or.a,typeMap:{button:_r.a,toggle:jr.a}}),Cr=o.a.getLogger("esri.widgets.Popup.PopupViewModel");let kr=class extends(Ir(pr)){constructor(e){super(e),this._handles=new Ee.a,this._pendingPromises=new Set,this._zoomToLocation=null,this._fetchFeaturesController=null,this.actions=new Tr([wr.clone()]),this.defaultPopupTemplateEnabled=!1,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.content=null,this.featureViewModels=[],this.highlightEnabled=!0,this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4}initialize(){this._handles.add([Object(me.a)(this,["autoOpenEnabled","view"],()=>this._autoOpenEnabledChange()),this.on("view-change",()=>this._autoClose()),Object(me.d)(this,["highlightEnabled","selectedFeature","visible","view"],()=>this._highlightFeature()),Object(me.d)(this,"view.animation.state",e=>this._animationStateChange(e)),Object(me.d)(this,"location",e=>this._locationChange(e)),Object(me.d)(this,"selectedFeature",e=>this._selectedFeatureChange(e)),this.on("trigger-action",e=>function(e){const{event:t,view:i}=e,{action:r}=t,n=i&&i.popup;if(!r)return Object(f.h)(new p.a("trigger-action:missing-arguments","Event has no action"));if(!n)return Object(f.h)(new p.a("trigger-action:missing-arguments","view.popup is missing"));const{disabled:a,id:s}=r;if(!s)return Object(f.h)(new p.a("trigger-action:invalid-action","action.id is missing"));if(a)return Object(f.h)(new p.a("trigger-action:invalid-action","Action is disabled"));if(s===wr.id)return n.viewModel.zoomToLocation();if(s===Mr.id){n.close();const{selectedFeature:e}=n;if(!e)return Object(f.h)(new p.a("trigger-action:"+Mr.id,"selectedFeature is required",{selectedFeature:e}));const{sourceLayer:t}=e;return t?t.remove(e):i.graphics.remove(e),Object(f.r)()}return Object(f.r)()}({event:e,view:this.view})),Object(me.f)(this,"waitingForResult",()=>this._waitingForResultChange()),Object(me.d)(this,["features","view","view.map","view.spatialReference"],()=>this._updateFeatureVMs())])}destroy(){this._cancelFetchingFeatures(),this._handles.destroy(),this._handles=null,this._pendingPromises.clear(),this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const e=this._get("allActions")||new Tr;e.removeAll();const t=this.selectedFeature&&("function"==typeof this.selectedFeature.getEffectivePopupTemplate&&this.selectedFeature.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled)||this.selectedFeature.popupTemplate),i=t&&t.actions,r=t&&t.overwriteActions?i:i?i.concat(this.actions):this.actions;return r&&r.filter(Boolean).forEach(t=>e.add(t)),e}get featureCount(){return this.features.length}get features(){return this._get("features")||[]}set features(e){const t=e||[];this._set("features",t);const{pendingPromisesCount:i,promiseCount:r,selectedFeatureIndex:n}=this,a=r&&t.length;a&&i&&-1===n?this.selectedFeatureIndex=0:a&&-1!==n||(this.selectedFeatureIndex=t.length?0:-1)}get location(){return this._get("location")||null}set location(e){const t=this.get("view.spatialReference.isWebMercator");e&&e.get("spatialReference.isWGS84")&&t&&(e=Object(mr.b)(e)),this._set("location",e)}get pendingPromisesCount(){return this._pendingPromises.size}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||0!==this.featureCount)}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){if(this._pendingPromises.clear(),this.features=[],!Array.isArray(e)||!e.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",e),(e=e.slice(0)).forEach(e=>{this._pendingPromises.add(e),e.then(t=>{this._pendingPromises.has(e)&&this._updateFeatures(t),this._updatePendingPromises(e)},()=>this._updatePendingPromises(e))}),this.notifyChange("pendingPromisesCount")}get selectedFeature(){const{features:e,selectedFeatureIndex:t}=this;return-1===t?null:e[t]||null}get selectedFeatureIndex(){const e=this._get("selectedFeatureIndex");return"number"==typeof e?e:-1}set selectedFeatureIndex(e){const{featureCount:t}=this;e=isNaN(e)||e<-1||!t?-1:(e+t)%t,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.get("view.ready")?"ready":"disabled"}centerAtLocation(){const{view:e}=this,t=this._getSelectedTarget();if(!t){const i=new p.a("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e});return Cr.error(i),Object(f.h)(i)}return this.callGoTo({target:{target:t,scale:e.scale}})}clear(){this.set({promises:[],features:[],content:null,title:null,location:null})}fetchFeatures(e,t){const{view:i}=this;if(!i||!e){const t=new p.a("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:i});return Cr.error(t),Object(f.h)(t)}return i.fetchPopupFeatures(e,{event:t&&t.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:t&&t.signal})}open(e){const t={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...e,visible:!0},{fetchFeatures:i}=t;delete t.fetchFeatures,i&&this._setFetchFeaturesPromises(t.location),this.set(t)}triggerAction(e){const t=this.allActions.getItemAt(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}next(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}previous(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}zoomToLocation(){const{location:e,selectedFeature:t,view:i,zoomFactor:r}=this,n=this._getSelectedTarget();if(!n){const e=new p.a("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:n,view:i});return Cr.error(e),Object(f.h)(e)}const a=i.scale/r,s=this.get("selectedFeature.geometry")||e,o=s&&"point"===s.type&&this._isZoomScreenSize(t);wr.active=!0,wr.disabled=!0;const l=this.callGoTo({target:{target:n,scale:o?a:void 0}}).catch(()=>{wr.active=!1,wr.disabled=!1,this._zoomToLocation=null}).then(()=>{o&&(this.location=s)});return this._zoomToLocation=l,l}_animationStateChange(e){this._zoomToLocation||(wr.disabled="waiting-for-target"===e)}_locationChange(e){const{selectedFeature:t,updateLocationEnabled:i}=this;i&&e&&(!t||t.geometry)&&this.centerAtLocation()}_selectedFeatureChange(e){if(!e)return;const{location:t,updateLocationEnabled:i,view:r}=this;!i&&t||!e.geometry?i&&!e.geometry&&this.centerAtLocation().then(()=>{this.location=r.center.clone()}):this.location=Object(s.m)(this._getPointFromGeometry(e.geometry))}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(e){return this._fetchFeaturesWithController(this._getScreenPoint(e||this.location)).then(e=>{const{clientOnlyGraphics:t,promisesPerLayerView:i}=e,r=Object(f.r)(t),n=i.map(e=>e.promise);this.promises=[r,...n]})}_destroyFeatureVMs(){this.featureViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){const{features:e,featureViewModels:t}=this;if(this._destroyFeatureVMs(),!e||!e.length)return;const i=t.slice(0),r=[];e.forEach((e,t)=>{if(!e)return;let n=null;if(i.some((t,r)=>(t&&t.graphic===e&&(n=t,i.splice(r,1)),!!n)),n)r[t]=n;else{var a,s;const i=new or({defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,graphic:e,spatialReference:null==(a=this.view)?void 0:a.spatialReference,map:null==(s=this.view)?void 0:s.map});r[t]=i}}),i.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("featureViewModels",r)}_getScreenPoint(e){const{view:t}=this;return t&&e&&"function"==typeof t.toScreen?t.toScreen(e):null}_getSelectedTarget(){const{selectedFeature:e,location:t,view:i}=this;return i?"3d"===i.type?e||t:this.get("selectedFeature.geometry")||t:null}_autoOpenEnabledChange(){const e="auto-fetch-features",{_handles:t,autoOpenEnabled:i}=this;if(t.remove(e),i&&this.view){const i=this.view.on("click",e=>{"mouse"===e.pointerType&&0!==e.button||this._fetchFeaturesAndOpen(e)},Ye.WIDGET);t.add(i,e)}}_cancelFetchingFeatures(){const e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}_fetchFeaturesWithController(e,t){this._cancelFetchingFeatures();const i=Object(f.c)(),{signal:r}=i;this._fetchFeaturesController=i,this.notifyChange("waitingForResult");const n=this.fetchFeatures(e,{signal:r,event:t});return n.catch(()=>{}).then(()=>{this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}),n}_fetchFeaturesAndOpen(e){const{screenPoint:t,mapPoint:i}=e,{view:r}=this;this._fetchFeaturesWithController(t,e).then(e=>{const{clientOnlyGraphics:t,promisesPerLayerView:n,location:a}=e,s=[Object(f.r)(t),...n.map(e=>e.promise)];return r.popup.open({location:a||i,promises:s}),e})}_updatePendingPromises(e){e&&this._pendingPromises.has(e)&&(this._pendingPromises.delete(e),this.notifyChange("pendingPromisesCount"))}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}_isZoomScreenSize(e){const{view:t}=this;if("3d"!==t.type||!e||"esri.Graphic"!==e.declaredClass)return!0;const i=t.getViewForGraphic(e);if(i&&"whenGraphicBounds"in i){let t=!1;return i.whenGraphicBounds(e,{useViewElevation:!0}).then(e=>{t=!e||!e.boundingBox||e.boundingBox[0]===e.boundingBox[3]&&e.boundingBox[1]===e.boundingBox[4]&&e.boundingBox[2]===e.boundingBox[5]}).catch(()=>{const t=new p.a("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:e});Cr.error(t)}),t}return!0}_getPointFromGeometry(e){return Object(s.g)(e)?null:"point"===e.type?e:"extent"===e.type?e.center:"polygon"===e.type?e.centroid:"multipoint"===e.type||"polyline"===e.type?e.extent.center:null}async _getLayerView(e,t){return await e.when(),e.whenLayerView(t)}async _highlightFeature(){const e="highlight";this._handles.remove(e);const{selectedFeature:t,highlightEnabled:i,view:r,visible:n}=this;if(!(t&&r&&i&&n))return;const{layer:a}=t;if(!(a&&a instanceof m.a))return;const s=this._getLayerView(r,a);this._highlightPromise=s;const o=await s;if(!(o&&function(e){return e&&"function"==typeof e.highlight}(o)&&this._highlightPromise===s&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const l="objectIdField"in a&&a.objectIdField,c=t.attributes,d=c&&l&&c[l],u=o.highlight(d||t);this._handles.add(u,e)}_updateFeatures(e){const{features:t}=this;if(!e||!e.length)return;if(!t.length)return void(this.features=e);const i=e.filter(e=>-1===t.indexOf(e));this.features=t.concat(i)}};Object(n.a)([Object(c.b)({type:Tr})],kr.prototype,"actions",void 0),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["visible","waitingForResult"]})],kr.prototype,"active",null),Object(n.a)([Object(c.b)({dependsOn:["actions.length","selectedFeature.sourceLayer.popupTemplate.actions.length","selectedFeature.sourceLayer.popupTemplate.overwriteActions","selectedFeature.popupTemplate.actions.length","selectedFeature.popupTemplate.overwriteActions"],readOnly:!0})],kr.prototype,"allActions",null),Object(n.a)([Object(c.b)({type:Boolean})],kr.prototype,"defaultPopupTemplateEnabled",void 0),Object(n.a)([Object(c.b)()],kr.prototype,"autoCloseEnabled",void 0),Object(n.a)([Object(c.b)()],kr.prototype,"autoOpenEnabled",void 0),Object(n.a)([Object(c.b)()],kr.prototype,"content",void 0),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["features"]})],kr.prototype,"featureCount",null),Object(n.a)([Object(c.b)()],kr.prototype,"features",null),Object(n.a)([Object(c.b)({readOnly:!0})],kr.prototype,"featureViewModels",void 0),Object(n.a)([Object(c.b)()],kr.prototype,"highlightEnabled",void 0),Object(n.a)([Object(c.b)({type:vr.a})],kr.prototype,"location",null),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["promises"]})],kr.prototype,"pendingPromisesCount",null),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["featureCount","pendingPromisesCount"]})],kr.prototype,"waitingForResult",null),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["promises"]})],kr.prototype,"promiseCount",null),Object(n.a)([Object(c.b)()],kr.prototype,"promises",null),Object(n.a)([Object(c.b)({value:null,readOnly:!0,dependsOn:["features","selectedFeatureIndex","updateLocationEnabled"]})],kr.prototype,"selectedFeature",null),Object(n.a)([Object(c.b)({value:-1})],kr.prototype,"selectedFeatureIndex",null),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["featureViewModels","selectedFeatureIndex"]})],kr.prototype,"selectedFeatureViewModel",null),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["view.ready"]})],kr.prototype,"state",null),Object(n.a)([Object(c.b)()],kr.prototype,"title",void 0),Object(n.a)([Object(c.b)()],kr.prototype,"updateLocationEnabled",void 0),Object(n.a)([Object(c.b)()],kr.prototype,"view",void 0),Object(n.a)([Object(c.b)()],kr.prototype,"visible",void 0),Object(n.a)([Object(c.b)()],kr.prototype,"zoomFactor",void 0),Object(n.a)([Object(c.b)()],kr.prototype,"centerAtLocation",null),Object(n.a)([Object(c.b)()],kr.prototype,"zoomToLocation",null),kr=Object(n.a)([Object(u.a)("esri.widgets.Popup.PopupViewModel")],kr);var xr=kr;const Sr="esri-icon-left-triangle-arrow",Fr="esri-icon-right-triangle-arrow",Er="esri-icon-loading-indicator",Lr="esri-popup--shadow",Ar="esri-popup__button",Pr="esri-popup__icon",Rr={buttonEnabled:!0,position:"auto",breakpoint:{width:544}};function Vr(e,t){return void 0===t?"esri-popup__"+e:`esri-popup__${e}-${t}`}const Nr=o.a.getLogger("esri.widgets.Popup"),Dr={closeButton:!0,featureNavigation:!0};let Ur=class extends(Ot(mt.a)){constructor(e,t){super(e,t),this._blurContainer=!1,this._containerNode=null,this._mainContainerNode=null,this._featureMenuNode=null,this._actionsMenuNode=null,this._focusContainer=!1,this._focusDockButton=!1,this._focusFeatureMenuButton=!1,this._focusActionsMenuButton=!1,this._focusFirstFeature=!1,this._focusFirstAction=!1,this._handles=new Ee.a,this._pointerOffsetInPx=16,this._spinner=null,this._feature=null,this._displaySpinnerThrottled=ut(()=>this._displaySpinner(),0),this.actions=null,this.alignment="auto",this.autoCloseEnabled=null,this.autoOpenEnabled=null,this.defaultPopupTemplateEnabled=null,this.content=null,this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.featureCount=null,this.featureMenuOpen=!1,this.features=null,this.goToOverride=null,this.highlightEnabled=null,this.location=null,this.label=void 0,this.maxInlineActions=3,this.messages=null,this.messagesCommon=null,this.promises=null,this.selectedFeature=null,this.selectedFeatureIndex=null,this.spinnerEnabled=!0,this.title=null,this.updateLocationEnabled=null,this.view=null,this.viewModel=new xr,this.visible=null,this.visibleElements={...Dr},this._addSelectedFeatureIndexHandle(),this.own([Object(me.d)(this,"viewModel.screenLocation",()=>this._positionContainer()),Object(me.d)(this,["viewModel.active","dockEnabled"],()=>this._toggleScreenLocationEnabled()),Object(me.d)(this,"viewModel.screenLocation",(e,t)=>{!!e!=!!t&&this.reposition()}),Object(me.d)(this,["viewModel.view.padding","viewModel.view.size","viewModel.active","viewModel.location","alignment"],()=>this.reposition()),Object(me.d)(this,"spinnerEnabled",e=>this._spinnerEnabledChange(e)),Object(me.d)(this,"viewModel.view.size",(e,t)=>this._updateDockEnabledForViewSize(e,t)),Object(me.d)(this,"viewModel.view",(e,t)=>this._viewChange(e,t)),Object(me.d)(this,"viewModel.view.ready",(e,t)=>this._viewReadyChange(e,t)),Object(me.d)(this,["viewModel.waitingForResult","viewModel.location"],()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),Object(me.d)(this,"selectedFeatureWidget.viewModel.title",e=>this._setTitleFromFeatureWidget(e)),Object(me.d)(this,["selectedFeatureWidget.viewModel.content","selectedFeatureWidget.viewModel.waitingForContent"],()=>this._setContentFromFeatureWidget()),Object(me.f)(this,"collapsed",()=>{var e,t;"xsmall"===(null==(e=this.viewModel)||null==(t=e.view)?void 0:t.widthBreakpoint)&&this.viewModel.active&&this.collapseEnabled&&this.viewModel.centerAtLocation()}),Object(me.b)(this,"viewModel.allActions","change",()=>this._watchActions()),Object(me.a)(this,"viewModel.allActions",()=>this._watchActions())])}destroy(){this._destroySelectedFeatureWidget(),this._destroySpinner(),this._handles&&this._handles.destroy(),this._handles=null}get actionsMenuId(){return this.id+"-actions-menu"}get actionsMenuButtonId(){return this.id+"-actions-menu-button"}get featureMenuId(){return this.id+"-feature-menu"}get titleId(){return this.id+"-popup-title"}get contentId(){return this.id+"-popup-content"}get hasContent(){var e,t,i,r,n;return!!(this.selectedFeatureWidget?(null==(e=this.selectedFeatureWidget)||null==(t=e.viewModel)?void 0:t.waitingForContent)||(null==(i=this.selectedFeatureWidget)||null==(r=i.viewModel)?void 0:r.content):null==(n=this.viewModel)?void 0:n.content)}get featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get collapsible(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}get featureMenuVisible(){return this.featureNavigationVisible&&this.featureMenuOpen}get contentCollapsed(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}get dividedActions(){return this._divideActions()}set actionsMenuOpen(e){this._set("actionsMenuOpen",!!e)}get actionsMenuOpen(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||Rr}set dockOptions(e){const t={...Rr},i=this.get("viewModel.view.breakpoints"),r={};i&&(r.width=i.xsmall,r.height=i.xsmall);const n={...t,...e},a={...t.breakpoint,...r},{breakpoint:s}=n;!0===s?n.breakpoint=a:"object"==typeof s&&(n.breakpoint={...a,...s}),this._set("dockOptions",n),this._setCurrentDockPosition(),this.reposition()}set featureNavigationEnabled(e){Object(st.c)(Nr,"featureNavigationEnabled",{replacement:"visibleElements.featureNavigation",version:"4.15"}),this.visibleElements={...this.visibleElements,featureNavigation:e}}get selectedFeatureWidget(){const{_feature:e,visibleElements:t}=this,{selectedFeatureViewModel:i}=this.viewModel,r={...t,title:!1};return i?(e?(e.viewModel=i,e.visibleElements=r):this._feature=new ur({viewModel:i,visibleElements:r}),this._feature):null}castVisibleElements(e){return{...Dr,...e}}blur(){const{active:e}=this.viewModel;e||Nr.warn("Popup can only be blurred when currently active."),this._blurContainer=!0,this.scheduleRender()}clear(){this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){const{active:e}=this.viewModel;e||Nr.warn("Popup can only be focused when currently active."),this._focusContainer=!0,this.scheduleRender()}next(){return this.viewModel.next()}open(e){var t,i;this._handles.remove("selected-index");const r=!!e&&!!e.featureMenuOpen,n=!!e&&!!e.actionsMenuOpen,a={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:n,featureMenuOpen:r};"xsmall"===(null==(t=this.viewModel)||null==(i=t.view)?void 0:i.widthBreakpoint)&&(a.collapsed=!0),this.set(a),this.viewModel.open(e),this._addSelectedFeatureIndexHandle()}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){this.viewModel.triggerAction(e)}render(){var e,t,i,r;const{actionsMenuOpen:n,dockEnabled:a,featureMenuVisible:s,dividedActions:o,currentAlignment:l,currentDockPosition:c}=this,{active:d}=this.viewModel,{menuActions:u}=o,h=d&&u.length>1&&n,p=d&&a,b=d&&!a,f=null==(e=this.selectedFeature)||null==(t=e.layer)?void 0:t.title,y=null==(i=this.selectedFeature)||null==(r=i.layer)?void 0:r.id,g={"esri-popup--aligned-top-center":"top-center"===l,"esri-popup--aligned-bottom-center":"bottom-center"===l,"esri-popup--aligned-top-left":"top-left"===l,"esri-popup--aligned-bottom-left":"bottom-left"===l,"esri-popup--aligned-top-right":"top-right"===l,"esri-popup--aligned-bottom-right":"bottom-right"===l,"esri-popup--is-docked":p,[Lr]:b,"esri-popup--is-docked-top-left":"top-left"===c,"esri-popup--is-docked-top-center":"top-center"===c,"esri-popup--is-docked-top-right":"top-right"===c,"esri-popup--is-docked-bottom-left":"bottom-left"===c,"esri-popup--is-docked-bottom-center":"bottom-center"===c,"esri-popup--is-docked-bottom-right":"bottom-right"===c,"esri-popup--feature-menu-open":s,"esri-popup--actions-menu-open":h};return Object(gt.a)("div",{class:this.classes("esri-popup",g),role:"presentation","data-layer-title":f,"data-layer-id":y,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},d?[this.renderMainContainer(),this.renderPointer()]:null)}renderLoadingIcon(){return Object(gt.a)("span",{"aria-hidden":"true",class:this.classes(Pr,Er,"esri-rotating")})}renderNavigationLoading(){const{messagesCommon:e}=this;return this.viewModel.pendingPromisesCount?Object(gt.a)("div",{key:Vr("loading-container"),role:"presentation",class:"esri-popup__loading-container","aria-label":e.loading,title:e.loading},this.renderLoadingIcon()):null}renderPreviousIcon(){const e=Object(ht.d)(),t={[Fr]:e,"esri-popup__pagination-previous-icon--rtl":e,[Sr]:!e,"esri-popup__pagination-previous-icon":!e};return Object(gt.a)("span",{"aria-hidden":"true",class:this.classes(Pr,t)})}renderPreviousButton(){const{messages:e}=this;return Object(gt.a)("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(Ar,"esri-popup__pagination-previous"),"aria-label":e.previous,title:e.previous},this.renderPreviousIcon())}renderNextIcon(){const e=Object(ht.d)(),t={[Sr]:e,"esri-popup__pagination-next-icon--rtl":e,[Fr]:!e,"esri-popup__pagination-next-icon":!e};return Object(gt.a)("span",{"aria-hidden":"true",class:this.classes(Pr,t)})}renderNextButton(){const{messages:e}=this;return Object(gt.a)("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(Ar,"esri-popup__pagination-next"),"aria-label":e.next,title:e.next},this.renderNextIcon())}renderFeatureMenuButton(){const{featureMenuOpen:e,featureMenuId:t,messagesCommon:i}=this,{featureCount:r,selectedFeatureIndex:n}=this.viewModel;return Object(gt.a)("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(Ar,"esri-popup__feature-menu-button"),"aria-haspopup":"true","aria-controls":t,"aria-expanded":e,"aria-label":i.menu,title:i.menu},this._getPageText(r,n))}renderNavigationButtons(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:null}renderDockIcon(){const{dockEnabled:e}=this,t=this._wouldDockTo(),i={"esri-icon-minimize":e,"esri-popup__icon--dock-icon":!e,"esri-icon-dock-right":!e&&("top-right"===t||"bottom-right"===t),"esri-icon-dock-left":!e&&("top-left"===t||"bottom-left"===t),"esri-icon-maximize":!e&&"top-center"===t,"esri-icon-dock-bottom":!e&&"bottom-center"===t};return Object(gt.a)("span",{"aria-hidden":"true",class:this.classes(i,Pr)})}renderDockButton(){var e,t,i;const{dockEnabled:r,messages:n}=this,a=null==(e=this.viewModel)||null==(t=e.view)?void 0:t.widthBreakpoint,s=r?n.undock:n.dock;return"xsmall"!==a&&(null==(i=this.dockOptions)?void 0:i.buttonEnabled)?Object(gt.a)("div",{role:"button","aria-label":s,title:s,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(Ar,"esri-popup__button--dock")},this.renderDockIcon()):null}renderTitle(){const{title:e}=this.viewModel,{titleId:t,collapsible:i,contentCollapsed:r,messagesCommon:n}=this,a=i?r?n.expand:n.collapse:"",s={"esri-popup__header-container--button":i};return e?Object(gt.a)("div",{class:this.classes("esri-popup__header-container",s),key:e,enterAnimation:this._createFeatureUpdatedAnimation(),id:t,role:i?"button":"heading","aria-label":a,title:a,tabIndex:i?0:-1,bind:this,onclick:this._toggleCollapsed,onkeydown:this._toggleCollapsed},Object(gt.a)("h2",{class:"esri-popup__header-title",innerHTML:e})):null}renderCloseIcon(){return Object(gt.a)("span",{"aria-hidden":"true",class:this.classes(Pr,"esri-icon-close")})}renderCloseButton(){const{visibleElements:e,messagesCommon:t}=this;return e.closeButton?Object(gt.a)("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:Ar,"aria-label":t.close,title:t.close},this.renderCloseIcon()):null}renderHeader(){return Object(gt.a)("header",{class:"esri-popup__header"},this.renderTitle(),Object(gt.a)("div",{class:"esri-popup__header-buttons"},this.renderDockButton(),this.renderCloseButton()))}renderContentContainer(){const{contentId:e,hasContent:t,contentCollapsed:i}=this,{content:r}=this.viewModel;return t&&!i?Object(gt.a)("article",{key:r,enterAnimation:this._createFeatureUpdatedAnimation(),id:e,class:"esri-popup__content"},this.renderContent()):null}renderActionsMenuButton(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:r,messagesCommon:n}=this,a=i?n.close:n.open,{menuActions:s}=r;return s.length?Object(gt.a)("div",{key:Vr("actions-menu-button"),class:this.classes(Ar,"esri-popup__actions-menu-button"),role:"button",id:t,"aria-haspopup":"true","aria-controls":i?e:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":a,title:a},Object(gt.a)("span",{"aria-hidden":"true",class:"esri-icon-handle-horizontal"})):null}renderMenuActions(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:r}=this,{menuActions:n,inlineActions:a}=r;return n.length&&i?Object(gt.a)("ul",{id:e,role:"menu","aria-labelledby":t,key:Vr("actions"),class:"esri-popup__actions",bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},n.toArray().map((e,t)=>this.renderAction({action:e,index:t+a.length,type:"menu-item"}))):null}renderInlineActions(){const{inlineActions:e}=this.dividedActions;return!!e.length&&e.toArray().map((e,t)=>this.renderAction({action:e,index:t,type:"inline"}))}renderInlineActionsContainer(){const{inlineActions:e,menuActions:t}=this.dividedActions,i=!!e.length,r=!!t.length;return i||r?Object(gt.a)("div",{key:"inline-actions-container","data-inline-actions":i.toString(),"data-menu-actions":r.toString(),class:"esri-popup__inline-actions-container"},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}renderNavigation(){return this.featureNavigationVisible?Object(gt.a)("section",{key:Vr("navigation"),class:this.classes("esri-popup__navigation")},this.renderNavigationButtons()):null}renderFooter(){const{featureNavigationVisible:e,dividedActions:t}=this,{inlineActions:i,menuActions:r}=t,n=!!i.length,a={"esri-popup__footer--has-pagination":e,"esri-popup__footer--has-actions":n,"esri-popup__footer--has-actions-menu":!!r.length};return e||n?Object(gt.a)("div",{key:Vr("feature-buttons"),class:this.classes("esri-popup__footer",a)},this.renderInlineActionsContainer(),this.renderNavigation()):null}renderFeatureMenuContainer(){const{messages:e}=this,{featureViewModels:t}=this.viewModel,i=Object(dt.a)(e.selectedFeatures,{total:t.length});return Object(gt.a)("section",{key:Vr("menu"),class:"esri-popup__feature-menu"},Object(gt.a)("h2",{class:"esri-popup__feature-menu-header"},i),Object(gt.a)("nav",{class:"esri-popup__feature-menu-viewport",afterCreate:this._featureMenuViewportNodeUpdated,afterUpdate:this._featureMenuViewportNodeUpdated},this.renderFeatureMenu()))}renderPointer(){return this.dockEnabled?null:Object(gt.a)("div",{key:Vr("pointer"),class:"esri-popup__pointer",role:"presentation"},Object(gt.a)("div",{class:this.classes("esri-popup__pointer-direction",Lr)}))}renderMainContainer(){const{dockEnabled:e,currentAlignment:t,currentDockPosition:i,titleId:r,contentId:n,collapsible:a,hasContent:s,contentCollapsed:o}=this,{title:l}=this.viewModel,c="bottom-left"===t||"bottom-center"===t||"bottom-right"===t||"top-left"===i||"top-center"===i||"top-right"===i,d="top-left"===t||"top-center"===t||"top-right"===t||"bottom-left"===i||"bottom-center"===i||"bottom-right"===i,u={[Lr]:e,"esri-popup--is-collapsible":a,"esri-popup--is-collapsed":o};return Object(gt.a)("div",{class:this.classes("esri-popup__main-container","esri-widget",u),tabIndex:-1,role:"dialog","aria-labelledby":l?r:"","aria-describedby":s&&!o?n:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},c?this.renderFooter():null,c?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),d?this.renderFooter():null,d?this.renderFeatureMenuContainer():null)}renderContent(){var e;const t=null==(e=this.viewModel)?void 0:e.content;return t?"string"==typeof t?Object(gt.a)("div",{key:t,innerHTML:t}):this.renderNodeContent(t):null}renderActionText(e){return Object(gt.a)("span",{key:"text",class:"esri-popup__action-text"},e)}renderActionIcon(e){const t=this._getActionClass(e),i=this._getActionImage(e),r={[Er]:e.active,"esri-rotating":e.active,[Pr]:!!t,"esri-popup__action-image":!e.active&&!!i};return t&&(r[t]=!e.active),Object(gt.a)("span",{key:"icon","aria-hidden":"true",class:this.classes(Pr,r),styles:this._getIconStyles(i)})}renderAction(e){const{action:t,index:i,type:r}=e,n=this._getActionTitle(t),a={"esri-popup__action":"toggle"!==t.type,"esri-popup__action-toggle":"toggle"===t.type,"esri-popup__action-toggle--on":"toggle"===t.type&&t.value,"esri-popup__button--disabled":t.disabled},s=[this.renderActionIcon(t),this.renderActionText(n)],o="menu-item"===r?Object(gt.a)("li",{key:t,role:"menuitem",tabIndex:0,title:n,"aria-label":n,class:this.classes(Ar,a),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-index":i,onclick:this._triggerAction,onkeydown:this._triggerAction},s):Object(gt.a)("div",{key:t,role:"button",tabIndex:0,title:n,"aria-label":n,class:this.classes(Ar,a),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-index":i,onclick:this._triggerAction,onkeydown:this._triggerAction},s);return t.visible?o:null}renderFeatureMenuItem(e,t){const{messages:i,messagesCommon:r}=this,{selectedFeatureIndex:n,selectedFeatureViewModel:a}=this.viewModel,s=e===a,o={"esri-popup__feature-menu-item--selected":s},l=s?Object(gt.a)("span",{key:Vr("feature-menu-selected-feature-"+n),title:i.selectedFeature,"aria-label":i.selectedFeature,class:"esri-icon-check-mark"}):null,c=Object(gt.a)("span",{innerHTML:e.title||r.untitled});return Object(gt.a)("li",{role:"menuitem",tabIndex:-1,key:Vr("feature-menu-feature-"+n),class:this.classes(o,"esri-popup__feature-menu-item"),bind:this,"data-feature-index":t,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature},Object(gt.a)("span",{class:"esri-popup__feature-menu-title"},c,l))}renderFeatureMenu(){const{featureMenuId:e}=this,{featureViewModels:t}=this.viewModel;return t.length>1?Object(gt.a)("ol",{class:"esri-popup__feature-menu-list",id:e,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},t.map((e,t)=>this.renderFeatureMenuItem(e,t))):null}_getActionTitle(e){const{messages:t,selectedFeature:i,messagesCommon:r}=this,{id:n}=e,a=null==i?void 0:i.attributes,s="zoom-to-feature"===n?Object(dt.a)(e.title,{messages:t}):"remove-selected-feature"===n?Object(dt.a)(e.title,{messages:r}):e.title;return s&&a?Object(dt.a)(s,a):s}_getActionClass(e){const{selectedFeature:t}=this,i=null==t?void 0:t.attributes,{className:r,image:n}=e,a=n||r?r:"esri-icon-default-action";return a&&i?Object(dt.a)(a,i):a}_getActionImage(e){const{selectedFeature:t}=this,i=null==t?void 0:t.attributes,{image:r}=e;return r&&i?Object(dt.a)(r,i):r}_createFeatureUpdatedAnimation(){return Object(ht.b)("enter","esri-popup--feature-updated")}_getInlineActionCount(){const{maxInlineActions:e,featureNavigationVisible:t}=this;if("number"!=typeof e)return null;const i=Math.round(e);return Math.max(t?i-1:i,0)}_watchActions(){const{allActions:e}=this.viewModel;this.notifyChange("dividedActions");const t="actions";this._handles.remove(t),e&&e.forEach(e=>{this._handles.add(Object(me.d)(e,["active","className","disabled","id","title","image","visible"],()=>this.scheduleRender()),t)})}_divideActions(){const{allActions:e}=this.viewModel,t=this._getInlineActionCount(),i=null===t,r=0===t;return{inlineActions:i?e.slice(0):r?new z.a:e.slice(0,t),menuActions:i?new z.a:r?e.slice(0):e.slice(t)}}_featureMenuOpenChanged(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}_actionsMenuOpenChanged(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}_setTitleFromFeatureWidget(e){const{selectedFeatureWidget:t}=this;t&&(this.viewModel.title=e||"")}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_handleFeatureMenuKeyup(e){"Escape"===Object(We.a)(e)&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}_handleActionMenuKeyup(e){"Escape"===Object(We.a)(e)&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}_handleFeatureMenuItemKeyup(e){const t=Object(We.a)(e),{_featureMenuNode:i}=this,r=e.currentTarget["data-feature-index"];if(!i)return;const n=i.querySelectorAll("li"),a=n.length;"ArrowUp"!==t?"ArrowDown"!==t?"Home"!==t?"End"!==t||(e.stopPropagation(),n[n.length-1].focus()):(e.stopPropagation(),n[0].focus()):(e.stopPropagation(),n[(r+1+a)%a].focus()):(e.stopPropagation(),n[(r-1+a)%a].focus())}_handleActionMenuItemKeyup(e){const t=Object(We.a)(e),{_actionsMenuNode:i}=this,r=e.currentTarget["data-action-index"];if(!i)return;const n=i.querySelectorAll("li"),a=n.length;"ArrowUp"!==t?"ArrowDown"!==t?"Home"!==t?"End"!==t||(e.stopPropagation(),n[n.length-1].focus()):(e.stopPropagation(),n[0].focus()):(e.stopPropagation(),n[(r+1+a)%a].focus()):(e.stopPropagation(),n[(r-1+a)%a].focus())}_handleMainKeyup(e){const t=Object(We.a)(e);"ArrowLeft"===t&&(e.stopPropagation(),this.previous()),"ArrowRight"===t&&(e.stopPropagation(),this.next())}_spinnerEnabledChange(e){if(this._destroySpinner(),!e)return;const t=this.get("viewModel.view");this._createSpinner(t)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:t,waitingForResult:i}=this.viewModel;i?e.show({location:t}):e.hide()}_getIconStyles(e){return{"background-image":e?`url(${e})`:""}}_addSelectedFeatureIndexHandle(){const e=Object(me.d)(this,"viewModel.selectedFeatureIndex",(e,t)=>this._selectedFeatureIndexUpdated(e,t));this._handles.add(e,"selected-index")}_selectedFeatureIndexUpdated(e,t){const{featureCount:i}=this;i&&e!==t&&-1!==e&&(this.actionsMenuOpen=!1,this.featureMenuOpen=!1)}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,e&&!e.destroyed&&e.destroy()),this._feature=null}_isScreenLocationWithinView(e,t){return e.x>-1&&e.y>-1&&e.x<=t.width&&e.y<=t.height}_isOutsideView(e){const{popupHeight:t,popupWidth:i,screenLocation:r,side:n,view:a}=e;if(isNaN(i)||isNaN(t)||!a||!r)return!1;const s=a.padding;return"right"===n&&r.x+i/2>a.width-s.right||"left"===n&&r.x-i/2<s.left||"top"===n&&r.y-t<s.top||"bottom"===n&&r.y+t>a.height-s.bottom}_calculateAutoAlignment(e){if("auto"!==e)return e;const{_pointerOffsetInPx:t,_containerNode:i,_mainContainerNode:r,viewModel:n}=this,{screenLocation:a,view:s}=n;if(!a||!s||!i)return"top-center";if(!this._isScreenLocationWithinView(a,s))return this._get("currentAlignment")||"top-center";function o(e){return parseInt(e.replace(/[^-\d\.]/g,""),10)}const l=r?window.getComputedStyle(r,null):null,c=l?o(l.getPropertyValue("max-height")):0,d=l?o(l.getPropertyValue("height")):0,{height:u,width:h}=i.getBoundingClientRect(),p=h+t,b=Math.max(u,c,d)+t,f=this._isOutsideView({popupHeight:b,popupWidth:p,screenLocation:a,side:"right",view:s}),y=this._isOutsideView({popupHeight:b,popupWidth:p,screenLocation:a,side:"left",view:s}),g=this._isOutsideView({popupHeight:b,popupWidth:p,screenLocation:a,side:"top",view:s}),m=this._isOutsideView({popupHeight:b,popupWidth:p,screenLocation:a,side:"bottom",view:s});return y?g?"bottom-right":"top-right":f?g?"bottom-left":"top-left":g?m?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return"function"==typeof e?e.call(this):e}_getCurrentAlignment(){const{alignment:e,dockEnabled:t}=this;return t||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){const t=["left","right"];return Object(ht.d)()&&t.reverse(),e.replace(/leading/gi,t[0]).replace(/trailing/gi,t[1])}_callDockPosition(e){return"function"==typeof e?e.call(this):e}_getDockPosition(){var e;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(null==(e=this.dockOptions)?void 0:e.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_wouldDockTo(){return this.dockEnabled?null:this._getDockPosition()}_calculateAutoDockPosition(e){var t;if("auto"!==e)return e;const i=null==(t=this.viewModel)?void 0:t.view,r=Object(ht.d)()?"top-left":"top-right";if(!i)return r;const n=i.padding||{left:0,right:0,top:0,bottom:0},a=i.width-n.left-n.right,{breakpoints:s}=i;return s&&a<=s.xsmall?"bottom-center":r}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!e)return;const{screenLocation:t}=this.viewModel,{width:i}=e.getBoundingClientRect(),r=this._calculatePositionStyle(t,i);r&&(e.style.top=r.top,e.style.left=r.left,e.style.bottom=r.bottom,e.style.right=r.right)}_calculateFullWidth(e){const{currentAlignment:t,_pointerOffsetInPx:i}=this;return"top-left"===t||"bottom-left"===t||"top-right"===t||"bottom-right"===t?e+i:e}_calculateAlignmentPosition(e,t,i,r){const{currentAlignment:n,_pointerOffsetInPx:a}=this,s=r/2,o=i.height-t,l=i.width-e,{padding:c}=this.view;return"bottom-center"===n?{top:t+a-c.top,left:e-s-c.left}:"top-left"===n?{bottom:o+a-c.bottom,right:l+a-c.right}:"bottom-left"===n?{top:t+a-c.top,right:l+a-c.right}:"top-right"===n?{bottom:o+a-c.bottom,left:e+a-c.left}:"bottom-right"===n?{top:t+a-c.top,left:e+a-c.left}:"top-center"===n?{bottom:o+a-c.bottom,left:e-s-c.left}:void 0}_calculatePositionStyle(e,t){const{dockEnabled:i,view:r}=this;if(!r)return;if(i)return{left:"",top:"",right:"",bottom:""};if(!e||!t)return;const n=this._calculateFullWidth(t),a=this._calculateAlignmentPosition(e.x,e.y,r,n);return a?{top:void 0!==a.top?a.top+"px":"auto",left:void 0!==a.left?a.left+"px":"auto",bottom:void 0!==a.bottom?a.bottom+"px":"auto",right:void 0!==a.right?a.right+"px":"auto"}:void 0}_viewChange(e,t){e&&t&&(this.close(),this.clear())}_viewReadyChange(e,t){if(e){const e=this.get("viewModel.view");this._wireUpView(e)}else t&&(this.close(),this.clear())}_wireUpView(e){if(this._destroySpinner(),!e)return;const{spinnerEnabled:t}=this;t&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,t,i){const[r,n]=e,[a,s]=t,{width:o,height:l}=i;return r<=o&&a>o||r>o&&a<=o||n<=l&&s>l||n>l&&s<=l}_updateDockEnabledForViewSize(e,t){if(!e||!t)return;const i=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},r=i.left+i.right,n=i.top+i.bottom,a=[],s=[];a[0]=e[0]-r,a[1]=e[1]-n,s[0]=t[0]-r,s[1]=t[1]-n;const{dockOptions:o}=this,l=o.breakpoint;this._dockingThresholdCrossed(a,s,l)&&this._setDockEnabledForViewSize(o),this._setCurrentDockPosition()}_focusDockButtonNode(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())}_mainContainerNodeUpdated(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0}_featureMenuNodeUpdated(e){if(this._featureMenuNode=e,!e||!this._focusFirstFeature)return;this._focusFirstFeature=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_actionsMenuNodeUpdated(e){if(this._actionsMenuNode=e,!e||!this._focusFirstAction)return;this._focusFirstAction=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_focusFeatureMenuButtonNode(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())}_focusActionsMenuButtonNode(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())}_featureMenuViewportNodeUpdated(e){e&&(e.scrollTop=0)}_toggleScreenLocationEnabled(){const{dockEnabled:e,viewModel:t}=this;if(!t)return;const i=t.active&&!e;t.screenLocationEnabled=i}_shouldDockAtCurrentViewSize(e){const t=e.breakpoint,{width:i,height:r}=this.get("viewModel.view.ui");if(isNaN(i)||isNaN(r))return!1;const n=t.hasOwnProperty("width")&&i<=t.width,a=t.hasOwnProperty("height")&&r<=t.height;return n||a}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}_getPageText(e,t){return this.featureNavigationVisible?Object(dt.a)(this.messages.pageText,{index:t+1,total:e}):null}_destroySpinner(){const{_spinner:e,view:t}=this;e&&(t&&t.ui&&t.ui.remove(this._spinner,"popup-spinner"),e.destroy(),this._spinner=null)}_createSpinner(e){e&&(this._spinner=new gr({view:e}),e.ui.add(this._spinner,{key:"popup-spinner",position:"manual"}))}_toggleCollapsed(){this.collapsed=!this.collapsed}_close(){this.close(),this.view&&this.view.focus()}_toggleDockEnabled(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}_toggleFeatureMenu(){const e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e}_toggleActionsMenu(){const e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e}_triggerAction(e){const t=e.currentTarget["data-action-index"],i=this.viewModel.allActions.getItemAt(t);i&&"toggle"===i.type&&(i.value=!i.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(t)}_selectFeature(e){const t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}_next(){this.next()}_previous(){this.previous()}};Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["id"]}),Object(ft.a)()],Ur.prototype,"actionsMenuId",null),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["id"]}),Object(ft.a)()],Ur.prototype,"actionsMenuButtonId",null),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["id"]}),Object(ft.a)()],Ur.prototype,"featureMenuId",null),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["id"]}),Object(ft.a)()],Ur.prototype,"titleId",null),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["id"]}),Object(ft.a)()],Ur.prototype,"contentId",null),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["selectedFeatureWidget","selectedFeatureWidget.viewModel","selectedFeatureWidget.viewModel.waitingForContent","selectedFeatureWidget.viewModel.content","viewModel.content"]}),Object(ft.a)()],Ur.prototype,"hasContent",null),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["viewModel.active","viewModel.featureCount","visibleElements.featureNavigation"]}),Object(ft.a)()],Ur.prototype,"featureNavigationVisible",null),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["collapseEnabled","viewModel.title","hasContent"]}),Object(ft.a)()],Ur.prototype,"collapsible",null),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["featureNavigationVisible","featureMenuOpen"]}),Object(ft.a)()],Ur.prototype,"featureMenuVisible",null),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["collapsible","featureMenuVisible","collapsed"]}),Object(ft.a)()],Ur.prototype,"contentCollapsed",null),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["featureNavigationVisible","maxInlineActions","viewModel.allActions","viewModel.allActions.length"]}),Object(ft.a)()],Ur.prototype,"dividedActions",null),Object(n.a)([Object(R.a)("viewModel.actions"),Object(ft.a)()],Ur.prototype,"actions",void 0),Object(n.a)([Object(c.b)({dependsOn:["viewModel.active"]}),Object(ft.a)()],Ur.prototype,"actionsMenuOpen",null),Object(n.a)([Object(c.b)()],Ur.prototype,"alignment",void 0),Object(n.a)([Object(R.a)("viewModel.autoCloseEnabled")],Ur.prototype,"autoCloseEnabled",void 0),Object(n.a)([Object(R.a)("viewModel.autoOpenEnabled")],Ur.prototype,"autoOpenEnabled",void 0),Object(n.a)([Object(R.a)("viewModel.defaultPopupTemplateEnabled")],Ur.prototype,"defaultPopupTemplateEnabled",void 0),Object(n.a)([Object(R.a)("viewModel.content"),Object(ft.a)()],Ur.prototype,"content",void 0),Object(n.a)([Object(c.b)(),Object(ft.a)()],Ur.prototype,"collapsed",void 0),Object(n.a)([Object(c.b)(),Object(ft.a)()],Ur.prototype,"collapseEnabled",void 0),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["dockEnabled","alignment","viewModel.active"]}),Object(ft.a)()],Ur.prototype,"currentAlignment",null),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["viewModel.view.ready","dockEnabled","dockOptions","viewModel.active"]}),Object(ft.a)()],Ur.prototype,"currentDockPosition",null),Object(n.a)([Object(c.b)(),Object(ft.a)()],Ur.prototype,"dockOptions",null),Object(n.a)([Object(c.b)(),Object(ft.a)()],Ur.prototype,"dockEnabled",void 0),Object(n.a)([Object(R.a)("viewModel.featureCount"),Object(ft.a)()],Ur.prototype,"featureCount",void 0),Object(n.a)([Object(c.b)(),Object(ft.a)()],Ur.prototype,"featureMenuOpen",void 0),Object(n.a)([Object(R.a)("viewModel.features"),Object(ft.a)()],Ur.prototype,"features",void 0),Object(n.a)([Object(c.b)(),Object(ft.a)()],Ur.prototype,"featureNavigationEnabled",null),Object(n.a)([Object(R.a)("viewModel.goToOverride")],Ur.prototype,"goToOverride",void 0),Object(n.a)([Object(R.a)("viewModel.highlightEnabled")],Ur.prototype,"highlightEnabled",void 0),Object(n.a)([Object(R.a)("viewModel.location"),Object(ft.a)()],Ur.prototype,"location",void 0),Object(n.a)([Object(c.b)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Ur.prototype,"label",void 0),Object(n.a)([Object(c.b)(),Object(ft.a)()],Ur.prototype,"maxInlineActions",void 0),Object(n.a)([Object(c.b)(),Object(ft.a)(),Object(bt.a)("esri/widgets/Popup/t9n/Popup")],Ur.prototype,"messages",void 0),Object(n.a)([Object(c.b)(),Object(ft.a)(),Object(bt.a)("esri/t9n/common")],Ur.prototype,"messagesCommon",void 0),Object(n.a)([Object(R.a)("viewModel.promises")],Ur.prototype,"promises",void 0),Object(n.a)([Object(R.a)("viewModel.selectedFeature"),Object(ft.a)()],Ur.prototype,"selectedFeature",void 0),Object(n.a)([Object(R.a)("viewModel.selectedFeatureIndex"),Object(ft.a)()],Ur.prototype,"selectedFeatureIndex",void 0),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["viewModel.selectedFeatureViewModel","visibleElements"]}),Object(ft.a)()],Ur.prototype,"selectedFeatureWidget",null),Object(n.a)([Object(c.b)()],Ur.prototype,"spinnerEnabled",void 0),Object(n.a)([Object(R.a)("viewModel.title"),Object(ft.a)()],Ur.prototype,"title",void 0),Object(n.a)([Object(R.a)("viewModel.updateLocationEnabled")],Ur.prototype,"updateLocationEnabled",void 0),Object(n.a)([Object(R.a)("viewModel.view")],Ur.prototype,"view",void 0),Object(n.a)([Object(c.b)({type:xr}),Object(ft.a)(["viewModel.active","viewModel.view.widthBreakpoint","viewModel.allActions","viewModel.screenLocation","viewModel.screenLocationEnabled","viewModel.state","viewModel.pendingPromisesCount","viewModel.promiseCount","viewModel.waitingForResult"]),Object(yt.a)(["triggerAction","trigger-action"])],Ur.prototype,"viewModel",void 0),Object(n.a)([Object(R.a)("viewModel.visible"),Object(ft.a)()],Ur.prototype,"visible",void 0),Object(n.a)([Object(c.b)(),Object(ft.a)()],Ur.prototype,"visibleElements",void 0),Object(n.a)([Object(q.a)("visibleElements")],Ur.prototype,"castVisibleElements",null),Object(n.a)([Object(pt.a)()],Ur.prototype,"_toggleCollapsed",null),Object(n.a)([Object(pt.a)()],Ur.prototype,"_close",null),Object(n.a)([Object(pt.a)()],Ur.prototype,"_toggleDockEnabled",null),Object(n.a)([Object(pt.a)()],Ur.prototype,"_toggleFeatureMenu",null),Object(n.a)([Object(pt.a)()],Ur.prototype,"_toggleActionsMenu",null),Object(n.a)([Object(pt.a)()],Ur.prototype,"_triggerAction",null),Object(n.a)([Object(pt.a)()],Ur.prototype,"_selectFeature",null),Object(n.a)([Object(pt.a)()],Ur.prototype,"_next",null),Object(n.a)([Object(pt.a)()],Ur.prototype,"_previous",null),Ur=Object(n.a)([Object(u.a)("esri.widgets.Popup")],Ur);function Br(e,t){const i=e.view;i&&(t&&i.ready&&i.activeTool!==e?(i.activeTool=e,function(e){return e&&"focus"in e}(i)&&i.focus()):t||i.activeTool!==e||(i.activeTool=null))}function zr(e){return!1!==e.visible&&!1!==e.editable&&(null==e.hasEditableFlag||e.hasEditableFlag(1))}function Gr(e){return Object(s.g)(e)?{}:"function"==typeof e?e():e}function Wr(e){return"mouse"===e}function Hr(e){return"mouse"!==e.pointerType||0===e.button}function qr(e){return!!e.native.shiftKey}const $r={manipulator:null,tool:null};const Kr=o.a.getLogger("esri.views.ToolViewManager");let Jr=class extends P.a{constructor(e){super(e),this._handles=new Ee.a,this._creatingTool=null,this._manipulatorState=new class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToActiveTool=null,this._cursor=null}get cursor(){return this._cursor}handleInputEvent(e,t){const i=()=>e.stopPropagation();switch(e.type){case"pointer-move":Wr(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(i(),"end"===e.action&&(this._stopDrag=!1));break;case"pointer-down":{if(!Hr(e)||qr(e))break;const r=Object(Ve.c)(e),n=this._intersect(r,e.pointerType,t.forEachTool);if(Object(s.g)(n))break;const a=this._findManipulatorByKey(n,t.forEachTool);Object(s.h)(a)&&a.interactive&&a.grabbable&&!a.grabbing&&(this._grabbedManipulators.set(e.pointerId,{key:n,start:r}),1===this._grabbedManipulators.size&&(this._revertToActiveTool=t.activeTool,t.setActiveTool(n.tool)),a.grabbing=!0,a.events.emit("grab-changed",{action:"start",screenPoint:r}),i());break}case"pointer-up":this._handlePointerEnd(e,t);break;case"pointer-drag":{if(!Hr(e))break;const r=this._grabbedManipulators.get(e.pointerId),n=this._draggedManipulators.get(e.pointerId),a=Object(s.b)(r||n,({key:e})=>e),o=this._findManipulatorByKey(a,t.forEachTool);if(Object(s.g)(o))break;const l=Object(Ve.c)(e);l.x=Object(Re.c)(l.x,0,t.view.width),l.y=Object(Re.c)(l.y,0,t.view.height);const c=Object(s.m)(r||n).start,d={action:e.action,start:c,screenPoint:l};switch(e.action){case"start":case"update":"update"!==d.action&&1!==this._grabbedManipulators.size||(o.dragging=!0,n||(d.action="start"),o.events.emit("drag",d),this._draggedManipulators.set(e.pointerId,{key:Object(s.m)(a),start:c}));break;case"end":o.dragging=!1,n&&o.events.emit("drag",d),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,t)}i();break}case"immediate-click":{const r=Object(Ve.c)(e),n=this._intersect(r,e.pointerType,t.forEachTool),a=this._findToolAndManipulatorByKey(n,t.forEachTool,$r);if(qr(e)||t.forEachTool(e=>{if((!a||$r.tool!==e||!e.selectionManagementDisabled)&&e.manipulators){let t=!1;e.manipulators.forEach(({manipulator:e})=>{e.selected&&(e.selected=!1,t=!0)}),t&&e.manipulatorSelectionChanged&&e.manipulatorSelectionChanged()}}),!a)break;const{manipulator:s,tool:o}=$r;if(!s.interactive)break;s.selectable&&!o.selectionManagementDisabled&&(s.selected=!s.selected,o.manipulatorSelectionChanged&&o.manipulatorSelectionChanged());const l=e.native.shiftKey;s.events.emit("immediate-click",{screenPoint:r,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:i});break}case"click":{const r=Object(Ve.c)(e),n=this._intersect(r,e.pointerType,t.forEachTool),a=this._findManipulatorByKey(n,t.forEachTool);if(Object(s.g)(a)||!a.interactive)break;const o=e.native.shiftKey;a.events.emit(e.type,{screenPoint:r,button:e.button,pointerType:e.pointerType,shiftKey:o}),i();break}case"double-click":{const r=Object(Ve.c)(e),n=this._intersect(r,e.pointerType,t.forEachTool),a=this._findManipulatorByKey(n,t.forEachTool);if(Object(s.g)(a)||!a.interactive)break;const o=e.native.shiftKey;a.events.emit("double-click",{screenPoint:r,button:e.button,pointerType:e.pointerType,shiftKey:o,stopPropagation:i});break}case"immediate-double-click":{const r=Object(Ve.c)(e),n=this._intersect(r,e.pointerType,t.forEachTool),a=this._findManipulatorByKey(n,t.forEachTool);if(Object(s.g)(a)||!a.interactive)break;const o=e.native.shiftKey;a.events.emit("immediate-double-click",{screenPoint:r,button:e.button,pointerType:e.pointerType,shiftKey:o,stopPropagation:i});break}}this._updateCursor(t.forEachTool)}_handlePointerEnd(e,t){const i=Object(s.b)(this._grabbedManipulators.get(e.pointerId),({key:e})=>e),r=this._findManipulatorByKey(i,t.forEachTool);if(Object(s.h)(r)&&!r.dragging){const n=Object(s.h)(t.creatingTool)&&t.creatingTool===Object(s.m)(i).tool;1!==this._grabbedManipulators.size||0!==this._draggedManipulators.size||n||(t.setActiveTool(this._revertToActiveTool),this._revertToActiveTool=null),r.grabbing&&(r.grabbing=!1,r.events.emit("grab-changed",{action:"end",screenPoint:Object(Ve.c)(e)})),this._grabbedManipulators.delete(e.pointerId)}}_cursorFromMap(e,t){let i=null;return Object(Wi.d)(e,({key:e})=>{const r=this._findManipulatorByKey(e,t);return!!(Object(s.h)(r)&&r.interactive&&"cursor"in r&&r.cursor)&&(i=r.cursor,!0)}),i}_updateCursor(e){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators,e)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators,e)||"pointer":this._cursor=null}clearPointers(e,t,i=!0,r){const n=t=>t.tool===e&&(Object(s.g)(r)||t.manipulatorId===r);this._grabbedManipulators.forEach(({key:e},i)=>{if(n(e)){this._grabbedManipulators.delete(i);const r=this._findManipulatorByKey(e,t);Object(s.h)(r)&&(r.grabbing=!1,r.events.emit("grab-changed",{action:"end",screenPoint:null}))}}),this._draggedManipulators.forEach(({key:e},i)=>{if(n(e)){this._draggedManipulators.delete(i);const r=this._findManipulatorByKey(e,t);Object(s.h)(r)&&(r.dragging=!1,r.events.emit("drag",{action:"cancel",screenPoint:null,start:null}))}}),i&&this._hoveredManipulators.forEach(({key:e},i)=>{if(n(e)){this._hoveredManipulators.delete(i);const r=this._findManipulatorByKey(e,t);Object(s.h)(r)&&(r.hovering=!1)}}),this._updateCursor(t)}_intersect(e,t,i){let r=null;return i(i=>{if(null==i.manipulators||!zr(i))return!1;const n=i.manipulators.intersect(e,t);return!Object(s.g)(n)&&(r={manipulatorId:n,tool:i},!0)}),r}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((t,i)=>{this._updateHoveredStateForPointerAtScreenPosition(Object(Ve.b)(t.x,t.y),i,t.pointerType,e)})}handleHoverEvent(e,t){"pointer-up"!==e.type&&"immediate-click"!==e.type&&"pointer-move"!==e.type||!Wr(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(Object(Ve.c)(e),e.pointerId,e.pointerType,t)}_updateHoveredStateForPointerAtScreenPosition(e,t,i,r){const n=this._intersect(e,i,r);let a=this._findManipulatorByKey(n,r);const o=Object(s.b)(this._hoveredManipulators.get(t),({key:e})=>e),l=this._findManipulatorByKey(o,r);Object(s.h)(a)&&!a.interactive&&(a=null),l!==a&&(Object(s.h)(l)&&(l.hovering=!1),Object(s.h)(a)?(a.hovering=!0,this._hoveredManipulators.set(t,{key:Object(s.m)(n)})):this._hoveredManipulators.delete(t),this._updateCursor(r))}_findManipulatorByKey(e,t){return this._findToolAndManipulatorByKey(e,t,$r)?$r.manipulator:null}_findToolAndManipulatorByKey(e,t,i){return Object(s.g)(e)?null:(i.tool=null,i.manipulator=null,t(t=>{if(t!==e.tool||null==t.manipulators||!zr(t))return!1;const r=t.manipulators.findById(e.manipulatorId);return!!Object(s.h)(r)&&(i.manipulator=r,i.tool=t,!0)}),null!=i.manipulator)}},this.tools=function(){const e=new z.a;return e.on("after-add",e=>{const t=e.item;t.view&&t.view.ready&&t.attach()}),e.on("after-remove",e=>{const t=e.item;Br(t,!1),t.destroyed||t.detach()}),e}(),this.cursor=null,this._forEachTool=e=>{if(!Object(s.h)(this._creatingTool)||!e(this._creatingTool))for(const t of this.tools.items)if(e(t))return}}initialize(){this._handles.add([this.view.on(Xe,e=>{this._handleInputEvent(e)},Ye.TOOL),this.tools.on("before-add",e=>{const t=e.item;null==t||this.tools.includes(t)?e.preventDefault():null==t.created||t.created||(Kr.error("tools","Tool can not be added to view before it has been created"),e.preventDefault())}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._forEachTool)}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this._forEachTool(e=>e.destroy()),this._handles.destroy(),this._handles=null}set activeTool(e){!Object(s.h)(e)||this.view.ready?(function(e,t,i){const r=e.activeTool;t!==r&&(Object(s.h)(r)&&r.deactivate&&r.deactivate(),i(t),Object(s.h)(t)&&t.activate&&t.activate())}(this,e,t=>{this._set("activeTool",t),this._removeIncompleteTools(e),this._forEachTool(e=>{const t=Object(s.g)(this.activeTool)||e===this.activeTool;e.setEditableFlag&&e.setEditableFlag(1,t);const i=zr(e);!Object(s.g)(this.activeTool)&&i||this._manipulatorState.clearPointers(e,this._forEachTool,!i)}),this._updateCursor()}),this._creatingTool!==e&&this._rejectCreatingTool()):Kr.error("#activeTool=","cannot set active tool while view is not ready")}async createTool(e,t,i){await this.view.whenReady();const r="Tool creation was interrupted by another tool being created";if(Object(f.e)(i))throw Object(f.d)(r);const n=new e({...Gr(t),view:this.view}),a=Object(f.o)(i,()=>this.activeTool=null);return this._rejectCreatingTool(r),this._creatingTool=n,n.attach(),this._refreshToolWatchers(),Br(n,!0),await n.when(),Object(s.h)(a)&&a.remove(),this._creatingTool=null,this.tools.add(n),n instanceof P.a&&null!=n.completed&&Object(me.h)(n,"completed").then(()=>{Br(n,!1)}),n}attach(){this._forEachTool(e=>e.attach()),"3d"===this.view.type?this._handles.add([this.view.state.watch("camera",()=>{this.forEachManipulator(e=>{null!=e.onViewChange&&e.onViewChange()})}),this.view.elevationProvider.on("elevation-change",e=>{this.forEachManipulator(t=>{null!=t.onElevationChange&&t.onElevationChange(e)})})],"manipulators"):this._handles.add(this.view.watch("extent",()=>{this.forEachManipulator(e=>{null!=e.onViewChange&&e.onViewChange()})}))}detach(){this.activeTool=null,this._forEachTool(e=>{e.detach(),e.destroy()}),this.tools.removeAll(),this._handles.remove("manipulators")}forEachManipulator(e){this._forEachTool(t=>{t.manipulators&&t.manipulators.forEach(({manipulator:i})=>e(i,t))})}_handleInputEvent(e){let t=!1;const i={...e,stopPropagation:()=>{t=!0,e.stopPropagation()}};Object(s.h)(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool(e=>{!t&&!1!==e.visible&&e.handleInputEvent&&e.handleInputEvent(i)}),!t&&"key-down"===e.type&&"Escape"===e.key&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},creatingTool:this._creatingTool,view:this.view}),!t&&Object(s.h)(this.activeTool)&&this.activeTool.handleInputEventAfter&&this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor()}_refreshToolWatchers(){this._handles.remove("tools"),this._forEachTool(e=>{if(e instanceof P.a){const t=Object(me.d)(e,["cursor","visible","editable"],()=>{zr(e)||this._manipulatorState.clearPointers(e,this._forEachTool),this._updateCursor()});this._handles.add(t,"tools")}e.manipulators&&this._handles.add(e.manipulators.on("change",t=>{t.removed.forEach(({id:t})=>{this._manipulatorState.clearPointers(e,this._forEachTool,!0,t)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}),"tools")}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateCursor(){let e=null;this._forEachTool(t=>null!=t.cursor&&!1!==t.visible&&(e=t.cursor,!0)),e||(e=this._manipulatorState.cursor),this._get("cursor")!==e&&this._set("cursor",e)}_rejectCreatingTool(e){const t=this._creatingTool;Object(s.g)(t)||(this._manipulatorState.clearPointers(t,this._forEachTool),t.rejectCreation&&t.rejectCreation(Object(f.d)(e)),t.destroy(),this._creatingTool=null,this._refreshToolWatchers())}_removeIncompleteTools(e){this.tools.filter(t=>(Object(s.g)(e)||t!==e)&&null!=t.completed&&!t.completed).forEach(e=>{this.tools.remove(e)})}};Object(n.a)([Object(c.b)({constructOnly:!0,nonNullable:!0})],Jr.prototype,"view",void 0),Object(n.a)([Object(c.b)({value:null})],Jr.prototype,"activeTool",null),Object(n.a)([Object(c.b)({readOnly:!0,type:z.a})],Jr.prototype,"tools",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],Jr.prototype,"cursor",void 0),Jr=Object(n.a)([Object(u.a)("esri.views.ToolViewManager")],Jr);var Qr=Jr;let Zr=class extends P.a{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown","standard"===e.mapping?this._detectedDeviceType="standard":Yr.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){return(navigator.getGamepads?navigator.getGamepads():[])[this.nativeIndex]}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return Xr[this.deviceType]}};Object(n.a)([Object(c.b)({nonNullable:!0,readOnly:!0})],Zr.prototype,"nativeIndex",void 0),Object(n.a)([Object(c.b)({type:String,readOnly:!0})],Zr.prototype,"deviceType",null),Object(n.a)([Object(c.b)({type:Number,readOnly:!0})],Zr.prototype,"axisThreshold",null),Zr=Object(n.a)([Object(u.a)("esri.views.input.gamepad.GamepadInputDevice")],Zr);const Yr=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),Xr={standard:.15,spacemouse:.025,unknown:0};var en=Zr;let tn=class extends P.a{constructor(...e){super(...e),this.devices=new z.a,this.enabledFocusMode="document"}};Object(n.a)([Object(c.b)({type:z.a.ofType(en),readOnly:!0})],tn.prototype,"devices",void 0),Object(n.a)([Object(c.b)({type:["document","view","none"]})],tn.prototype,"enabledFocusMode",void 0),tn=Object(n.a)([Object(u.a)("esri.views.input.gamepad.GamepadSettings")],tn);var rn=tn;let nn=class extends P.a{constructor(){super(...arguments),this.gamepad=new rn}};Object(n.a)([Object(c.b)({readOnly:!0})],nn.prototype,"gamepad",void 0),nn=Object(n.a)([Object(u.a)("esri.views.input.Input")],nn);var an=nn;let sn=class extends P.a{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};Object(n.a)([Object(c.b)({type:Boolean,nonNullable:!0})],sn.prototype,"enabled",void 0),Object(n.a)([Object(c.b)({type:en})],sn.prototype,"device",void 0),Object(n.a)([Object(c.b)({type:["pan","zoom"],nonNullable:!0})],sn.prototype,"mode",void 0),Object(n.a)([Object(c.b)({type:["forward-down","forward-up"],nonNullable:!0})],sn.prototype,"tiltDirection",void 0),Object(n.a)([Object(c.b)({type:Number,nonNullable:!0})],sn.prototype,"velocityFactor",void 0),sn=Object(n.a)([Object(u.a)("esri.views.navigation.gamepad.GamepadSettings")],sn);var on=sn;let ln=class extends P.a{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new on,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};Object(n.a)([Object(c.b)({type:Boolean})],ln.prototype,"browserTouchPanEnabled",void 0),Object(n.a)([Object(c.b)({type:on,nonNullable:!0})],ln.prototype,"gamepad",void 0),Object(n.a)([Object(c.b)({type:Boolean})],ln.prototype,"momentumEnabled",void 0),Object(n.a)([Object(c.b)({type:Boolean})],ln.prototype,"mouseWheelZoomEnabled",void 0),ln=Object(n.a)([Object(u.a)("esri.views.navigation.Navigation")],ln);var cn=ln,dn=i(21),un=i(92);function hn(e){const t=e.url&&Object(un.e)(e.url);return null==(e.spatialReference&&e.spatialReference.vcsWkid)&&t&&"ImageServer"===t.serverType||!pn(e)||!e.heightModelInfo?fn(e)?ve.a.deriveUnitFromSR(gn,e.spatialReference):null:e.heightModelInfo}function pn(e){return"heightModelInfo"in e}function bn(e){if("unknown"===e.type||!("capabilities"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"ogc-feature":return!0;case"imagery":case"map-image":case"tile":case"vector-tile":case null:return!1;default:return Object(K.a)(e),!1}}function fn(e){return bn(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):yn(e)}function yn(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"geojson":case"feature":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"map-image":case"map-notes":case"ogc-feature":case"open-street-map":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"wcs":case"web-tile":case"wms":case"wmts":case null:return!1;default:Object(K.a)(e)}return!1}const gn=new ve.a({heightModel:"gravity-related-height"});var mn;const vn=o.a.getLogger("esri.views.support.DefaultsFromMap");let On=mn=class extends P.a{constructor(){super(...arguments),this._handles=new Ee.a,this._waitTask=null,this._extentProjectController=null,this._spatialReferenceCandidates=null,this._extentCandidates=null,this.logDebugInformation=!1,this.isSpatialReferenceDone=!1,this.isTileInfoDone=!1,this.isHeightModelInfoSearching=!1,this.spatialReference=null,this.extent=null,this.heightModelInfo=null,this.vcsWkid=null,this.latestVcsWkid=null,this.mapCollectionPaths=mn.DefaultMapCollectionPaths.slice(),this.tileInfo=null}initialize(){this.watch("mapCollectionPaths",()=>{this._running&&(this.reset(),this.start())})}destroy(){this._set("view",null),this._handles&&(this._handles.destroy(),this._handles=null),this._cancelLoading()}get _running(){return!!(this._handles&&this._handles.size>0)}reset(){this._handles.removeAll(),this._set("isSpatialReferenceDone",!1),this._set("isTileInfoDone",!1),this._set("isHeightModelInfoSearching",!1),this._set("spatialReference",null),this._set("extent",null),this._set("heightModelInfo",null),this._set("vcsWkid",null),this._set("latestVcsWkid",null),this._set("tileInfo",null),this._spatialReferenceCandidates=null,this._extentCandidates=null}start(){this._handles.removeAll();const e=this._updateLayerChange.bind(this);for(const t of this.mapCollectionPaths)this._handles.add(Object(me.b)(this.view,"map."+t,"change",e,e,e,!0));this._handles.add(Object(me.e)(this,"isSpatialReferenceDone",()=>this._updateTileInfo(),!0))}_ownerNameFromCollectionName(e){const t=e.lastIndexOf(".");return-1===t?"view":"view."+e.slice(0,t)}_ensureLoadedOwnersFromCollectionName(e){const t=this._ownerNameFromCollectionName(e).split(".");let i;for(let r=0;r<t.length&&(i=this.get(t.slice(0,r+1).join(".")),i);r++)if(i.load&&!i.isFulfilled())return{collectionName:e,owner:null,loading:i.load().catch(()=>{})};return{collectionName:e,owner:i}}_cancelLoading(){this._waitTask=null,this._extentProjectController&&(this._extentProjectController.abort(),this._extentProjectController=null)}_updateWhen(e){let t=!0,i=!1;const r=e.catch(()=>{}).then(()=>{t?i=!0:r===this._waitTask&&this._update()});return t=!1,i||(this._waitTask=r),i}_updateLayerChange(){this.isSpatialReferenceDone&&!this.spatialReference&&this._set("isSpatialReferenceDone",!1),this._update()}_update(){if(this._cancelLoading(),this.view){if(!this.isSpatialReferenceDone){this._debugLog("Starting search for spatial reference...");const e=this._processMapCollections(e=>this._processSpatialReferenceSource(e));if(this._debugLog(`Search ended with status '${jn(e)}'`),0!==e){let e=null,t=this._spatialReferenceCandidates;if(!t||t.length<1?(e=this.defaultSpatialReference,this._debugLog(`No spatial reference found, locking to default (${_n(e)})`)):(this.defaultSpatialReference&&t.length>1&&Object(ji.b)(t,e=>e.equals(this.defaultSpatialReference))>-1&&(t=[this.defaultSpatialReference]),e=t[0],this._debugLog("Locking to "+_n(e))),this._set("spatialReference",e),e)if(this.extent)this._set("isSpatialReferenceDone",!0);else{const t=this.logDebugInformation;this.logDebugInformation=!1,this._processMapCollections(t=>this._findExtent(t,e)),this.logDebugInformation=t,this._projectExtentCandidate().catch(()=>{}).then(()=>this._set("isSpatialReferenceDone",!0))}else this._set("isSpatialReferenceDone",!0)}}if(null==this.heightModelInfo&&this.view.isHeightModelInfoRequired){this._debugLog("Starting search for height model info...");const e=this._processMapCollections(e=>this._processHeightModelInfoSource(e),e=>function(e){return null!=e.layers||yn(e)||bn(e)||pn(e)}(e));this._debugLog("Search ended with status "+jn(e)),this._set("isHeightModelInfoSearching",0===e)}this._updateTileInfo()}}_processMapCollections(e,t){this._preloadMapCollections(t);let i=2;return this._forAllMapCollectionSources(e=>{if(2!==i)return!1;const{collectionName:t}=e;return this._debugLog(`Processing collection ${t}...`),!(e.loading&&!this._updateWhen(e.loading)&&(this._debugLog(`Collection ${e.collectionName} owner is loading -> wait`),i=0,1))},r=>2===i&&(null==t||t(r)?!r.load||r.isFulfilled()||this._updateWhen(r.load())?!((!r.load||r.isResolved())&&e(r)&&(i=1,1)):(this._debugLog(`Source ${r.id} is loading -> wait`),i=0,!1):(this._debugLog(`Source ${r.id} is skipped due to predicate`),!1))),i}_preloadMapCollections(e){let t=10;const i=this.logDebugInformation;this.logDebugInformation=!1,this._forAllMapCollectionSources(()=>!0,r=>0!==t&&!(null!=e&&!e(r)||(r.load&&!r.isFulfilled()&&(this.logDebugInformation=i,this._debugLog("Pre-loading source "+r.id),this.logDebugInformation=!1,r.load().catch(()=>{}),t--),0))),this.logDebugInformation=i}_forAllMapCollectionSources(e,t){for(const i of this.mapCollectionPaths){const r="map."+i,n=this._ensureLoadedOwnersFromCollectionName(r);if(!1===e(n))continue;const a=n.owner;if(!a||a.isRejected&&a.isRejected()){this._debugLog(`Collection ${r} owner is invalid or rejected -> skip`);continue}const s=this.view.get(r);s?this._forEachSource(s,t):this._debugLog(`Collection ${r} does not exist -> skip`)}}_forEachSource(e,t){for(const i of e.items)!1!==t(i)&&"layers"in i&&i.layers&&this._forEachSource(i.layers,t)}_processSpatialReferenceSource(e){let t=this._getSupportedSpatialReferences(e);return 0!==t.length&&(this._spatialReferenceCandidates?(t=Object(dn.e)(t,this._spatialReferenceCandidates,(e,t)=>e.equals(t)),t.length>0?this._spatialReferenceCandidates=t:this._debugLog(`Layer ${e.id} is ignored because its supported spatial\n          references are not compatible with the previous candidates`)):this._spatialReferenceCandidates=t,1===this._spatialReferenceCandidates.length)}_findExtent(e,t){const i="fullExtents"in e&&e.fullExtents||(e.fullExtent?[e.fullExtent]:[]),r=Object(ji.d)(i,e=>e.spatialReference.equals(t));if(r)return this._set("extent",r),!0;if(this._getSupportedSpatialReferences(e).length>0){const t=i.map(t=>({extent:t,layer:e})),r=this._extentCandidates||[];this._extentCandidates=r.concat(t)}return!1}async _projectExtentCandidate(){if(!this._extentCandidates||!this._extentCandidates.length)return;const e=this.spatialReference,t=Object(ji.d)(this._extentCandidates,t=>Object(mr.a)(t.extent.spatialReference,e));if(t)this._set("extent",Object(mr.d)(t.extent,e));else{const t=this._extentCandidates[0];this._extentProjectController=Object(f.c)();const r=await i.e(146).then(i.bind(null,666));try{const i=await r.projectGeometry(t.extent,e,t.layer.portalItem,this._extentProjectController.signal);this._set("extent",i)}catch{}this._extentProjectController=null}}_getSupportedSpatialReferences(e){const t="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(0===t.length)return this._debugLog(`Layer ${e.id} is ignored because it does not have any spatial references`),[];const i=t.filter(t=>this.view.isSpatialReferenceSupported(t,e,e=>this._debugLog(e)));return 0===i.length?this._debugLog(`Layer ${e.id} has spatial references but none of them are supported (or layer doesn't require locking)`):this._debugLog(`Layer ${e.id} has spatial references. Resulting candidate set: ${i.map(_n).join(", ")}`),i}_processHeightModelInfoSource(e){const t=hn(e);return!!t&&(this._set("heightModelInfo",t),this._set("isHeightModelInfoSearching",!1),e.spatialReference&&(this._set("vcsWkid",e.spatialReference.vcsWkid),this._set("latestVcsWkid",e.spatialReference.latestVcsWkid)),!0)}_updateTileInfo(){if(null!=this.tileInfo)return;if(!this.view.isTileInfoRequired())return void this._set("isTileInfoDone",!0);if(!this.isSpatialReferenceDone)return;const e=this.get("view.map");if(!e)return void this._debugLog("updateTileInfo: no map");const t=e.basemap,i=e.get("layers.0");let r=null;if(t&&"failed"!==t.loadStatus){if(!t.loaded)return this._updateWhen(t.load()),void this._debugLog("updateTileInfo: basemap still loading");const e=t&&t.get("baseLayers.0");if(e&&"failed"!==e.loadStatus){if(!e.loaded)return this._updateWhen(e.load()),void this._debugLog("updateTileInfo: first basemap layer still loading");r="tileInfo"in e&&e.tileInfo}else{if(!i||"failed"===i.loadStatus)return this._debugLog("updateTileInfo: no tileInfo"),void this._set("isTileInfoDone",!0);if(!i.loaded)return this._updateWhen(i.load()),void this._debugLog("updateTileInfo: first operational layer still loading");r="tileInfo"in i&&i.tileInfo}}else if(i&&"failed"!==i.loadStatus){if(!i.loaded)return this._updateWhen(i.load()),void this._debugLog("updateTileInfo: first operational layer still loading");r="tileInfo"in i&&i.tileInfo}r&&!r.spatialReference.equals(this.spatialReference)&&(r=null),this._debugLog("updateTileInfo: setting "+r),this._set("tileInfo",r),this._set("isTileInfoDone",!0)}_debugLog(e){this.logDebugInformation&&vn.info(e)}};function _n(e){return e?JSON.stringify(e.toJSON()):"undefined"}function jn(e){switch(e){case 0:return"Waiting";case 1:return"Found";case 2:return"Exhausted"}}On.DefaultMapCollectionPaths=["basemap.baseLayers","layers","ground.layers","basemap.referenceLayers"],Object(n.a)([Object(c.b)()],On.prototype,"logDebugInformation",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],On.prototype,"isSpatialReferenceDone",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],On.prototype,"isTileInfoDone",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],On.prototype,"isHeightModelInfoSearching",void 0),Object(n.a)([Object(c.b)({constructOnly:!0})],On.prototype,"view",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],On.prototype,"spatialReference",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],On.prototype,"extent",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],On.prototype,"heightModelInfo",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],On.prototype,"vcsWkid",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],On.prototype,"latestVcsWkid",void 0),Object(n.a)([Object(c.b)()],On.prototype,"mapCollectionPaths",void 0),Object(n.a)([Object(c.b)()],On.prototype,"defaultSpatialReference",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],On.prototype,"tileInfo",void 0),On=mn=Object(n.a)([Object(u.a)("esri.views.support.DefaultsFromMap")],On);var wn,Mn=On;const In=o.a.getLogger("esri.views.View");let Tn=wn=class extends(Object(k.b)(B.a.EventedMixin(Object(G.b)(P.a)))){constructor(e){super(e),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new H.a({root:this,rootCollectionNames:["basemapView.baseLayerViews","groundView?.layerViews","layerViews","basemapView.referenceLayerViews"],getChildrenFunction:e=>e.layerViews}),this.animation=null,this.basemapView=null,this.defaultsFromMap=new Mn({view:this}),this.fatalError=null,this.extent=null,this.graphics=new Me,this.navigating=!1,this.layerViews=new z.a,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.renderContext=null,this.input=new an,this.navigation=new cn,this.layerViewManager=null,this.refreshManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new it(this),this._isValid=!1,this._readyCycleForced=!1,this.handles.add(this.watch("preconditionsReady",e=>{e?(this._currentSpatialReference=this.spatialReference,wn.views.add(this)):(this._currentSpatialReference=null,wn.views.remove(this)),this.notifyChange("spatialReference"),!e&&this.ready?(this.layerViewManager.clear(),this.toolViewManager.detach(),this._teardown()):e&&!this.ready&&(this._startup(),this.toolViewManager.attach())},!0))}initialize(){let e;this.addResolvingPromise(this.validate().then(()=>(this._isValid=!0,Object(me.h)(this,"ready")))),this.basemapView=new Ie({view:this}),this.layerViewManager=new Fe({view:this,layerViewImporter:{importLayerView:e=>this.importLayerView(e),hasLayerViewModule:e=>this.hasLayerViewModule(e)}}),this.refreshManager=new Pe({view:this}),this.toolViewManager=new Qr({view:this}),this._resetInitialViewPropertiesFromContent(),Object(me.a)(this.defaultsFromMap,"isSpatialReferenceDone",t=>{const i=!!(this.map&&this.map.allLayers.length>0);if(t&&!this.spatialReference&&i||!e){if(t&&!this.spatialReference&&i&&!e){const t=e=Object(f.s)(this.spatialReferenceWarningDelay);e.then(()=>{t===e&&In.warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}).catch(()=>{})}}else e=null},!0)}destroy(){if(this.destroyed)return;this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics.destroy(),this.graphics=null,this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),this.toolViewManager.destroy(),this.toolViewManager=null,this.refreshManager.destroy(),this.refreshManager=null,this.layerViewManager.destroy(),this.layerViewManager=null,this.basemapView.destroy(),this.basemapView=null,this.invalidate(),this._emitter.clear(),this.handles.removeAll();const e=this.map;this.map=null,null==e||e.destroy()}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Object(f.r)()}toMap(){return In.error("#toMap()","Not implemented on this instance of View"),null}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get preconditionsReady(){return!!(!this.fatalError&&this._isValid&&!this._readyCycleForced&&this.map&&(!W.a.isLoadable(this.map)||this.map.loaded)&&0!==this.width&&0!==this.height&&this.spatialReference&&this.isSpatialReferenceSupported(this.spatialReference)&&(this._currentSpatialReference||!this.initialExtentRequired||this.initialExtent||this.defaultsFromMap&&this.defaultsFromMap.isSpatialReferenceDone)&&this.defaultsFromMap&&this.defaultsFromMap.isTileInfoDone)}set map(e){var t;e!==this._get("map")&&((null==(t=e)?void 0:t.destroyed)&&(In.warn("#map","The provided map is already destroyed",{map:e}),e=null),W.a.isLoadable(e)&&e.load().catch(()=>{}),this.initialized&&(this.forceReadyCycle(),this._resetInitialViewPropertiesFromContent()),this._set("map",e))}get spatialReference(){let e=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return e&&this.isHeightModelInfoRequired&&this.defaultsFromMap&&(e=e.clone(),e.vcsWkid=this.defaultsFromMap.vcsWkid,e.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),e}set spatialReference(e){this._userSpatialReference=e,this._set("spatialReference",e)}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get initialExtent(){return this.defaultsFromMap&&this.defaultsFromMap.extent}get cursor(){const e=this.toolViewManager?this.toolViewManager.cursor:null;return Object(s.h)(e)?e:this._cursor||"default"}set cursor(e){this._cursor=e,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(e){return this.layerViewManager.whenLayerView(e)}getDefaultSpatialReference(){return this.get("defaultsFromMap.spatialReference")}getDefaultHeightModelInfo(){return this.get("map.supportsHeightModelInfo")&&this.get("map.heightModelInfo")||this.get("defaultsFromMap.heightModelInfo")||null}importLayerView(e){throw new p.a("importLayerView() not implemented")}hasLayerViewModule(e){return!1}async validate(){}invalidate(){this._isValid=!1}isSpatialReferenceSupported(e,t,i){return!0}isTileInfoRequired(){return!1}when(e,t){return this.isResolved()&&!this.ready&&In.warn("#when()",'Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use watchUtils.whenOnce(view, "ready").then(...) instead.'),super.when(e,t)}forceReadyCycle(){this.ready&&(this._readyCycleForced=!0,Object(me.g)(this,"preconditionsReady",()=>this._readyCycleForced=!1))}createTool(e,t,i){return this.toolViewManager.createTool(e,t,i)}tryFatalErrorRecovery(){this.fatalError=null}_resetInitialViewPropertiesFromContent(){if(!this.defaultsFromMap)return;const e=()=>this.defaultsFromMap&&this.defaultsFromMap.start();this.defaultsFromMap.reset(),this._currentSpatialReference=null,this.notifyChange("spatialReference"),this.handles.remove("defaultsFromMap"),this.handles.add([Object(me.d)(this,"spatialReference",(t,i)=>{Object(N.c)(t,i)||e()}),Object(me.d)(this,"initialExtentRequired",e),Object(V.b)(e)],"defaultsFromMap")}};Tn.views=new z.a,Object(n.a)([Object(R.a)("toolViewManager.activeTool")],Tn.prototype,"activeTool",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],Tn.prototype,"allLayerViews",void 0),Object(n.a)([Object(c.b)()],Tn.prototype,"animation",void 0),Object(n.a)([Object(c.b)()],Tn.prototype,"basemapView",void 0),Object(n.a)([Object(c.b)()],Tn.prototype,"defaultsFromMap",void 0),Object(n.a)([Object(c.b)()],Tn.prototype,"fatalError",void 0),Object(n.a)([Object(c.b)({type:U.a})],Tn.prototype,"extent",void 0),Object(n.a)([Object(c.b)(we)],Tn.prototype,"graphics",void 0),Object(n.a)([Object(c.b)({readOnly:!0,type:ve.a,dependsOn:["map.heightModelInfo?","defaultsFromMap.heightModelInfo"]})],Tn.prototype,"heightModelInfo",null),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["navigating"]})],Tn.prototype,"interacting",null),Object(n.a)([Object(c.b)({readOnly:!0})],Tn.prototype,"navigating",void 0),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","initialExtentRequired","initialExtent","defaultsFromMap.isSpatialReferenceDone","defaultsFromMap.isTileInfoDone"]})],Tn.prototype,"preconditionsReady",null),Object(n.a)([Object(c.b)({type:z.a,readOnly:!0})],Tn.prototype,"layerViews",void 0),Object(n.a)([Object(c.b)({value:null,type:ye})],Tn.prototype,"map",null),Object(n.a)([Object(c.b)()],Tn.prototype,"padding",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],Tn.prototype,"ready",void 0),Object(n.a)([Object(c.b)({type:D.a,dependsOn:["defaultsFromMap.spatialReference","defaultsFromMap.vcsWkid","defaultsFromMap.latestVcsWkid"]})],Tn.prototype,"spatialReference",null),Object(n.a)([Object(c.b)()],Tn.prototype,"spatialReferenceWarningDelay",void 0),Object(n.a)([Object(c.b)({dependsOn:["animation","navigating","resizing"]})],Tn.prototype,"stationary",null),Object(n.a)([Object(c.b)({type:ge.a})],Tn.prototype,"timeExtent",void 0),Object(n.a)([Object(R.a)("toolViewManager.tools")],Tn.prototype,"tools",void 0),Object(n.a)([Object(c.b)()],Tn.prototype,"toolViewManager",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],Tn.prototype,"type",void 0),Object(n.a)([Object(c.b)({type:Number})],Tn.prototype,"scale",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],Tn.prototype,"updating",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],Tn.prototype,"initialExtentRequired",void 0),Object(n.a)([Object(c.b)({readOnly:!0,type:U.a,dependsOn:["defaultsFromMap.extent"]})],Tn.prototype,"initialExtent",null),Object(n.a)([Object(c.b)({dependsOn:["toolViewManager.cursor"]})],Tn.prototype,"cursor",null),Object(n.a)([Object(c.b)()],Tn.prototype,"renderContext",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],Tn.prototype,"input",void 0),Object(n.a)([Object(c.b)({type:cn,nonNullable:!0})],Tn.prototype,"navigation",void 0),Object(n.a)([Object(c.b)()],Tn.prototype,"layerViewManager",void 0),Object(n.a)([Object(c.b)()],Tn.prototype,"width",void 0),Object(n.a)([Object(c.b)()],Tn.prototype,"height",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],Tn.prototype,"resizing",void 0),Object(n.a)([Object(c.b)({value:null,dependsOn:["width","height"],readOnly:!0})],Tn.prototype,"size",null),Object(n.a)([Object(c.b)({readOnly:!0})],Tn.prototype,"suspended",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],Tn.prototype,"viewEvents",void 0),Object(n.a)([Object(c.b)()],Tn.prototype,"_isValid",void 0),Object(n.a)([Object(c.b)()],Tn.prototype,"_readyCycleForced",void 0),Object(n.a)([Object(c.b)()],Tn.prototype,"_currentSpatialReference",void 0),Tn=wn=Object(n.a)([Object(u.a)("esri.views.View")],Tn);var Cn=Tn;const kn={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};let xn=class extends P.a{constructor(){super(...arguments),this._scale=null,this.view=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map(e=>e.toExportImageJSON());return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&Object(L.a)(this.visibleSublayers,this.layer.serviceSublayers,this.layer)}set layer(e){this._get("layer")!==e&&(this._set("layer",e),this._layerHandles&&(this._layerHandles.forEach(e=>e.remove()),this._layerHandles.length=0),e&&(this._layerHandles=[e.allSublayers.on("change",()=>this.notifyChange("visibleSublayers")),e.on("sublayer-update",e=>this.notifyChange(kn[e.propertyName]))]))}get layers(){const e=this.visibleSublayers;return e?e.length?"show:"+e.map(e=>e.id).join(","):"show:-1":null}get layerDefs(){const e=this.visibleSublayers.filter(e=>null!=e.definitionExpression);return e.length?JSON.stringify(e.reduce((e,t)=>(e[t.id]=t.definitionExpression,e),{})):null}get scale(){return null!=this._scale?this._scale:this.view&&this.view.scale||0}set scale(e){this.view||(this._scale=e,this.notifyChange("scale"))}get version(){const e=this;e.layers,e.layerDefs,e.dynamicLayers,e.timeExtent;const t=e.layer;return t&&(t.dpi,t.imageFormat,t.imageTransparency,t.gdbVersion),(this._get("version")||0)+1}set version(e){this._set("version",e)}get visibleSublayers(){const e=[];if(!this.layer)return e;const t=this.layer.sublayers,i=t=>{const r=this.scale,n=0===r,a=0===t.minScale||r<=t.minScale,s=0===t.maxScale||r>=t.maxScale;t.visible&&(n||a&&s)&&(t.sublayers?t.sublayers.forEach(i):e.unshift(t))};t&&t.forEach(i);const r=this._get("visibleSublayers");return!r||r.length!==e.length||r.some((t,i)=>e[i]!==t)?e:r}toJSON(){const e=this.layer;let t={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?t.dynamicLayers=this.dynamicLayers:t={...t,layers:this.layers,layerDefs:this.layerDefs},t}};Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["hasDynamicLayers","visibleSublayers"]})],xn.prototype,"dynamicLayers",null),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["visibleSublayers","layer.serviceSublayers","layer.capabilities"]})],xn.prototype,"hasDynamicLayers",null),Object(n.a)([Object(c.b)()],xn.prototype,"layer",null),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["visibleSublayers"]})],xn.prototype,"layers",null),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["visibleSublayers"]})],xn.prototype,"layerDefs",null),Object(n.a)([Object(c.b)({type:Number,dependsOn:["view.scale"]})],xn.prototype,"scale",null),Object(n.a)([Object(c.b)(j.a)],xn.prototype,"timeExtent",void 0),Object(n.a)([Object(c.b)({dependsOn:["layers","layerDefs","dynamicLayers","layer.dpi","layer.imageFormat","layer.imageTransparency","layer.gdbVersion","timeExtent"]})],xn.prototype,"version",null),Object(n.a)([Object(c.b)({type:Cn})],xn.prototype,"view",void 0),Object(n.a)([Object(c.b)({readOnly:!0,dependsOn:["layer.sublayers","scale"]})],xn.prototype,"visibleSublayers",null),xn=Object(n.a)([Object(u.a)("esri.layers.mixins.ExportImageParameters")],xn);let Sn=class extends(Object(_.a)(Object(C.a)(Object(T.a)(Object(I.a)(Object(A.a)(Object(S.a)(Object(O.a)(Object(w.a)(Object(M.a)(Object(v.a)(Object(F.a)(Object(k.b)(m.a))))))))))))){constructor(...e){super(...e),this.alwaysRefetch=!1,this.dpi=96,this.gdbVersion=null,this.imageFormat="png24",this.imageMaxHeight=2048,this.imageMaxWidth=2048,this.imageTransparency=!0,this.labelsVisible=!1,this.isReference=null,this.operationalLayerType="ArcGISMapServiceLayer",this.sourceJSON=null,this.sublayers=null,this.type="map-image",this.url=null}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}load(e){const t=Object(s.h)(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},e).then(()=>this._fetchService(t),()=>this._fetchService(t))),Object(f.r)(this)}readImageFormat(e,t){const i=t.supportedImageFormatTypes;return i&&i.indexOf("PNG32")>-1?"png32":"png24"}writeSublayers(e,t,i,r){if(!this.loaded||!e)return;const n=e.slice().reverse().flatten(({sublayers:e})=>e&&e.toArray().reverse()).toArray();let a=!1;if(this.capabilities&&this.capabilities.operations.supportsExportMap&&this.capabilities.exportMap.supportsDynamicLayers){const e=Object(b.d)(r.origin);if(3===e){const e=this.createSublayersForOrigin("service").sublayers;a=Object(L.c)(n,e,2)}else if(e>3){const e=this.createSublayersForOrigin("portal-item");a=Object(L.c)(n,e.sublayers,Object(b.d)(e.origin))}}const s=[],o={writeSublayerStructure:a,...r};let l=a;n.forEach(e=>{const t=e.write({},o);s.push(t),l=l||"user"===e.originOf("visible")}),s.some(e=>Object.keys(e).length>1)&&(t.layers=s),l&&(t.visibleLayers=n.filter(e=>e.visible).map(e=>e.id))}createExportImageParameters(e,t,i,r){const n=r&&r.pixelRatio||1;e&&this.version>=10&&(e=e.clone().shiftCentralMeridian());const a=new xn({layer:this,scale:Object(x.a)({extent:e,width:t})*n}),s=a.toJSON();a.layer=null,a.destroy();const o=!r||!r.rotation||this.version<10.3?{}:{rotation:-r.rotation},l=e&&e.spatialReference,c=l.wkid||JSON.stringify(l.toJSON());s.dpi*=n;const d={};if(null==r?void 0:r.timeExtent){const{start:e,end:t}=r.timeExtent.toJSON();d.time=e&&t&&e===t?""+e:`${null==e?"null":e},${null==t?"null":t}`}else this.timeInfo&&!this.timeInfo.hasLiveData&&(d.time="null,null");return{bbox:e&&e.xmin+","+e.ymin+","+e.xmax+","+e.ymax,bboxSR:c,imageSR:c,size:t+","+i,...s,...o,...d}}async fetchImage(e,t,i,r){const n={responseType:"image"};r&&r.timestamp&&(n.query={_ts:r.timestamp}),r&&r.signal&&(n.signal=r.signal);const a=this.parsedUrl.path+"/export",s={...this.parsedUrl.query,...this.createExportImageParameters(e,t,i,r),f:"image",_ts:this.alwaysRefetch?Date.now():null};return null==s.dynamicLayers||this.capabilities.exportMap.supportsDynamicLayers?(n.query?n.query={...s,...n.query}:n.query=s,Object(y.default)(a,n).then(e=>e.data).catch(e=>{if(Object(f.b)(e))throw e;throw new p.a("mapimagelayer:image-fetch-error","Unable to load image: "+a,{error:e})})):Object(f.h)(new p.a("mapimagelayer:dynamiclayer-not-supported",`service ${this.url} doesn't support dynamic layers, which is required to be able to change the sublayer's order, rendering, labeling or source.`,{query:s}))}loadAll(){return Object(g.a)(this,e=>{e(this.allSublayers)})}async _fetchService(e){if(this.sourceJSON)return void this.read(this.sourceJSON,{origin:"service",url:this.parsedUrl});const{data:t,ssl:i}=await Object(y.default)(this.parsedUrl.path,{query:{f:"json",...this.parsedUrl.query},signal:e});i&&(this.url=this.url.replace(/^http:/i,"https:")),this.sourceJSON=t,this.read(t,{origin:"service",url:this.parsedUrl})}};Object(n.a)([Object(c.b)()],Sn.prototype,"alwaysRefetch",void 0),Object(n.a)([Object(c.b)()],Sn.prototype,"dpi",void 0),Object(n.a)([Object(c.b)()],Sn.prototype,"gdbVersion",void 0),Object(n.a)([Object(c.b)({json:{read:!1,write:!1}})],Sn.prototype,"popupEnabled",void 0),Object(n.a)([Object(c.b)()],Sn.prototype,"imageFormat",void 0),Object(n.a)([Object(d.a)("imageFormat",["supportedImageFormatTypes"])],Sn.prototype,"readImageFormat",null),Object(n.a)([Object(c.b)({json:{origins:{service:{read:{source:"maxImageHeight"}}}}})],Sn.prototype,"imageMaxHeight",void 0),Object(n.a)([Object(c.b)({json:{origins:{service:{read:{source:"maxImageWidth"}}}}})],Sn.prototype,"imageMaxWidth",void 0),Object(n.a)([Object(c.b)()],Sn.prototype,"imageTransparency",void 0),Object(n.a)([Object(c.b)({json:{read:!1,write:!1}})],Sn.prototype,"labelsVisible",void 0),Object(n.a)([Object(c.b)({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],Sn.prototype,"isReference",void 0),Object(n.a)([Object(c.b)({type:["ArcGISMapServiceLayer"]})],Sn.prototype,"operationalLayerType",void 0),Object(n.a)([Object(c.b)()],Sn.prototype,"sourceJSON",void 0),Object(n.a)([Object(c.b)({json:{write:{ignoreOrigin:!0}}})],Sn.prototype,"sublayers",void 0),Object(n.a)([Object(h.a)("sublayers",{layers:{type:[E.a]},visibleLayers:{type:[l.a]}})],Sn.prototype,"writeSublayers",null),Object(n.a)([Object(c.b)({type:["show","hide","hide-children"]})],Sn.prototype,"listMode",void 0),Object(n.a)([Object(c.b)({json:{read:!1},readOnly:!0,value:"map-image"})],Sn.prototype,"type",void 0),Object(n.a)([Object(c.b)(j.j)],Sn.prototype,"url",void 0),Sn=Object(n.a)([Object(u.a)("esri.layers.MapImageLayer")],Sn);var Fn=Sn;t.default=Fn},452:function(e,t,i){"use strict";i.d(t,"a",(function(){return b}));var r=i(308);const n={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,i)=>{e.style[t]=i}};let a=e=>Object(r.c)(n,e),s=(e,t,i)=>(i=a(i),Object(r.a)(t,e,void 0,i),Object(r.b)(t,i)),o=(e,t,i)=>(i=a(i),Object(r.a)(t,e.parentNode,e,i),Object(r.b)(t,i)),l=(e,t,i)=>(i=a(i),t.domNode=e,Object(r.d)(e,t,i),Object(r.b)(t,i)),c=(e,t,i)=>(i=a(i),Object(r.a)(t,e.parentNode,e,i),e.parentNode.removeChild(e),Object(r.b)(t,i));const d=(e,t)=>{const i=[];for(;e!==t;)i.push(e),e=e.parentNode;return i};let u;u=Array.prototype.find?(e,t)=>e.find(t):(e,t)=>e.filter(t)[0];const h=(e,t)=>{let i=e;return t.forEach(e=>{i=i&&i.children?u(i.children,t=>t.domNode===e):void 0}),i},p=(e,t,i)=>{const r=function(r){i("domEvent",r);const n=t(),a=d(r.currentTarget,n.domNode);a.reverse();const s=h(n.getLastRender(),a);let o;return e.scheduleRender(),s&&(o=s.properties["on"+r.type].apply(s.properties.bind||this,arguments)),i("domEventProcessed",r),o};return()=>r};let b=e=>{let t;const i=a(e),r=i.performanceLogger;let n,d=!0,u=!1;const h=[],b=[],f=(e,n,a)=>{let s;i.eventHandlerInterceptor=p(t,()=>s,r),s=e(n,a(),i),h.push(s),b.push(a)},y=()=>{if(n=void 0,d){d=!1,r("renderStart",void 0);for(let e=0;e<h.length;e++){const t=b[e]();r("rendered",void 0),h[e].update(t),r("patched",void 0)}r("renderDone",void 0),d=!0}};return t={renderNow:y,scheduleRender:()=>{n||u||(n=requestAnimationFrame(y))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),u=!0},resume:()=>{u=!1,d=!0,t.scheduleRender()},append:(e,t)=>{f(s,e,t)},insertBefore:(e,t)=>{f(o,e,t)},merge:(e,t)=>{f(l,e,t)},replace:(e,t)=>{f(c,e,t)},detach:e=>{for(let t=0;t<b.length;t++)if(b[t]===e)return b.splice(t,1),h.splice(t,1)[0];throw new Error("renderFunction was not found")}},t}},467:function(e,t,i){"use strict";var r=i(2),n=i(96);t.a=class{constructor(e=(e=>Object(n.b)(e))){this._peeker=e,this._items=new Set}get length(){return this._items.size}clear(){this._items.clear()}peek(){if(0!==this._items.size)return this._peeker(this._items)}push(e){this.contains(e)||this._items.add(e)}contains(e){return this._items.has(e)}pop(){if(0===this.length)return;const e=this.peek();return this._items.delete(Object(r.c)(e)),e}remove(e){this._items.delete(e)}filter(e){return this._items.forEach(t=>{e(t)||this._items.delete(t)}),this}}},482:function(e,t,i){"use strict";i.r(t);var r,n=i(24),a=(i(3),i(20),i(8)),s=i(2),o=i(7),l=(i(9),i(26)),c=i(25),d=i(66),u=i(4),h=(i(41),i(5)),p=(i(42),i(65)),b=i(71),f=(i(72),i(74)),y=i(222),g=i(98),m=i(91),v=i(237),O=i(117),_=i(417),j=i(366);let w=0;const M=o.a.getLogger("esri.Basemap");let I=r=class extends(Object(p.b)(g.a)){constructor(e){super(e),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+w++,this.baseLayers=new f.a,this.referenceLayers=new f.a;const t=e=>{e.parent&&e.parent!==this&&"remove"in e.parent&&e.parent.remove(e),e.parent=this,"elevation"===e.type&&M.error(`Layer '${e.title}, id:${e.id}' of type '${e.type}' is not supported as a basemap layer and will therefore be ignored.`)},i=e=>{e.parent=null};this.baseLayers.on("after-add",e=>t(e.item)),this.referenceLayers.on("after-add",e=>t(e.item)),this.baseLayers.on("after-remove",e=>i(e.item)),this.referenceLayers.on("after-remove",e=>i(e.item))}initialize(){this.when().catch(e=>{M.error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){var e;const t=this.baseLayers.removeAll();for(const e of t)e.destroy();const i=this.referenceLayers.removeAll();for(const e of i)e.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),null==(e=this.portalItem)||e.destroy(),this.portalItem=null}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set baseLayers(e){this._set("baseLayers",Object(y.b)(e,this._get("baseLayers")))}_writeBaseLayers(e,t,i){const r=[];e?(i={...i,layerContainerType:"basemap"},this.baseLayers.forEach(e=>{const t=Object(j.a)(e,i.webmap?i.webmap.getLayerJSONFromResourceInfo(e):null,i);Object(s.h)(t)&&r.push(t)}),this.referenceLayers.forEach(e=>{const t=Object(j.a)(e,i.webmap?i.webmap.getLayerJSONFromResourceInfo(e):null,i);Object(s.h)(t)&&(t.isReference=!0,r.push(t))}),t.baseMapLayers=r):t.baseMapLayers=r}set referenceLayers(e){this._set("referenceLayers",Object(y.b)(e,this._get("referenceLayers")))}writeTitle(e,t){t.title=e||"Basemap"}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Object(h.r)(this)}loadAll(){return Object(v.a)(this,e=>{e(this.baseLayers,this.referenceLayers)})}clone(){const e={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.slice(),referenceLayers:this.referenceLayers.slice()};return this.loaded&&(e.loadStatus="loaded"),new r({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}write(e,t){return e=e||{},t&&t.origin||(t={origin:"web-map",...t}),super.write(e,t),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(e.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(e=>{const t=Object(a.a)(e);return t.url&&Object(u.u)(t.url)&&(t.url="https:"+t.url),t.templateUrl&&Object(u.u)(t.templateUrl)&&(t.templateUrl="https:"+t.templateUrl),t})),e}async _loadFromSource(e){const{resourceInfo:t,portalItem:i}=this;Object(h.t)(e);const r=[];if(t){const i=t.context?t.context.url:null;if(r.push(this._loadLayersFromJSON(t.data,i,e)),t.data.id&&!t.data.title){const e=t.data.id;r.push(Object(_.b)(e).then(e=>{e&&this.read({title:e},t.context)}))}}else i&&r.push(this._loadFromItem(i,e));await Object(h.a)(r)}async _loadLayersFromJSON(e,t,r){const n=this.resourceInfo&&this.resourceInfo.context,a=this.portalItem&&this.portalItem.portal||n&&n.portal||null,s=n&&"web-scene"===n.origin?"web-scene":"web-map",o=await i.e(25).then(i.bind(null,543)),l=[];if(Object(h.t)(r),e.baseMapLayers&&Array.isArray(e.baseMapLayers)){const i={context:{origin:s,url:t,portal:a,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},r=o.populateOperationalLayers(this.baseLayers,e.baseMapLayers.filter(e=>!e.isReference),i);l.push(r);const n=o.populateOperationalLayers(this.referenceLayers,e.baseMapLayers.filter(e=>e.isReference),i);l.push(n)}await Object(h.m)(l)}async _loadFromItem(e,t){const i=await e.load(t),r=await i.fetchData("json",t),n=Object(u.H)(e.itemUrl);return this._set("resourceInfo",{data:r.baseMap,context:{origin:"web-map",portal:e.portal||m.a.getDefault(),url:n}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this.read({title:e.title,thumbnailUrl:e.thumbnailUrl},{origin:"portal-item",portal:e.portal||m.a.getDefault(),url:n}),this._loadLayersFromJSON(this.resourceInfo.data,n,t)}static fromId(e){const t=_.a[e];return t?r.fromJSON(t):null}};Object(n.a)([Object(l.b)({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(e,t,i,r){this._writeBaseLayers(e,t,r)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:f.a}},writer(e,t,i,r){this._writeBaseLayers(e,t,r)}}}}}})],I.prototype,"baseLayers",null),Object(n.a)([Object(l.b)({type:String,json:{origins:{"web-scene":{write:!0}}}})],I.prototype,"id",void 0),Object(n.a)([Object(l.b)({type:O.default})],I.prototype,"portalItem",void 0),Object(n.a)([Object(l.b)()],I.prototype,"referenceLayers",null),Object(n.a)([Object(l.b)({readOnly:!0})],I.prototype,"resourceInfo",void 0),Object(n.a)([Object(l.b)({type:b.a})],I.prototype,"spatialReference",void 0),Object(n.a)([Object(l.b)()],I.prototype,"thumbnailUrl",void 0),Object(n.a)([Object(l.b)({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],I.prototype,"title",void 0),Object(n.a)([Object(d.a)("title")],I.prototype,"writeTitle",null),I=r=Object(n.a)([Object(c.a)("esri.Basemap")],I);var T=I;t.default=T},486:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(110);function n(e,t){const i=t||e.extent,n=e.width,a=Object(r.b)(i&&i.spatialReference);return i&&n?i.width/n*a*r.f*96:0}},489:function(e,t,i){"use strict";i.d(t,"a",(function(){return b}));var r=i(24),n=(i(3),i(20),i(7)),a=(i(9),i(26)),s=i(25),o=(i(4),i(41),i(5)),l=(i(42),i(74)),c=i(222),d=i(99);function u(e){return e&&"group"===e.type}function h(e,t,i){let r,n;if(e)for(let a=0,s=e.length;a<s;a++){if(r=e.getItemAt(a),r[t]===i)return r;if(u(r)&&(n=h(r.layers,t,i),n))return n}}const p=n.a.getLogger("esri.support.LayersMixin"),b=e=>{let t=class extends e{constructor(...e){super(...e),this.layers=new l.a;const t=e=>{e.parent=this,this.layerAdded(e),"elevation"!==e.type&&"base-elevation"!==e.type||p.error(`Layer 'title:${e.title}, id:${e.id}' of type '${e.type}' is not supported as an operational layer and will therefore be ignored.`)},i=e=>{e.parent=null,this.layerRemoved(e)};this.layers.on("before-add",e=>{var t;(t=e.item).parent&&"remove"in t.parent&&t.parent.remove(t)}),this.layers.on("after-add",e=>t(e.item)),this.layers.on("after-remove",e=>i(e.item))}destroy(){const e=this.layers.removeAll();for(const t of e)this.layerRemoved(t),t.destroy();this.layers.destroy()}set layers(e){this._set("layers",Object(c.b)(e,this._get("layers")))}add(e,t){const i=this.layers;t=i.getNextIndex(t),e instanceof d.a?e.parent===this?this.reorder(e,t):i.add(e,t):Object(o.i)(e)?e.then(e=>{this.destroyed||this.add(e,t)}):p.error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(e,t){const i=this.layers;t=i.getNextIndex(t),e.slice().forEach(e=>{e.parent!==this?(i.add(e,t),t+=1):this.reorder(e,t)})}findLayerById(e){return h(this.layers,"id",e)}findLayerByUid(e){return h(this.layers,"uid",e)}remove(e){return this.layers.remove(e)}removeMany(e){return this.layers.removeMany(e)}removeAll(){return this.layers.removeAll()}reorder(e,t){return this.layers.reorder(e,t)}layerAdded(e){}layerRemoved(e){}};return Object(r.a)([Object(a.b)()],t.prototype,"layers",null),t=Object(r.a)([Object(s.a)("esri.support.LayersMixin")],t),t}},490:function(e,t,i){"use strict";i.d(t,"a",(function(){return d}));var r=i(24),n=(i(3),i(20),i(7)),a=(i(9),i(26)),s=i(25),o=(i(4),i(41),i(42),i(74)),l=i(222);const c=n.a.getLogger("esri.support.TablesMixin"),d=e=>{let t=class extends e{constructor(...e){super(...e),this.tables=new o.a,this.tables.on("after-add",e=>{const t=e.item;t.parent&&t.parent!==this&&"tables"in t.parent&&t.parent.tables.remove(t),t.parent=this,"feature"!==t.type&&c.error(`Layer 'title:${t.title}, id:${t.id}' of type '${t.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",e=>{e.item.parent=null})}destroy(){const e=this.tables.removeAll();for(const t of e)t.destroy();this.tables.destroy()}set tables(e){this._set("tables",Object(l.b)(e,this._get("tables")))}};return Object(r.a)([Object(a.b)()],t.prototype,"tables",null),t=Object(r.a)([Object(s.a)("esri.support.TablesMixin")],t),t}},92:function(e,t,i){"use strict";i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return h})),i.d(t,"d",(function(){return y})),i.d(t,"e",(function(){return c})),i.d(t,"f",(function(){return p})),i.d(t,"g",(function(){return b})),i.d(t,"h",(function(){return u})),i.d(t,"i",(function(){return f}));var r=i(4),n=i(87);const a=["MapServer","ImageServer","FeatureServer","SceneServer","StreamServer","VectorTileServer"],s=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${a.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),o=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${a.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i");function l(e){return!!s.test(e)}function c(e){const t=Object(r.H)(e),i=t.path.match(s)||t.path.match(o);if(!i)return null;const[,n,a,l,c]=i,u=a.indexOf("/");return{title:d(-1!==u?a.slice(u+1):a),serverType:l,sublayer:null!=c&&""!==c?parseInt(c,10):null,url:{path:n}}}function d(e){return(e=e.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function u(e,t){const i=[];if(e){const t=c(e);t&&t.title&&i.push(t.title)}if(t){const e=d(t);i.push(e)}if(2===i.length){if(-1!==i[0].toLowerCase().indexOf(i[1].toLowerCase()))return i[0];if(-1!==i[1].toLowerCase().indexOf(i[0].toLowerCase()))return i[1]}return i.join(" - ")}function h(e){if(!e)return!1;const t=-1!==(e=e.toLowerCase()).indexOf(".arcgis.com/"),i=-1!==e.indexOf("//services")||-1!==e.indexOf("//tiles")||-1!==e.indexOf("//features");return t&&i}function p(e,t){return e?Object(r.F)(Object(r.E)(e,t)):e}function b(e,t,i){if(!t)return{url:t};t=Object(r.E)(t,i);const n=c(Object(r.H)(t).path);let a;return n&&null!=n.sublayer&&(null==e.layerId&&(a=n.sublayer),t=n.url.path),{url:Object(r.F)(t),layerId:a}}function f(e,t,i,a,s){Object(n.f)(t,a,"url",s),a.url&&null!=e.layerId&&(a.url=Object(r.w)(a.url,i,e.layerId.toString()))}function y(e){if(!e)return!1;const t=e.toLowerCase(),i=-1!==t.indexOf("/services/"),r=-1!==t.indexOf("/mapserver/wmsserver"),n=-1!==t.indexOf("/imageserver/wmsserver"),a=-1!==t.indexOf("/wmsserver");return i&&(r||n||a)}},97:function(e,t,i){"use strict";var r=i(24),n=i(2),a=i(26),s=i(25),o=i(30),l=i(74);let c=class extends o.a{constructor(e){super(e),this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(t=>{e+=t.length}),e}add(e,t){if(!this._isHandle(e)&&!Array.isArray(e)&&!l.a.isCollection(e))return this;const i=this._getOrCreateGroup(t);return Array.isArray(e)||l.a.isCollection(e)?e.forEach(e=>this._isHandle(e)&&i.push(e)):i.push(e),this.notifyChange("size"),this}forEach(e,t){if("function"==typeof e)this._groups.forEach(t=>t.forEach(e));else{const i=this._getGroup(e);i&&t&&i.forEach(t)}}has(e){return this._groups.has(this._ensureGroupKey(e))}remove(e){if(Array.isArray(e)||l.a.isCollection(e))return e.forEach(this.remove,this),this;if(!this.has(e))return this;const t=this._getGroup(e);for(let e=0;e<t.length;e++)t[e].remove();return this._deleteGroup(e),this.notifyChange("size"),this}removeAll(){return this._groups.forEach(e=>{for(let t=0;t<e.length;t++)e[t].remove()}),this._groups.clear(),this.notifyChange("size"),this}_isHandle(e){return e&&!!e.remove}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const t=[];return this._groups.set(this._ensureGroupKey(e),t),t}_getGroup(e){return Object(n.c)(this._groups.get(this._ensureGroupKey(e)))}_deleteGroup(e){return this._groups.delete(this._ensureGroupKey(e))}_ensureGroupKey(e){return e||"_default_"}};Object(r.a)([Object(a.b)({readOnly:!0})],c.prototype,"size",null),c=Object(r.a)([Object(s.a)("esri.core.Handles")],c);var d=c;t.a=d}});